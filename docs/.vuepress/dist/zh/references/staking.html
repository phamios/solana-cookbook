<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Solana秘籍 | 质押"><meta name="og:title" content="Solana秘籍 | 质押"><meta name="description" content="stake SOL and earn rewards for helping secure the network."><meta name="og:description" content="Stake SOL and earn rewards for helping secure the network. Learn more about Creating Stake Accounts, Delegate Stake, Withdraw Stake and more references for Building on Solana at The Solana cookbook."><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>质押 | Solana秘籍</title>
    <link rel="modulepreload" href="/assets/app.07ce7a66.js"><link rel="modulepreload" href="/assets/staking.html.87a92c5a.js"><link rel="modulepreload" href="/assets/staking.html.f374e09a.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/zh/" class=""><!----><span class="site-name can-hide">Solana秘籍</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="贡献代码"><!--[--><!--]--> 贡献代码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/references/staking.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/zh/references/staking.html" class="router-link-active router-link-exact-active router-link-active" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/references/staking.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/references/staking.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/references/staking.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/references/staking.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/references/staking.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/references/staking.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/references/staking.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/references/staking.html" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/references/staking.html" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/references/staking.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/references/staking.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="贡献代码"><!--[--><!--]--> 贡献代码 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/references/staking.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/zh/references/staking.html" class="router-link-active router-link-exact-active router-link-active" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/references/staking.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/references/staking.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/references/staking.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/references/staking.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/references/staking.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/references/staking.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/references/staking.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/references/staking.html" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/references/staking.html" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/references/staking.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/references/staking.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">开始使用 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh/" class="sidebar-item" aria-label="Solana秘籍"><!--[--><!--]--> Solana秘籍 <!--[--><!--]--></a><!----></li><li><a href="/zh/getting-started/installation.html" class="sidebar-item" aria-label="安装"><!--[--><!--]--> 安装 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">核心概念 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh/core-concepts/accounts.html" class="sidebar-item" aria-label="账户"><!--[--><!--]--> 账户 <!--[--><!--]--></a><!----></li><li><a href="/zh/core-concepts/programs.html" class="sidebar-item" aria-label="程序"><!--[--><!--]--> 程序 <!--[--><!--]--></a><!----></li><li><a href="/zh/core-concepts/transactions.html" class="sidebar-item" aria-label="交易"><!--[--><!--]--> 交易 <!--[--><!--]--></a><!----></li><li><a href="/zh/core-concepts/pdas.html" class="sidebar-item" aria-label="程序派生账户 (PDA)"><!--[--><!--]--> 程序派生账户 (PDA) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">指南 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh/guides/get-program-accounts.html" class="sidebar-item" aria-label="获取程序帐户"><!--[--><!--]--> 获取程序帐户 <!--[--><!--]--></a><!----></li><li><a href="/zh/guides/serialization.html" class="sidebar-item" aria-label="序列数据"><!--[--><!--]--> 序列数据 <!--[--><!--]--></a><!----></li><li><a href="/zh/guides/data-migration.html" class="sidebar-item" aria-label="迁移程序的数据账户"><!--[--><!--]--> 迁移程序的数据账户 <!--[--><!--]--></a><!----></li><li><a href="/zh/guides/account-maps.html" class="sidebar-item" aria-label="账户映射"><!--[--><!--]--> 账户映射 <!--[--><!--]--></a><!----></li><li><a href="/zh/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="调试 Solana 程序"><!--[--><!--]--> 调试 Solana 程序 <!--[--><!--]--></a><!----></li><li><a href="/zh/guides/feature-parity-testing.html" class="sidebar-item" aria-label="功能相等测试"><!--[--><!--]--> 功能相等测试 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">参考 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/zh/references/local-development.html" class="sidebar-item" aria-label="本地开发"><!--[--><!--]--> 本地开发 <!--[--><!--]--></a><!----></li><li><a href="/zh/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="密钥对和钱包"><!--[--><!--]--> 密钥对和钱包 <!--[--><!--]--></a><!----></li><li><a href="/zh/references/basic-transactions.html" class="sidebar-item" aria-label="发送交易"><!--[--><!--]--> 发送交易 <!--[--><!--]--></a><!----></li><li><a href="/zh/references/accounts.html" class="sidebar-item" aria-label="账户"><!--[--><!--]--> 账户 <!--[--><!--]--></a><!----></li><li><a href="/zh/references/programs.html" class="sidebar-item" aria-label="编写程序"><!--[--><!--]--> 编写程序 <!--[--><!--]--></a><!----></li><li><a href="/zh/references/token.html" class="sidebar-item" aria-label="与代币互动"><!--[--><!--]--> 与代币互动 <!--[--><!--]--></a><!----></li><li><a href="/zh/references/anchor.md" class="sidebar-item" aria-label="/zh/references/anchor.md"><!--[--><!--]--> /zh/references/anchor.md <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/references/staking.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="质押"><!--[--><!--]--> 质押 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/zh/references/staking.html#获取当前验证器" class="router-link-active router-link-exact-active sidebar-item" aria-label="获取当前验证器"><!--[--><!--]--> 获取当前验证器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/references/staking.html#创建质押账户" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建质押账户"><!--[--><!--]--> 创建质押账户 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/references/staking.html#委托质押" class="router-link-active router-link-exact-active sidebar-item" aria-label="委托质押"><!--[--><!--]--> 委托质押 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/references/staking.html#通过验证器获取委托人" class="router-link-active router-link-exact-active sidebar-item" aria-label="通过验证器获取委托人"><!--[--><!--]--> 通过验证器获取委托人 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/references/staking.html#停用质押" class="router-link-active router-link-exact-active sidebar-item" aria-label="停用质押"><!--[--><!--]--> 停用质押 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/references/staking.html#提取质押" class="router-link-active router-link-exact-active sidebar-item" aria-label="提取质押"><!--[--><!--]--> 提取质押 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/zh/references/staking.html#获取质押金额" class="router-link-active router-link-exact-active sidebar-item" aria-label="获取质押金额"><!--[--><!--]--> 获取质押金额 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/zh/references/nfts.html" class="sidebar-item" aria-label="非同质化代币 (NFTs)"><!--[--><!--]--> 非同质化代币 (NFTs) <!--[--><!--]--></a><!----></li><li><a href="/zh/references/offline-transactions.html" class="sidebar-item" aria-label="发送离线交易"><!--[--><!--]--> 发送离线交易 <!--[--><!--]--></a><!----></li><li><a href="/zh/references/name-service.html" class="sidebar-item" aria-label="命名服务"><!--[--><!--]--> 命名服务 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="质押" tabindex="-1"><a class="header-anchor" href="#质押" aria-hidden="true">#</a> 质押</h1><h2 id="获取当前验证器" tabindex="-1"><a class="header-anchor" href="#获取当前验证器" aria-hidden="true">#</a> 获取当前验证器</h2><p>我们可以质押 SOL 并通过帮助保护网络来获得奖励。要进行质押，我们将 SOL 委托给验证器，而验证器则处理交易。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">CLI</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> clusterApiUrl<span class="token punctuation">,</span> Connection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Get all validators, categorized by current (i.e. active) and deliquent (i.e. inactive)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> current<span class="token punctuation">,</span> delinquent <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getVoteAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;current validators: &quot;</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;all validators: &quot;</span><span class="token punctuation">,</span> current<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>delinquent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>solana validators
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><!--]--></div><!--]--></div><h2 id="创建质押账户" tabindex="-1"><a class="header-anchor" href="#创建质押账户" aria-hidden="true">#</a> 创建质押账户</h2><p>所有的质押指令由<a href="https://docs.solana.com/developing/runtime-facilities/programs#stake-program" target="_blank" rel="noopener noreferrer">质押程序 (Stake Program)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 处理。首先，我们创建一个<a href="https://docs.solana.com/staking/stake-accounts" target="_blank" rel="noopener noreferrer">质押账户<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>， 该账户与标准<a href="/zh/references/accounts.html#create-a-system-account" class="">系统账户</a>创建和管理方式不同。特别是，我们需要设置账户的<code>Stake Authority</code>和<code>Withdrawal Authority</code>。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  StakeProgram<span class="token punctuation">,</span>
  Authorized<span class="token punctuation">,</span>
  sendAndConfirmTransaction<span class="token punctuation">,</span>
  Lockup<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup our connection and wallet</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wallet <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Fund our wallet with 1 SOL</span>
  <span class="token keyword">const</span> airdropSignature <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>
    wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">LAMPORTS_PER_SOL</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>airdropSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Create a keypair for our stake account</span>
  <span class="token keyword">const</span> stakeAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Calculate how much we want to stake</span>
  <span class="token keyword">const</span> minimumRent <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    StakeProgram<span class="token punctuation">.</span>space
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> amountUserWantsToStake <span class="token operator">=</span> <span class="token constant">LAMPORTS_PER_SOL</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// This is can be user input. For now, we&#39;ll hardcode to 0.5 SOL</span>
  <span class="token keyword">const</span> amountToStake <span class="token operator">=</span> minimumRent <span class="token operator">+</span> amountUserWantsToStake<span class="token punctuation">;</span>

  <span class="token comment">// Setup a transaction to create our stake account</span>
  <span class="token comment">// Note: `StakeProgram.createAccount` returns a `Transaction` preconfigured with the necessary `TransactionInstruction`s</span>
  <span class="token keyword">const</span> createStakeAccountTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    authorized<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Authorized</span><span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Here we set two authorities: Stake Authority and Withdrawal Authority. Both are set to our wallet.</span>
    fromPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> amountToStake<span class="token punctuation">,</span>
    lockup<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lockup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Optional. We&#39;ll set this to 0 for demonstration purposes.</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> createStakeAccountTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
    connection<span class="token punctuation">,</span>
    createStakeAccountTx<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      wallet<span class="token punctuation">,</span>
      stakeAccount<span class="token punctuation">,</span> <span class="token comment">// Since we&#39;re creating a new stake account, we have that account sign as well</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account created. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>createStakeAccountTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check our newly created stake account balance. This should be 0.5 SOL.</span>
  <span class="token keyword">let</span> stakeBalance <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeBalance <span class="token operator">/</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Verify the status of our stake account. This will start as inactive and will take some time to activate.</span>
  <span class="token keyword">let</span> stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Setup a transaction to create our stake account</span>
<span class="token comment">// Note: `StakeProgram.createAccount` returns a `Transaction` preconfigured with the necessary `TransactionInstruction`s</span>
<span class="token keyword">const</span> createStakeAccountTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  authorized<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Authorized</span><span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Here we set two authorities: Stake Authority and Withdrawal Authority. Both are set to our wallet.</span>
  fromPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  lamports<span class="token operator">:</span> amountToStake<span class="token punctuation">,</span>
  lockup<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lockup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Optional. We&#39;ll set this to 0 for demonstration purposes.</span>
  stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> createStakeAccountTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
  connection<span class="token punctuation">,</span>
  createStakeAccountTx<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    wallet<span class="token punctuation">,</span>
    stakeAccount<span class="token punctuation">,</span> <span class="token comment">// Since we&#39;re creating a new stake account, we have that account sign as well</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account created. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>createStakeAccountTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check our newly created stake account balance. This should be 0.5 SOL.</span>
<span class="token keyword">let</span> stakeBalance <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeBalance <span class="token operator">/</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Verify the status of our stake account. This will start as inactive and will take some time to activate.</span>
<span class="token keyword">let</span> stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="委托质押" tabindex="-1"><a class="header-anchor" href="#委托质押" aria-hidden="true">#</a> 委托质押</h2><p>一旦质押账户得到资金支持，<code>Stake Authority</code>可以将其委托给一个验证者。每个质押账户一次只能委托给一个验证者。此外，账户中的所有代币必须要么被委托，要么取消委托。一旦委托成功，质押账户需要经过几个时期才能变为活跃状态。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  StakeProgram<span class="token punctuation">,</span>
  Authorized<span class="token punctuation">,</span>
  sendAndConfirmTransaction<span class="token punctuation">,</span>
  Lockup<span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup our connection and wallet</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wallet <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Fund our wallet with 1 SOL</span>
  <span class="token keyword">const</span> airdropSignature <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>
    wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">LAMPORTS_PER_SOL</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>airdropSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Create a keypair for our stake account</span>
  <span class="token keyword">const</span> stakeAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Calculate how much we want to stake</span>
  <span class="token keyword">const</span> minimumRent <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    StakeProgram<span class="token punctuation">.</span>space
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> amountUserWantsToStake <span class="token operator">=</span> <span class="token constant">LAMPORTS_PER_SOL</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// This is can be user input. For now, we&#39;ll hardcode to 0.5 SOL</span>
  <span class="token keyword">const</span> amountToStake <span class="token operator">=</span> minimumRent <span class="token operator">+</span> amountUserWantsToStake<span class="token punctuation">;</span>

  <span class="token comment">// Setup a transaction to create our stake account</span>
  <span class="token comment">// Note: `StakeProgram.createAccount` returns a `Transaction` preconfigured with the necessary `TransactionInstruction`s</span>
  <span class="token keyword">const</span> createStakeAccountTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    authorized<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Authorized</span><span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Here we set two authorities: Stake Authority and Withdrawal Authority. Both are set to our wallet.</span>
    fromPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> amountToStake<span class="token punctuation">,</span>
    lockup<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lockup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Optional. We&#39;ll set this to 0 for demonstration purposes.</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> createStakeAccountTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
    connection<span class="token punctuation">,</span>
    createStakeAccountTx<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      wallet<span class="token punctuation">,</span>
      stakeAccount<span class="token punctuation">,</span> <span class="token comment">// Since we&#39;re creating a new stake account, we have that account sign as well</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account created. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>createStakeAccountTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check our newly created stake account balance. This should be 0.5 SOL.</span>
  <span class="token keyword">let</span> stakeBalance <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeBalance <span class="token operator">/</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Verify the status of our stake account. This will start as inactive and will take some time to activate.</span>
  <span class="token keyword">let</span> stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// To delegate our stake, we first have to select a validator. Here we get all validators and select the first active one.</span>
  <span class="token keyword">const</span> validators <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getVoteAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectedValidator <span class="token operator">=</span> validators<span class="token punctuation">.</span>current<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectedValidatorPubkey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>selectedValidator<span class="token punctuation">.</span>votePubkey<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// With a validator selected, we can now setup a transaction that delegates our stake to their vote account.</span>
  <span class="token keyword">const</span> delegateTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">delegate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    votePubkey<span class="token operator">:</span> selectedValidatorPubkey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> delegateTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> delegateTx<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    wallet<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account delegated to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>selectedValidatorPubkey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delegateTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check in on our stake account. It should now be activating.</span>
  stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// With a validator selected, we can now setup a transaction that delegates our stake to their vote account.</span>
<span class="token keyword">const</span> delegateTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">delegate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  votePubkey<span class="token operator">:</span> selectedValidatorPubkey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> delegateTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> delegateTx<span class="token punctuation">,</span> <span class="token punctuation">[</span>
  wallet<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account delegated to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>selectedValidatorPubkey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delegateTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check in on our stake account. It should now be activating.</span>
stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="通过验证器获取委托人" tabindex="-1"><a class="header-anchor" href="#通过验证器获取委托人" aria-hidden="true">#</a> 通过验证器获取委托人</h2><p>多个账户可能已经质押给了特定的验证账户。为了获取所有的质押人，我们可以使用 <code>getProgramAccounts</code> 或 <code>getParsedProgramAccounts</code> API。请参考<a href="/guides/get-program-accounts.html" class="">指南部分</a> 获取更多信息。质押账户长度为200字节，选民公钥从第124字节开始。<a href="https://github.com/solana-labs/solana/blob/e960634909a9617fb98d5d836c9c4c5e0d9d59cc/sdk/program/src/stake/state.rs" target="_blank" rel="noopener noreferrer">参考资料<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> clusterApiUrl<span class="token punctuation">,</span> Connection<span class="token punctuation">,</span> PublicKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">STAKE_PROGRAM_ID</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;Stake11111111111111111111111111111111111111&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token constant">VOTE_PUB_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;27MtjMSAQ2BGkXNuJEJkxFyCJT8dugGAaHJ9T7Gc6x4x&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;mainnet-beta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> accounts <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getParsedProgramAccounts</span><span class="token punctuation">(</span><span class="token constant">STAKE_PROGRAM_ID</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    filters<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        dataSize<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// number of bytes</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        memcmp<span class="token operator">:</span> <span class="token punctuation">{</span>
          offset<span class="token operator">:</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token comment">// number of bytes</span>
          bytes<span class="token operator">:</span> <span class="token constant">VOTE_PUB_KEY</span><span class="token punctuation">,</span> <span class="token comment">// base58 encoded string</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Accounts for program </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">STAKE_PROGRAM_ID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Total number of delegators found for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">VOTE_PUB_KEY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>accounts<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>accounts<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sample delegator:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*
  // Output

    Accounts for program Stake11111111111111111111111111111111111111: 
    Total number of delegators found for 27MtjMSAQ2BGkXNuJEJkxFyCJT8dugGAaHJ9T7Gc6x4x is: 184
    Sample delegator: 
    {
      &quot;account&quot;: {
        &quot;data&quot;: {
          &quot;parsed&quot;: {
            &quot;info&quot;: {
              &quot;meta&quot;: {
                &quot;authorized&quot;: {
                  &quot;staker&quot;: &quot;3VDVh3rHTLkNJp6FVYbuFcaihYBFCQX5VSBZk23ckDGV&quot;,
                  &quot;withdrawer&quot;: &quot;EhYXq3ANp5nAerUpbSgd7VK2RRcxK1zNuSQ755G5Mtxx&quot;
                },
                &quot;lockup&quot;: {
                  &quot;custodian&quot;: &quot;3XdBZcURF5nKg3oTZAcfQZg8XEc5eKsx6vK8r3BdGGxg&quot;,
                  &quot;epoch&quot;: 0,
                  &quot;unixTimestamp&quot;: 1822867200
                },
                &quot;rentExemptReserve&quot;: &quot;2282880&quot;
              },
              &quot;stake&quot;: {
                &quot;creditsObserved&quot;: 58685367,
                &quot;delegation&quot;: {
                  &quot;activationEpoch&quot;: &quot;208&quot;,
                  &quot;deactivationEpoch&quot;: &quot;18446744073709551615&quot;,
                  &quot;stake&quot;: &quot;433005300621&quot;,
                  &quot;voter&quot;: &quot;27MtjMSAQ2BGkXNuJEJkxFyCJT8dugGAaHJ9T7Gc6x4x&quot;,
                  &quot;warmupCooldownRate&quot;: 0.25
                }
              }
            },
            &quot;type&quot;: &quot;delegated&quot;
          },
          &quot;program&quot;: &quot;stake&quot;,
          &quot;space&quot;: 200
        },
        &quot;executable&quot;: false,
        &quot;lamports&quot;: 433012149261,
        &quot;owner&quot;: {
          &quot;_bn&quot;: &quot;06a1d8179137542a983437bdfe2a7ab2557f535c8a78722b68a49dc000000000&quot;
        },
        &quot;rentEpoch&quot;: 264
      },
      &quot;pubkey&quot;: {
        &quot;_bn&quot;: &quot;0dc8b506f95e52c9ac725e714c7078799dd3268df562161411fe0916a4dc0a43&quot;
      }
    }

  */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token constant">STAKE_PROGRAM_ID</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
  <span class="token string">&quot;Stake11111111111111111111111111111111111111&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">VOTE_PUB_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;27MtjMSAQ2BGkXNuJEJkxFyCJT8dugGAaHJ9T7Gc6x4x&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;mainnet-beta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> accounts <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getParsedProgramAccounts</span><span class="token punctuation">(</span><span class="token constant">STAKE_PROGRAM_ID</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  filters<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      dataSize<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// number of bytes</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      memcmp<span class="token operator">:</span> <span class="token punctuation">{</span>
        offset<span class="token operator">:</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token comment">// number of bytes</span>
        bytes<span class="token operator">:</span> <span class="token constant">VOTE_PUB_KEY</span><span class="token punctuation">,</span> <span class="token comment">// base58 encoded string</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Accounts for program </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">STAKE_PROGRAM_ID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Total number of delegators found for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">VOTE_PUB_KEY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>accounts<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>accounts<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sample delegator:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
// Output

  Accounts for program Stake11111111111111111111111111111111111111: 
  Total number of delegators found for 27MtjMSAQ2BGkXNuJEJkxFyCJT8dugGAaHJ9T7Gc6x4x is: 184
  Sample delegator: 
  {
    &quot;account&quot;: {
      &quot;data&quot;: {
        &quot;parsed&quot;: {
          &quot;info&quot;: {
            &quot;meta&quot;: {
              &quot;authorized&quot;: {
                &quot;staker&quot;: &quot;3VDVh3rHTLkNJp6FVYbuFcaihYBFCQX5VSBZk23ckDGV&quot;,
                &quot;withdrawer&quot;: &quot;EhYXq3ANp5nAerUpbSgd7VK2RRcxK1zNuSQ755G5Mtxx&quot;
              },
              &quot;lockup&quot;: {
                &quot;custodian&quot;: &quot;3XdBZcURF5nKg3oTZAcfQZg8XEc5eKsx6vK8r3BdGGxg&quot;,
                &quot;epoch&quot;: 0,
                &quot;unixTimestamp&quot;: 1822867200
              },
              &quot;rentExemptReserve&quot;: &quot;2282880&quot;
            },
            &quot;stake&quot;: {
              &quot;creditsObserved&quot;: 58685367,
              &quot;delegation&quot;: {
                &quot;activationEpoch&quot;: &quot;208&quot;,
                &quot;deactivationEpoch&quot;: &quot;18446744073709551615&quot;,
                &quot;stake&quot;: &quot;433005300621&quot;,
                &quot;voter&quot;: &quot;27MtjMSAQ2BGkXNuJEJkxFyCJT8dugGAaHJ9T7Gc6x4x&quot;,
                &quot;warmupCooldownRate&quot;: 0.25
              }
            }
          },
          &quot;type&quot;: &quot;delegated&quot;
        },
        &quot;program&quot;: &quot;stake&quot;,
        &quot;space&quot;: 200
      },
      &quot;executable&quot;: false,
      &quot;lamports&quot;: 433012149261,
      &quot;owner&quot;: {
        &quot;_bn&quot;: &quot;06a1d8179137542a983437bdfe2a7ab2557f535c8a78722b68a49dc000000000&quot;
      },
      &quot;rentEpoch&quot;: 264
    },
    &quot;pubkey&quot;: {
      &quot;_bn&quot;: &quot;0dc8b506f95e52c9ac725e714c7078799dd3268df562161411fe0916a4dc0a43&quot;
    }
  }
  
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="停用质押" tabindex="-1"><a class="header-anchor" href="#停用质押" aria-hidden="true">#</a> 停用质押</h2><p>在质押账户委托后的任何时候，<code>Stake Authority</code>可以选择停用该账户。停用过程可能需要多个时期才能完成，并且在提取任何 SOL 之前必须完成停用操作。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  StakeProgram<span class="token punctuation">,</span>
  Authorized<span class="token punctuation">,</span>
  sendAndConfirmTransaction<span class="token punctuation">,</span>
  Lockup<span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup our connection and wallet</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wallet <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Fund our wallet with 1 SOL</span>
  <span class="token keyword">const</span> airdropSignature <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>
    wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">LAMPORTS_PER_SOL</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>airdropSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Create a keypair for our stake account</span>
  <span class="token keyword">const</span> stakeAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Calculate how much we want to stake</span>
  <span class="token keyword">const</span> minimumRent <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    StakeProgram<span class="token punctuation">.</span>space
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> amountUserWantsToStake <span class="token operator">=</span> <span class="token constant">LAMPORTS_PER_SOL</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// This is can be user input. For now, we&#39;ll hardcode to 0.5 SOL</span>
  <span class="token keyword">const</span> amountToStake <span class="token operator">=</span> minimumRent <span class="token operator">+</span> amountUserWantsToStake<span class="token punctuation">;</span>

  <span class="token comment">// Setup a transaction to create our stake account</span>
  <span class="token comment">// Note: `StakeProgram.createAccount` returns a `Transaction` preconfigured with the necessary `TransactionInstruction`s</span>
  <span class="token keyword">const</span> createStakeAccountTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    authorized<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Authorized</span><span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Here we set two authorities: Stake Authority and Withdrawal Authority. Both are set to our wallet.</span>
    fromPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> amountToStake<span class="token punctuation">,</span>
    lockup<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lockup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Optional. We&#39;ll set this to 0 for demonstration purposes.</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> createStakeAccountTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
    connection<span class="token punctuation">,</span>
    createStakeAccountTx<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      wallet<span class="token punctuation">,</span>
      stakeAccount<span class="token punctuation">,</span> <span class="token comment">// Since we&#39;re creating a new stake account, we have that account sign as well</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account created. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>createStakeAccountTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check our newly created stake account balance. This should be 0.5 SOL.</span>
  <span class="token keyword">let</span> stakeBalance <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeBalance <span class="token operator">/</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Verify the status of our stake account. This will start as inactive and will take some time to activate.</span>
  <span class="token keyword">let</span> stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// To delegate our stake, we first have to select a validator. Here we get all validators and select the first active one.</span>
  <span class="token keyword">const</span> validators <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getVoteAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectedValidator <span class="token operator">=</span> validators<span class="token punctuation">.</span>current<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectedValidatorPubkey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>selectedValidator<span class="token punctuation">.</span>votePubkey<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// With a validator selected, we can now setup a transaction that delegates our stake to their vote account.</span>
  <span class="token keyword">const</span> delegateTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">delegate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    votePubkey<span class="token operator">:</span> selectedValidatorPubkey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> delegateTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> delegateTx<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    wallet<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account delegated to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>selectedValidatorPubkey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delegateTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check in on our stake account. It should now be activating.</span>
  stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// At anytime we can choose to deactivate our stake. Our stake account must be inactive before we can withdraw funds.</span>
  <span class="token keyword">const</span> deactivateTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">deactivate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deactivateTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
    connection<span class="token punctuation">,</span>
    deactivateTx<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>wallet<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account deactivated. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>deactivateTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check in on our stake account. It should now be inactive.</span>
  stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// At anytime we can choose to deactivate our stake. Our stake account must be inactive before we can withdraw funds.</span>
<span class="token keyword">const</span> deactivateTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">deactivate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deactivateTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
  connection<span class="token punctuation">,</span>
  deactivateTx<span class="token punctuation">,</span>
  <span class="token punctuation">[</span>wallet<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account deactivated. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>deactivateTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check in on our stake account. It should now be inactive.</span>
stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="提取质押" tabindex="-1"><a class="header-anchor" href="#提取质押" aria-hidden="true">#</a> 提取质押</h2><p>一旦停用了，<code>Withdrawal Authority</code>可以将 SOL 提取回系统账户。一旦质押账户不再委托并且余额为 0 SOL，它将被销毁了。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  StakeProgram<span class="token punctuation">,</span>
  Authorized<span class="token punctuation">,</span>
  sendAndConfirmTransaction<span class="token punctuation">,</span>
  Lockup<span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup our connection and wallet</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wallet <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Fund our wallet with 1 SOL</span>
  <span class="token keyword">const</span> airdropSignature <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>
    wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">LAMPORTS_PER_SOL</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>airdropSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Create a keypair for our stake account</span>
  <span class="token keyword">const</span> stakeAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Calculate how much we want to stake</span>
  <span class="token keyword">const</span> minimumRent <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    StakeProgram<span class="token punctuation">.</span>space
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> amountUserWantsToStake <span class="token operator">=</span> <span class="token constant">LAMPORTS_PER_SOL</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// This is can be user input. For now, we&#39;ll hardcode to 0.5 SOL</span>
  <span class="token keyword">const</span> amountToStake <span class="token operator">=</span> minimumRent <span class="token operator">+</span> amountUserWantsToStake<span class="token punctuation">;</span>

  <span class="token comment">// Setup a transaction to create our stake account</span>
  <span class="token comment">// Note: `StakeProgram.createAccount` returns a `Transaction` preconfigured with the necessary `TransactionInstruction`s</span>
  <span class="token keyword">const</span> createStakeAccountTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    authorized<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Authorized</span><span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Here we set two authorities: Stake Authority and Withdrawal Authority. Both are set to our wallet.</span>
    fromPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> amountToStake<span class="token punctuation">,</span>
    lockup<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lockup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Optional. We&#39;ll set this to 0 for demonstration purposes.</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> createStakeAccountTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
    connection<span class="token punctuation">,</span>
    createStakeAccountTx<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      wallet<span class="token punctuation">,</span>
      stakeAccount<span class="token punctuation">,</span> <span class="token comment">// Since we&#39;re creating a new stake account, we have that account sign as well</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account created. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>createStakeAccountTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check our newly created stake account balance. This should be 0.5 SOL.</span>
  <span class="token keyword">let</span> stakeBalance <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeBalance <span class="token operator">/</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Verify the status of our stake account. This will start as inactive and will take some time to activate.</span>
  <span class="token keyword">let</span> stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// To delegate our stake, we first have to select a validator. Here we get all validators and select the first active one.</span>
  <span class="token keyword">const</span> validators <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getVoteAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectedValidator <span class="token operator">=</span> validators<span class="token punctuation">.</span>current<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectedValidatorPubkey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>selectedValidator<span class="token punctuation">.</span>votePubkey<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// With a validator selected, we can now setup a transaction that delegates our stake to their vote account.</span>
  <span class="token keyword">const</span> delegateTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">delegate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    votePubkey<span class="token operator">:</span> selectedValidatorPubkey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> delegateTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> delegateTx<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    wallet<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account delegated to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>selectedValidatorPubkey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delegateTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check in on our stake account. It should now be activating.</span>
  stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// At anytime we can choose to deactivate our stake. Our stake account must be inactive before we can withdraw funds.</span>
  <span class="token keyword">const</span> deactivateTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">deactivate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deactivateTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
    connection<span class="token punctuation">,</span>
    deactivateTx<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>wallet<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account deactivated. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>deactivateTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check in on our stake account. It should now be inactive.</span>
  stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Once deactivated, we can withdraw our SOL back to our main wallet</span>
  <span class="token keyword">const</span> withdrawTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    toPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> stakeBalance<span class="token punctuation">,</span> <span class="token comment">// Withdraw the full balance at the time of the transaction</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> withdrawTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> withdrawTx<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    wallet<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account withdrawn. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>withdrawTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Confirm that our stake account balance is now 0</span>
  stakeBalance <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeBalance <span class="token operator">/</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Once deactivated, we can withdraw our SOL back to our main wallet</span>
<span class="token keyword">const</span> withdrawTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  authorizedPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  toPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  lamports<span class="token operator">:</span> stakeBalance<span class="token punctuation">,</span> <span class="token comment">// Withdraw the full balance at the time of the transaction</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> withdrawTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> withdrawTx<span class="token punctuation">,</span> <span class="token punctuation">[</span>
  wallet<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account withdrawn. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>withdrawTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Confirm that our stake account balance is now 0</span>
stakeBalance <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeBalance <span class="token operator">/</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="获取质押金额" tabindex="-1"><a class="header-anchor" href="#获取质押金额" aria-hidden="true">#</a> 获取质押金额</h2><p>一旦我们使用多个质押账户质押多个代币，我们可以获取与我们的特定钱包相关的质押金额。为此，我们将使用<code>getProgramAccounts</code>或<code>getParsedProgramAccounts</code> API获取所有的质押账户。有关更多信息，请参考<a href="/guides/get-program-accounts.html" class="">指南部分</a>。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  StakeProgram<span class="token punctuation">,</span>
  Authorized<span class="token punctuation">,</span>
  sendAndConfirmTransaction<span class="token punctuation">,</span>
  Lockup<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Setup our connection and wallet</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wallet <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Fund our wallet with 1 SOL</span>
  <span class="token keyword">const</span> airdropSignature <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>
    wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">LAMPORTS_PER_SOL</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>airdropSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Create a keypair for our stake account</span>
  <span class="token keyword">const</span> stakeAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Calculate how much we want to stake</span>
  <span class="token keyword">const</span> minimumRent <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    StakeProgram<span class="token punctuation">.</span>space
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> amountUserWantsToStake <span class="token operator">=</span> <span class="token constant">LAMPORTS_PER_SOL</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// This is can be user input. For now, we&#39;ll hardcode to 0.5 SOL</span>
  <span class="token keyword">const</span> amountToStake <span class="token operator">=</span> minimumRent <span class="token operator">+</span> amountUserWantsToStake<span class="token punctuation">;</span>

  <span class="token comment">// Setup a transaction to create our stake account</span>
  <span class="token comment">// Note: `StakeProgram.createAccount` returns a `Transaction` preconfigured with the necessary `TransactionInstruction`s</span>
  <span class="token keyword">const</span> createStakeAccountTx <span class="token operator">=</span> StakeProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    authorized<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Authorized</span><span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Here we set two authorities: Stake Authority and Withdrawal Authority. Both are set to our wallet.</span>
    fromPubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> amountToStake<span class="token punctuation">,</span>
    lockup<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lockup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Optional. We&#39;ll set this to 0 for demonstration purposes.</span>
    stakePubkey<span class="token operator">:</span> stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> createStakeAccountTxId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
    connection<span class="token punctuation">,</span>
    createStakeAccountTx<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      wallet<span class="token punctuation">,</span>
      stakeAccount<span class="token punctuation">,</span> <span class="token comment">// Since we&#39;re creating a new stake account, we have that account sign as well</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account created. Tx Id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>createStakeAccountTxId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check our newly created stake account balance. This should be 0.5 SOL.</span>
  <span class="token keyword">let</span> stakeBalance <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeBalance <span class="token operator">/</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Verify the status of our stake account. This will start as inactive and will take some time to activate.</span>
  <span class="token keyword">let</span> stakeStatus <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getStakeActivation</span><span class="token punctuation">(</span>stakeAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake account status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakeStatus<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// get stake amount for this wallet</span>

  <span class="token keyword">let</span> totalStakeBalance <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// fetch all stake account for this wallet</span>

  <span class="token keyword">const</span> allStakeAccounts <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getParsedProgramAccounts</span><span class="token punctuation">(</span>
    StakeProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      filters<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          memcmp<span class="token operator">:</span> <span class="token punctuation">{</span>
            offset<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token comment">// number of bytes</span>
            bytes<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">.</span><span class="token function">toBase58</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// base58 encoded string</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake accounts for wallet </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wallet<span class="token punctuation">.</span>publicKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Total number of stake account for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wallet<span class="token punctuation">.</span>publicKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>allStakeAccounts<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>allStakeAccounts<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sample stake account:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>allStakeAccounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// calculating total stake amount</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> account <span class="token keyword">of</span> allStakeAccounts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    totalStakeBalance <span class="token operator">+=</span> account<span class="token punctuation">.</span>account<span class="token punctuation">.</span>lamports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// total stake amount</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake amount for this wallet in lamports: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>totalStakeBalance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">let</span> totalStakeBalance <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">// fetch all stake account for this wallet</span>
<span class="token keyword">const</span> allStakeAccounts <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getParsedProgramAccounts</span><span class="token punctuation">(</span>
  StakeProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    filters<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        memcmp<span class="token operator">:</span> <span class="token punctuation">{</span>
          offset<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token comment">// number of bytes</span>
          bytes<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">.</span><span class="token function">toBase58</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// base58 encoded string</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake accounts for wallet </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wallet<span class="token punctuation">.</span>publicKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Total number of stake account for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wallet<span class="token punctuation">.</span>publicKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>allStakeAccounts<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>allStakeAccounts<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sample stake account:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>allStakeAccounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// calculating total stake amount</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> account <span class="token keyword">of</span> allStakeAccounts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  totalStakeBalance <span class="token operator">+=</span> account<span class="token punctuation">.</span>account<span class="token punctuation">.</span>lamports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// total stake amount</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stake amount for this wallet in lamports: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>totalStakeBalance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><!--]--></div></div><!--]--></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 138085102+lillianrf@users.noreply.github.com">lillianrf</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/zh/references/anchor.md" class="" aria-label="/zh/references/anchor.md"><!--[--><!--]--> /zh/references/anchor.md <!--[--><!--]--></a></span><span class="next"><a href="/zh/references/nfts.html" class="" aria-label="非同质化代币 (NFTs)"><!--[--><!--]--> 非同质化代币 (NFTs) <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.07ce7a66.js" defer></script>
  </body>
</html>
