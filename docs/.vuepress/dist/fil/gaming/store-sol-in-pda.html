<!DOCTYPE html>
<html lang="fil-PH">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Solana Cookbook | Storing SOL in a PDA"><meta name="og:title" content="Solana Cookbook | Storing SOL in a PDA"><meta name="description" content="Using PDAs, you can reward SOL to players playing your game. Learn how to reward SOL from a PDA when players find chests in this game."><meta name="og:description" content="Using PDAs, you can reward SOL to players playing your game. Learn how to reward SOL from a PDA when players find chests in this game."><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Storing SOL in a PDA | Solana Cookbook</title>
    <link rel="modulepreload" href="/assets/app.07ce7a66.js"><link rel="modulepreload" href="/assets/store-sol-in-pda.html.4ff617de.js"><link rel="modulepreload" href="/assets/store-sol-in-pda.html.11610e9c.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/fil/" class=""><!----><span class="site-name can-hide">Solana Cookbook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Pag-ambag"><!--[--><!--]--> Pag-ambag <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/gaming/store-sol-in-pda.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/gaming/store-sol-in-pda.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/fil/gaming/store-sol-in-pda.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Pag-ambag"><!--[--><!--]--> Pag-ambag <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/gaming/store-sol-in-pda.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/gaming/store-sol-in-pda.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/fil/gaming/store-sol-in-pda.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Pagsisimula <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/fil/" class="sidebar-item" aria-label="Cooking with Solana"><!--[--><!--]--> Cooking with Solana <!--[--><!--]--></a><!----></li><li><a href="/fil/getting-started/installation.html" class="sidebar-item" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Mga pangunahing konsepto <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/fil/core-concepts/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/fil/core-concepts/programs.html" class="sidebar-item" aria-label="Programs"><!--[--><!--]--> Programs <!--[--><!--]--></a><!----></li><li><a href="/fil/core-concepts/transactions.html" class="sidebar-item" aria-label="Transactions"><!--[--><!--]--> Transactions <!--[--><!--]--></a><!----></li><li><a href="/fil/core-concepts/pdas.html" class="sidebar-item" aria-label="Program Derived Addresses (PDAs)"><!--[--><!--]--> Program Derived Addresses (PDAs) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Mga Gabay <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/fil/guides/get-program-accounts.html" class="sidebar-item" aria-label="Get Program Accounts"><!--[--><!--]--> Get Program Accounts <!--[--><!--]--></a><!----></li><li><a href="/fil/guides/serialization.html" class="sidebar-item" aria-label="Serializing Data"><!--[--><!--]--> Serializing Data <!--[--><!--]--></a><!----></li><li><a href="/fil/guides/data-migration.html" class="sidebar-item" aria-label="Migrating Program Data Accounts"><!--[--><!--]--> Migrating Program Data Accounts <!--[--><!--]--></a><!----></li><li><a href="/fil/guides/account-maps.html" class="sidebar-item" aria-label="Account Maps"><!--[--><!--]--> Account Maps <!--[--><!--]--></a><!----></li><li><a href="/fil/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="Debugging Solana Programs"><!--[--><!--]--> Debugging Solana Programs <!--[--><!--]--></a><!----></li><li><a href="/fil/guides/feature-parity-testing.html" class="sidebar-item" aria-label="Feature Parity Testing"><!--[--><!--]--> Feature Parity Testing <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Mga sanggunian <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/fil/references/local-development.html" class="sidebar-item" aria-label="Local Development"><!--[--><!--]--> Local Development <!--[--><!--]--></a><!----></li><li><a href="/fil/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="Keypairs and Wallets"><!--[--><!--]--> Keypairs and Wallets <!--[--><!--]--></a><!----></li><li><a href="/fil/references/basic-transactions.html" class="sidebar-item" aria-label="Sending Transactions"><!--[--><!--]--> Sending Transactions <!--[--><!--]--></a><!----></li><li><a href="/fil/references/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/fil/references/programs.html" class="sidebar-item" aria-label="Writing Programs"><!--[--><!--]--> Writing Programs <!--[--><!--]--></a><!----></li><li><a href="/fil/references/token.html" class="sidebar-item" aria-label="Interacting with Tokens"><!--[--><!--]--> Interacting with Tokens <!--[--><!--]--></a><!----></li><li><a href="/fil/references/staking.html" class="sidebar-item" aria-label="Staking"><!--[--><!--]--> Staking <!--[--><!--]--></a><!----></li><li><a href="/fil/references/nfts.html" class="sidebar-item" aria-label="NFTs"><!--[--><!--]--> NFTs <!--[--><!--]--></a><!----></li><li><a href="/fil/references/offline-transactions.html" class="sidebar-item" aria-label="Sending Offline Transactions"><!--[--><!--]--> Sending Offline Transactions <!--[--><!--]--></a><!----></li><li><a href="/fil/references/name-service.html" class="sidebar-item" aria-label="Name Service"><!--[--><!--]--> Name Service <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="pag-iimbak-ng-sol-sa-mga-pda-para-sa-mga-gantimpala-sa-laro" tabindex="-1"><a class="header-anchor" href="#pag-iimbak-ng-sol-sa-mga-pda-para-sa-mga-gantimpala-sa-laro" aria-hidden="true">#</a> Pag-iimbak ng SOL sa mga PDA para sa Mga Gantimpala sa Laro</h1><p>Walkthrough ng Video:</p><div class="video-block"><iframe width="320" height="200" src="https://www.youtube.com/embed/gILXyWvXu7M" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div><p>Live na Bersyon. (gamitin ang devnet)</p><iframe height="400" scrolling="no" title="OZXQWp" src="https://solplay.de/TinyAdventureTwo/index.html" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width:80%;">
</iframe><h2 id="tiny-adventure-anchor-program-ikalawang-bahagi" tabindex="-1"><a class="header-anchor" href="#tiny-adventure-anchor-program-ikalawang-bahagi" aria-hidden="true">#</a> Tiny Adventure Anchor Program - Ikalawang Bahagi</h2><p>Sa tutorial na ito, bubuuin namin ang larong Tiny Adventure at magpapakilala ng chest na may reward na 0.1 SOL. Ang dibdib ay &quot;spawn&quot; sa isang partikular na posisyon, at kapag naabot ng manlalaro ang posisyon na iyon, makakatanggap sila ng gantimpala. Ang layunin ng programang ito ay ipakita kung paano mag-imbak ng SOL sa loob ng isang account ng programa at ipamahagi ito sa mga manlalaro.</p><p>Ang Tiny Adventure Two Program ay binubuo ng 3 instruction:</p><ul><li><code>initialize_level_one</code> - Ang instruction na ito ay nagpapasimula ng dalawang on-chain na account: isa para sa pag-record ng posisyon ng player at isa pa para sa paghawak ng SOL reward na kumakatawan sa &quot;reward chest&quot;.</li><li><code>reset_level_and_spawn_chest</code> - Nire-reset ng instruction na ito ang posisyon ng player sa zero at &quot;re-respawn&quot; ang isang reward chest sa pamamagitan ng paglilipat ng SOL mula sa user na gumagamit ng instruction sa reward chest account.</li><li><code>move_right</code> - Ang pagtuturo na ito ay nagbibigay-daan sa manlalaro na ilipat ang kanilang posisyon sa kanan at kolektahin ang SOL sa reward chest kapag naabot na nila ang isang partikular na posisyon.</li></ul><p>Sa mga sumusunod na seksyon, gagabayan ka namin sa pagbuo ng programa nang sunud-sunod. Mahahanap mo ang kumpletong source code, na maaaring direktang i-deploy mula sa iyong browser gamit ang Solana Playground, sa link na ito: <a href="https://beta.solpg.io/tutorials/tiny-adventure-two" target="_blank" rel="noopener noreferrer">Open In Playground<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h3 id="nagsisimula" tabindex="-1"><a class="header-anchor" href="#nagsisimula" aria-hidden="true">#</a> Nagsisimula</h3><p>Upang simulan ang pagbuo ng larong Tiny Adventure, sundin ang mga hakbang na ito:</p><p>Bisitahin ang <a href="https://beta.solpg.io/" target="_blank" rel="noopener noreferrer">Solana Playground<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> at gumawa ng bagong Anchor project. Kung bago ka sa Solana Playground, kakailanganin mo ring gumawa ng Playground Wallet.</p><p>Pagkatapos gumawa ng bagong proyekto, palitan ang default na starter code ng code sa ibaba:</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>solana_program<span class="token punctuation">::</span>native_token<span class="token punctuation">::</span></span><span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span></span>system_program<span class="token punctuation">;</span>

<span class="token macro property">declare_id!</span><span class="token punctuation">(</span><span class="token string">&quot;11111111111111111111111111111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[program]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">tiny_adventure_two</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">print_player</span><span class="token punctuation">(</span>player_position<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> player_position <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;A Journey Begins!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;o.........💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> player_position <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;..o.......💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> player_position <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;....o.....💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> player_position <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;........\\o/💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;..........\\o/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;You have reached the end! Super!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>Sa larong ito, magsisimula ang manlalaro sa posisyon 0 at makakagalaw lamang sa kanan. Upang mailarawan ang pag-unlad ng manlalaro sa buong laro, gagamit kami ng mga log ng mensahe upang kumatawan sa kanilang paglalakbay patungo sa reward chest!</p><h3 id="pagtukoy-sa-chest-vault-account" tabindex="-1"><a class="header-anchor" href="#pagtukoy-sa-chest-vault-account" aria-hidden="true">#</a> Pagtukoy sa Chest Vault Account</h3><p>Idagdag ang <code>CHEST_REWARD</code> na pare-pareho sa simula ng programa. Ang <code>CHEST_REWARD</code> ay kumakatawan sa dami ng lamports na ilalagay sa chest at ibibigay bilang mga reward. Ang mga Lampor ay ang pinakamaliit na bahagi ng isang SOL, na may 1 bilyong lampor na katumbas ng 1 SOL.</p><p>Para mag-imbak ng SOL reward, tutukuyin namin ang isang bagong <code>ChestVaultAccount</code> struct. Isa itong walang laman na struct dahil direkta nating ia-update ang mga lamports sa account. Hahawakan ng account ang gantimpala ng SOL at hindi na kailangang mag-imbak ng anumang karagdagang data.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>solana_program<span class="token punctuation">::</span>native_token<span class="token punctuation">::</span></span><span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span></span>system_program<span class="token punctuation">;</span>

<span class="token macro property">declare_id!</span><span class="token punctuation">(</span><span class="token string">&quot;11111111111111111111111111111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[program]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">tiny_adventure_two</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token comment">// The amount of lamports that will be put into chests and given out as rewards.</span>
    <span class="token keyword">const</span> <span class="token constant">CHEST_REWARD</span><span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token constant">LAMPORTS_PER_SOL</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 0.1 SOL</span>
<span class="token punctuation">}</span>

<span class="token punctuation">...</span>

<span class="token comment">// Define the Chest Vault Account structure</span>
<span class="token attribute attr-name">#[account]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">ChestVaultAccount</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="pagtukoy-sa-game-data-account" tabindex="-1"><a class="header-anchor" href="#pagtukoy-sa-game-data-account" aria-hidden="true">#</a> Pagtukoy sa Game Data Account</h3><p>Upang masubaybayan ang posisyon ng manlalaro sa loob ng laro, kailangan nating tukuyin ang isang istraktura para sa on-chain na account na mag-iimbak ng posisyon ng manlalaro.</p><p>Ang <code>GameDataAccount</code> struct ay naglalaman ng isang field, <code>player_position</code>, na nag-iimbak ng kasalukuyang posisyon ng player bilang isang unsigned 8-bit integer.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>solana_program<span class="token punctuation">::</span>native_token<span class="token punctuation">::</span></span><span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span></span>system_program<span class="token punctuation">;</span>

<span class="token macro property">declare_id!</span><span class="token punctuation">(</span><span class="token string">&quot;11111111111111111111111111111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[program]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">tiny_adventure_two</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
    <span class="token punctuation">...</span>

<span class="token punctuation">}</span>

<span class="token punctuation">...</span>

<span class="token comment">// Define the Game Data Account structure</span>
<span class="token attribute attr-name">#[account]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">GameDataAccount</span> <span class="token punctuation">{</span>
    player_position<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Sa tinukoy na <code>GameDataAccount</code> struct, maaari mo na itong gamitin upang mag-imbak at mag-update ng posisyon ng player habang nakikipag-ugnayan sila sa laro. Habang ang manlalaro ay gumagalaw nang pakanan at sumusulong sa laro, ang kanilang posisyon ay ia-update sa loob ng <code>GameDataAccount</code>, na magbibigay-daan sa iyong subaybayan ang kanyang pag-usad patungo sa dibdib na naglalaman ng SOL reward.</p><h3 id="simulan-ang-level-one-instruction" tabindex="-1"><a class="header-anchor" href="#simulan-ang-level-one-instruction" aria-hidden="true">#</a> Simulan ang Level One Instruction</h3><p>Sa tinukoy na <code>GameDataAccount</code> at <code>ChestVaultAccount</code>, ipatupad natin ang instruction na <code>initialize_level_one</code>. Sinisimulan ng instruction na ito ang <code>GameDataAccount</code> at <code>ChestVaultAccount</code>, itinatakda ang posisyon ng manlalaro sa 0, at ipinapakita ang panimulang mensahe.</p><p>Ang instruction na <code>initialize_level_one</code> ay nangangailangan ng 4 na account:</p><ul><li><code>new_game_data_account</code> - ang <code>GameDataAccount</code> na sinisimulan nating iimbak ang posisyon ng player</li><li><code>chest_vault</code> - ang <code>ChestVaultAccount</code> na sinisimulan nating iimbak ang SOL reward</li><li><code>signer</code> - ang manlalaro na nagbabayad para sa pagsisimula ng mga account</li><li><code>system_program</code> - isang kinakailangang account kapag gumagawa ng bagong account</li></ul><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[program]</span>
<span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">tiny_adventure_two</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">initialize_level_one</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">InitializeLevelOne</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;A Journey Begins!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;o.......💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Specify the accounts required by the initialize_level_one instruction</span>
<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">InitializeLevelOne</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span>
        init_if_needed<span class="token punctuation">,</span>
        seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;level1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        bump<span class="token punctuation">,</span>
        payer <span class="token operator">=</span> signer<span class="token punctuation">,</span>
        space <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> new_game_data_account<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">GameDataAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span>
        init_if_needed<span class="token punctuation">,</span>
        seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;chestVault&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        bump<span class="token punctuation">,</span>
        payer <span class="token operator">=</span> signer<span class="token punctuation">,</span>
        space <span class="token operator">=</span> <span class="token number">8</span>
    <span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> chest_vault<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">ChestVaultAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> signer<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> system_program<span class="token punctuation">:</span> <span class="token class-name">Program</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token punctuation">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>Parehong ginawa ang <code>GameDataAccount</code> at <code>ChestVaultAccount</code> gamit ang Program Derived Address (PDA) bilang address ng account, na nagbibigay-daan sa amin na tiyak na mahanap ang address sa ibang pagkakataon. Tinitiyak ng hadlang na <code>init_if_needed</code> na ang mga account ay sinisimulan lamang kung wala pa ang mga ito. Dahil ang mga PDA para sa parehong mga account sa pagtuturo na ito ay gumagamit ng isang nakapirming binhi, ang aming programa ay maaari lamang lumikha ng isa sa bawat uri ng account. Sa katunayan, ang pagtuturo ay kakailanganin lamang na gamitin nang isang beses.</p><p>Kapansin-pansin na ang kasalukuyang pagpapatupad ay walang anumang mga paghihigpit sa kung sino ang maaaring baguhin ang <code>GameDataAccount</code>, na epektibong ginagawang isang multiplayer na karanasan ang laro kung saan makokontrol ng lahat ang paggalaw ng manlalaro.</p><p>Bilang kahalili, maaari mong gamitin ang address ng lumagda bilang isang karagdagang binhi sa pagtuturo na <code>pasimulan</code>, na nagpapahintulot sa bawat manlalaro na lumikha ng kanilang sariling <code>GameDataAccount</code>.</p><h3 id="i-reset-ang-antas-at-pagtuturo-sa-dibdib-ng-spawn" tabindex="-1"><a class="header-anchor" href="#i-reset-ang-antas-at-pagtuturo-sa-dibdib-ng-spawn" aria-hidden="true">#</a> I-reset ang Antas at Pagtuturo sa Dibdib ng Spawn</h3><p>Susunod, ipatupad natin ang instruction na <code>reset_level_and_spawn_chest</code>, na nagre-reset sa posisyon ng player sa simula at pinupuno ang dibdib ng reward na 0.1 SOL.</p><p>Ang pagtuturo sa <code>reset_level_and_spawn_chest</code> ay nangangailangan ng 4 na account:</p><ul><li><code>new_game_data_account</code> - ang <code>GameDataAccount</code> na nag-iimbak ng posisyon ng player</li><li><code>chest_vault</code> - ang <code>ChestVaultAccount</code> na nag-iimbak ng SOL reward</li><li><code>signer</code> - ang player na nagbibigay ng SOL reward para sa chest</li><li><code>system_program</code> - ang program na ipapatawag namin upang ilipat ang SOL gamit ang isang cross-program invocation (CPI), higit pa dito sa ilang sandali</li></ul><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[program]</span>
<span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">tiny_adventure_two</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
    <span class="token punctuation">...</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">reset_level_and_spawn_chest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">SpawnChest</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> cpi_context <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>
            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token namespace">system_program<span class="token punctuation">::</span></span><span class="token class-name">Transfer</span> <span class="token punctuation">{</span>
                from<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>payer<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                to<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>chest_vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">system_program<span class="token punctuation">::</span></span><span class="token function">transfer</span><span class="token punctuation">(</span>cpi_context<span class="token punctuation">,</span> <span class="token constant">CHEST_REWARD</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Level Reset and Chest Spawned at position 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Specify the accounts required by the reset_level_and_spawn_chest instruction</span>
<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">SpawnChest</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> payer<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span><span class="token keyword">mut</span><span class="token punctuation">,</span> seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;chestVault&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bump<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> chest_vault<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">ChestVaultAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> game_data_account<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">GameDataAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> system_program<span class="token punctuation">:</span> <span class="token class-name">Program</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token punctuation">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>Kasama sa instruction na ito ang cross-program invocation (CPI) para ilipat ang SOL mula sa nagbabayad patungo sa <code>ChestVaultAccount</code>. Ang cross-program invocation ay kapag ang isang programa ay nag-invoke ng pagtuturo sa isa pang programa. Sa kasong ito, gumagamit kami ng CPI para i-invoke ang instruction na <code>Transfer</code> mula sa <code>system_program</code> para ilipat ang SOL mula sa nagbabayad patungo sa <code>ChestVaultAccount</code>.</p><p>Ang mga cross-program invocations ay isang pangunahing konsepto sa Solana programming model, na nagbibigay-daan sa mga program na direktang makipag-ugnayan sa mga instruction mula sa iba pang mga program. Para sa mas malalim na pagsisid sa mga CPI, huwag mag-atubiling tuklasin ang mga aralin sa CPI na available sa <a href="https://www.soldev.app/course" target="_blank" rel="noopener noreferrer">Solana Course<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h3 id="pagtuturo-sa-pakanan" tabindex="-1"><a class="header-anchor" href="#pagtuturo-sa-pakanan" aria-hidden="true">#</a> Pagtuturo sa Pakanan</h3><p>Panghuli, ipatupad natin ang instruction na <code>move_right</code> na kinabibilangan ng logic para sa pagkolekta ng chest reward. Kapag naabot ng isang manlalaro ang posisyon 3 at naipasok ang tamang &quot;password&quot;, ililipat ang reward mula sa <strong><code>ChestVaultAccount</code></strong> papunta sa account ng manlalaro. Kung ang isang maling password ay ipinasok, isang custom na Anchor Error ay ibabalik. Kung ang manlalaro ay nasa posisyon 3 na, isang mensahe ang mai-log. Kung hindi, ang posisyon ay dagdagan ng 1 upang kumatawan sa paglipat sa kanan.</p><p>Ang pangunahing layunin ng functionality na &quot;password&quot; na ito ay upang ipakita kung paano isama ang mga parameter sa isang pagtuturo at ang pagpapatupad ng mga custom na Anchor Error para sa pinahusay na paghawak ng error. Sa halimbawang ito, ang tamang password ay magiging &quot;gib&quot;.</p><p>Ang instruction na <code>move_right</code> ay nangangailangan ng 3 account:</p><ul><li><code>new_game_data_account</code> - ang <code>GameDataAccount</code> na nag-iimbak ng posisyon ng player</li><li><code>chest_vault</code> - ang <code>ChestVaultAccount</code> na nag-iimbak ng SOL reward</li><li><code>player_wallet</code> - ang wallet ng player na humihiling ng pagtuturo at ang potensyal na tatanggap ng SOL reward</li></ul><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[program]</span>
<span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">tiny_adventure_two</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
    <span class="token punctuation">...</span>

    <span class="token comment">// Instruction to move right</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">move_right</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">MoveRight</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> game_data_account <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>game_data_account<span class="token punctuation">;</span>
        <span class="token keyword">if</span> game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
            <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;You have reached the end! Super!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> password <span class="token operator">!=</span> <span class="token string">&quot;gib&quot;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token macro property">err!</span><span class="token punctuation">(</span><span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">WrongPassword</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">=</span> game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

            <span class="token macro property">msg!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;You made it! Here is your reward {0} lamports&quot;</span><span class="token punctuation">,</span>
                <span class="token constant">CHEST_REWARD</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token operator">*</span><span class="token operator">*</span>ctx
                <span class="token punctuation">.</span>accounts
                <span class="token punctuation">.</span>chest_vault
                <span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">try_borrow_mut_lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">-=</span> <span class="token constant">CHEST_REWARD</span><span class="token punctuation">;</span>
            <span class="token operator">*</span><span class="token operator">*</span>ctx
                <span class="token punctuation">.</span>accounts
                <span class="token punctuation">.</span>player
                <span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">try_borrow_mut_lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">+=</span> <span class="token constant">CHEST_REWARD</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">=</span> game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">print_player</span><span class="token punctuation">(</span>game_data_account<span class="token punctuation">.</span>player_position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Specify the accounts required by the move_right instruction</span>
<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MoveRight</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span><span class="token keyword">mut</span><span class="token punctuation">,</span> seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;chestVault&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bump<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> chest_vault<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">ChestVaultAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> game_data_account<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">GameDataAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> player<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Custom Anchor Error</span>
<span class="token attribute attr-name">#[error_code]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">MyError</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[msg(<span class="token string">&quot;Password was wrong&quot;</span>)]</span>
    <span class="token class-name">WrongPassword</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token punctuation">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>Upang ilipat ang mga lampor mula sa reward chest papunta sa player account, hindi kami maaaring gumamit ng Cross-Program Invocation (CPI) tulad ng ginawa namin dati, dahil ang <code>ChestVaultAccount</code> ay hindi pagmamay-ari ng system program. Sa halip, direkta nating binabago ang mga lamport sa loob ng mga account sa pamamagitan ng paggamit ng <code>try_borrow_mut_laports</code>. Tandaan na ang account na iyong ibinabawas sa mga laport ay dapat na isang signer, at palaging tinitiyak ng runtime na ang kabuuang balanse ng account ay mananatiling pantay pagkatapos ng isang transaksyon.</p><p>Tandaan na ang Program Derived Accounts (PDAs) ay nag-aalok ng dalawang pangunahing feature:</p><ol><li>Magbigay ng isang tiyak na paraan upang mahanap ang address ng isang account</li><li>Payagan ang programa kung saan nagmula ang isang PDA na &quot;mag-sign&quot; para sa kanila</li></ol><p>Ito ang dahilan kung bakit namin nagagawang ibawas ang mga lampor mula sa <code>ChestVaultAccount</code> nang hindi tahasang nangangailangan ng dagdag na pumirma para sa pagtuturo.</p><h3 id="bumuo-at-i-deploy" tabindex="-1"><a class="header-anchor" href="#bumuo-at-i-deploy" aria-hidden="true">#</a> Bumuo at I-deploy</h3><p>Mahusay na trabaho! Nakumpleto mo na ngayon ang ikalawang bahagi ng programang Tiny Adventure! Ang iyong huling programa ay dapat magmukhang ganito:</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>solana_program<span class="token punctuation">::</span>native_token<span class="token punctuation">::</span></span><span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span></span>system_program<span class="token punctuation">;</span>

<span class="token comment">// This is your program&#39;s public key and it will update</span>
<span class="token comment">// automatically when you build the project.</span>
<span class="token macro property">declare_id!</span><span class="token punctuation">(</span><span class="token string">&quot;7gZTdZg86YsYbs92Rhv63kZUAkoww1kLexJg8sNpgVQ3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[program]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">tiny_adventure_two</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token comment">// The amount of lamports that will be put into chests and given out as rewards.</span>
    <span class="token keyword">const</span> <span class="token constant">CHEST_REWARD</span><span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token constant">LAMPORTS_PER_SOL</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 0.1 SOL</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">initialize_level_one</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">InitializeLevelOne</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Usually in your production code you would not print lots of text because it cost compute units.</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;A Journey Begins!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;o.......💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">reset_level_and_spawn_chest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">SpawnChest</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> cpi_context <span class="token operator">=</span> <span class="token class-name">CpiContext</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>
            ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>system_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token namespace">system_program<span class="token punctuation">::</span></span><span class="token class-name">Transfer</span> <span class="token punctuation">{</span>
                from<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>payer<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                to<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>chest_vault<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">system_program<span class="token punctuation">::</span></span><span class="token function">transfer</span><span class="token punctuation">(</span>cpi_context<span class="token punctuation">,</span> <span class="token constant">CHEST_REWARD</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Level Reset and Chest Spawned at position 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">move_right</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">MoveRight</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> game_data_account <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>game_data_account<span class="token punctuation">;</span>
        <span class="token keyword">if</span> game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
            <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;You have reached the end! Super!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> password <span class="token operator">!=</span> <span class="token string">&quot;gib&quot;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token macro property">err!</span><span class="token punctuation">(</span><span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">WrongPassword</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">=</span> game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

            <span class="token macro property">msg!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;You made it! Here is your reward {0} lamports&quot;</span><span class="token punctuation">,</span>
                <span class="token constant">CHEST_REWARD</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token operator">*</span><span class="token operator">*</span>ctx
                <span class="token punctuation">.</span>accounts
                <span class="token punctuation">.</span>chest_vault
                <span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">try_borrow_mut_lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">-=</span> <span class="token constant">CHEST_REWARD</span><span class="token punctuation">;</span>
            <span class="token operator">*</span><span class="token operator">*</span>ctx
                <span class="token punctuation">.</span>accounts
                <span class="token punctuation">.</span>player
                <span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">try_borrow_mut_lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">+=</span> <span class="token constant">CHEST_REWARD</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">=</span> game_data_account<span class="token punctuation">.</span>player_position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">print_player</span><span class="token punctuation">(</span>game_data_account<span class="token punctuation">.</span>player_position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">print_player</span><span class="token punctuation">(</span>player_position<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> player_position <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;A Journey Begins!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;o.........💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> player_position <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;..o.......💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> player_position <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;....o.....💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> player_position <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;........\\o/💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;..........\\o/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;You have reached the end! Super!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">InitializeLevelOne</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Dapat nating tukuyin ang espasyo upang makapagsimula ng account.</span>
    <span class="token comment">// Ang unang 8 byte ay default na discriminator ng account,</span>
    <span class="token comment">// ang susunod na 1 byte ay mula sa NewAccount.data na uri u8.</span>
    <span class="token comment">// (u8 = 8 bits unsigned integer = 8 bytes)</span>
    <span class="token comment">// Maaari mo ring gamitin ang lumagda bilang seed [signer.key().as_ref()],</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span>
        init_if_needed<span class="token punctuation">,</span>
        seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;level1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        bump<span class="token punctuation">,</span>
        payer <span class="token operator">=</span> signer<span class="token punctuation">,</span>
        space <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> new_game_data_account<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">GameDataAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token comment">// Ito ang PDA kung saan idedeposito natin ang reward na SOL at</span>
    <span class="token comment">// mula sa kung saan ipinadala namin ito pabalik sa unang manlalaro na umabot sa dibdib.</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span>
        init_if_needed<span class="token punctuation">,</span>
        seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;chestVault&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        bump<span class="token punctuation">,</span>
        payer <span class="token operator">=</span> signer<span class="token punctuation">,</span>
        space <span class="token operator">=</span> <span class="token number">8</span>
    <span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> chest_vault<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">ChestVaultAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> signer<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> system_program<span class="token punctuation">:</span> <span class="token class-name">Program</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">SpawnChest</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> payer<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span><span class="token keyword">mut</span><span class="token punctuation">,</span> seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;chestVault&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bump<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> chest_vault<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">ChestVaultAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> game_data_account<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">GameDataAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> system_program<span class="token punctuation">:</span> <span class="token class-name">Program</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">MoveRight</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span><span class="token keyword">mut</span><span class="token punctuation">,</span> seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;chestVault&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bump<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> chest_vault<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">ChestVaultAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> game_data_account<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">GameDataAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> player<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[account]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">GameDataAccount</span> <span class="token punctuation">{</span>
    player_position<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[account]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">ChestVaultAccount</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token attribute attr-name">#[error_code]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">MyError</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[msg(<span class="token string">&quot;Password was wrong&quot;</span>)]</span>
    <span class="token class-name">WrongPassword</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br></div></div><p>Ngayong kumpleto na ang programa, buuin at i-deploy natin ito gamit ang Solana Playground!</p><p>Kung bago ka sa Solana Playground, magsimula sa paggawa ng Playground Wallet at tiyaking nakakonekta ka sa isang Devnet endpoint. Susunod, patakbuhin <code>solana airdrop 2</code> hanggang magkaroon ka ng 6 na SOL. Kapag mayroon kang sapat na SOL, buuin at i-deploy ang programa.</p><h3 id="magsimula-sa-kliyente" tabindex="-1"><a class="header-anchor" href="#magsimula-sa-kliyente" aria-hidden="true">#</a> Magsimula sa Kliyente</h3><p>Sa seksyong ito, tatalakayin natin ang isang simpleng pagpapatupad sa panig ng kliyente para sa pakikipag-ugnayan sa laro. Sisirain namin ang code at magbibigay ng mga detalyadong paliwanag para sa bawat hakbang. Upang makapagsimula, mag-navigate sa <code>client.ts</code> na file sa Solana Playground, alisin ang placeholder code, at idagdag ang mga snippet ng code mula sa mga sumusunod na seksyon.</p><p>Una, kunin natin ang mga PDA (Program Derived Addresses) para sa <code>GameDataAccount</code> at <code>ChestVaultAccount</code>. Ang PDA ay isang natatanging address sa format ng isang pampublikong susi, na hinango gamit ang ID ng programa at mga karagdagang binhi.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// The PDA adress everyone will be able to control the character if the interact with your program</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>globalLevel1GameDataAccount<span class="token punctuation">,</span> bump<span class="token punctuation">]</span> <span class="token operator">=</span>
  <span class="token keyword">await</span> anchor<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>PublicKey<span class="token punctuation">.</span><span class="token function">findProgramAddress</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;level1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//[pg.wallet.publicKey.toBuffer()], &lt;- You could also add the player wallet as a seed, then you would have one instance per player. Need to also change the seed in the rust part</span>
    pg<span class="token punctuation">.</span>program<span class="token punctuation">.</span>programId
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This is where the program will save the sol reward for the chests and from which the reward will be payed out again</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>chestVaultAccount<span class="token punctuation">,</span> chestBump<span class="token punctuation">]</span> <span class="token operator">=</span>
  <span class="token keyword">await</span> anchor<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>PublicKey<span class="token punctuation">.</span><span class="token function">findProgramAddress</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;chestVault&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    pg<span class="token punctuation">.</span>program<span class="token punctuation">.</span>programId
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Susunod, tatawagin namin ang instruction na <code>initializeLevelOne</code> para i-set up ang <code>GameDataAccount</code> at <code>ChestVaultAccount</code>.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Initialize level</span>
<span class="token keyword">let</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> pg<span class="token punctuation">.</span>program<span class="token punctuation">.</span>methods
  <span class="token punctuation">.</span><span class="token function">initializeLevelOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">accounts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">chestVault</span><span class="token operator">:</span> chestVaultAccount<span class="token punctuation">,</span>
    <span class="token literal-property property">newGameDataAccount</span><span class="token operator">:</span> globalLevel1GameDataAccount<span class="token punctuation">,</span>
    <span class="token literal-property property">signer</span><span class="token operator">:</span> pg<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token literal-property property">systemProgram</span><span class="token operator">:</span> web3<span class="token punctuation">.</span>SystemProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">signers</span><span class="token punctuation">(</span><span class="token punctuation">[</span>pg<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>keypair<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Use &#39;solana confirm -v </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39; to see the logs</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> pg<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>txHash<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> balance <span class="token operator">=</span> <span class="token keyword">await</span> pg<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>pg<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My balance before spawning a chest: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>balance <span class="token operator">/</span> web3<span class="token punctuation">.</span><span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Pagkatapos nito, gagamitin namin ang instruction na <code>resetLevelAndSpawnChest</code> para itakda ang posisyon ng player sa 0 at punan ang <code>ChestVaultAccount</code> ng 0.1 SOL.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Set the player position back to 0 and pay to fill up the chest with sol</span>
txHash <span class="token operator">=</span> <span class="token keyword">await</span> pg<span class="token punctuation">.</span>program<span class="token punctuation">.</span>methods
  <span class="token punctuation">.</span><span class="token function">resetLevelAndSpawnChest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">accounts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">chestVault</span><span class="token operator">:</span> chestVaultAccount<span class="token punctuation">,</span>
    <span class="token literal-property property">gameDataAccount</span><span class="token operator">:</span> globalLevel1GameDataAccount<span class="token punctuation">,</span>
    <span class="token literal-property property">payer</span><span class="token operator">:</span> pg<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token literal-property property">systemProgram</span><span class="token operator">:</span> web3<span class="token punctuation">.</span>SystemProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">signers</span><span class="token punctuation">(</span><span class="token punctuation">[</span>pg<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>keypair<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Use &#39;solana confirm -v </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39; to see the logs</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> pg<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>txHash<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Level reset and chest spawned 💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;o........💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Ngayon ay maaari na tayong makipag-ugnayan sa laro sa pamamagitan ng pagtawag sa <code>moveRight</code> na pagtuturo. Sa halimbawang ito, uulitin namin ang instruction na ito hanggang sa maabot ng manlalaro ang posisyon upang mangolekta ng reward mula sa <code>ChestVaultAccount</code>.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token comment">// Here we move to the right three times and collect the chest at the end of the level</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  txHash <span class="token operator">=</span> <span class="token keyword">await</span> pg<span class="token punctuation">.</span>program<span class="token punctuation">.</span>methods
    <span class="token punctuation">.</span><span class="token function">moveRight</span><span class="token punctuation">(</span><span class="token string">&quot;gib&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">accounts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">chestVault</span><span class="token operator">:</span> chestVaultAccount<span class="token punctuation">,</span>
      <span class="token literal-property property">gameDataAccount</span><span class="token operator">:</span> globalLevel1GameDataAccount<span class="token punctuation">,</span>
      <span class="token literal-property property">player</span><span class="token operator">:</span> pg<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">signers</span><span class="token punctuation">(</span><span class="token punctuation">[</span>pg<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>keypair<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">rpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Use &#39;solana confirm -v </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39; to see the logs</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> pg<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>txHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> balance <span class="token operator">=</span> <span class="token keyword">await</span> pg<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>pg<span class="token punctuation">.</span>wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My balance: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>balance <span class="token operator">/</span> web3<span class="token punctuation">.</span><span class="token constant">LAMPORTS_PER_SOL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> SOL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> gameDateAccount <span class="token operator">=</span> <span class="token keyword">await</span> pg<span class="token punctuation">.</span>program<span class="token punctuation">.</span>account<span class="token punctuation">.</span>gameDataAccount<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>
    globalLevel1GameDataAccount
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Player position is:&quot;</span><span class="token punctuation">,</span> gameDateAccount<span class="token punctuation">.</span>playerPosition<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>gameDateAccount<span class="token punctuation">.</span>playerPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A journey begins...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;o........💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;....o....💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;......o..💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;.........\\o/💎&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;...........\\o/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>Panghuli, pindutin ang &quot;Run&quot; na buton sa Solana Playground para i-execute ang client. Kapag nag-input ka ng kahit ano maliban sa &quot;gib&quot; bilang password para sa <strong><code>moveRight</code></strong> na pagtuturo, dapat mong makita ang sumusunod na mensahe ng error kapag naabot mo ang posisyon upang i-claim ang chest reward:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Error Code: WrongPassword. Error Number: 6000. Error Message: Password was wrong.
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Gayunpaman, kung ipinasok mo ang tamang password, ang output ay dapat maging katulad ng sumusunod:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Running client...
  client.ts:
    Use &#39;solana confirm -v CX8VWV5Jp1kXDkZrTdeeyibgZg3B3cXAzchzCfNHvJoqARSGHeEU5injypxFwiKFcHPcWFG9BeNSrqZAdENtL2t&#39; to see the logs
    My balance before spawning a chest: 6.396630254 SOL
    Use &#39;solana confirm -v 3HwAS1RK7beL3mGoNdFYWteJXF3NdJXiEskJrHtuJ6Tu9ow67Zo3yScQBEPQyish33hP8WyuVanmq93wEFJ2LQcx&#39; to see the logs
    Level reset and chest spawned 💎
    o........💎
    Use &#39;solana confirm -v 43KnGrx5VQYd8LctsNaNqN1hg69vE6wiiTbdxTC1uM3Hasnq7ZdM9zWx4JS39AKNz2FpQr9a3ZnEA7XscEzmXQ5U&#39; to see the logs
    My balance: 6.296620254 SOL
    Player position is: 1
    ....o....💎
    Use &#39;solana confirm -v AGxYWDw49d4y5dLon5M42eu1qG8g2Yf7FeTr3Dpbf1uFXnMeUzp4XWmHyQP1YRNpT8acz4aTJU9f2FQpL6BSAkY&#39; to see the logs
    My balance: 6.296615254 SOL
    Player position is: 2
    ......o..💎
    Use &#39;solana confirm -v 5pjAU5NrS4u91QLWZTvo9aXBtR3c6g981UGSxrWDoDW5MehXnx5LnAxu4jKLp1p75RKpVSgMBgg2zHX3WDyci7AK&#39; to see the logs
    My balance: 6.396610254 SOL
    Player position is: 3
    .........\o/💎
    ...........\o/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Magaling! Matagumpay kang nakagawa, na-deploy, at nakipag-ugnayan sa Tiny Adventure Two mula sa panig ng kliyente. Nagsama ka ng bagong feature na nagbibigay-daan sa mga manlalaro na mangolekta ng mga reward sa pamamagitan ng pag-abot sa dibdib sa dulo ng level. Bukod dito, natutunan mo kung paano maglipat ng SOL sa loob ng isang Anchor program gamit ang mga cross-program invocations at sa pamamagitan ng direktang pagbabago ng mga lampor sa mga account.</p><p>Huwag mag-atubiling magpatuloy sa pagbuo nang nakapag-iisa at pahusayin ang laro gamit ang mga karagdagang feature tulad ng mga bagong level o alternatibong reward!</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: kimerran@users.noreply.github.com">mh</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.07ce7a66.js" defer></script>
  </body>
</html>
