<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Libro de recetas de Solana | Referencia de programas en Solana"><meta name="og:title" content="Libro de recetas de Solana | Referencia de programas en Solana"><meta name="description" content="Aprende cómo escribir programas en Solana con referencias de invocación entre programas, lectura de cuentas y más"><meta name="og:description" content="Aprende cómo escribir programas en Solana con referencias de invocación entre programas, lectura de cuentas y más"><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Escribiendo Programas | Solana Cookbook</title>
    <link rel="modulepreload" href="/assets/app.07ce7a66.js"><link rel="modulepreload" href="/assets/programs.html.96b262ce.js"><link rel="modulepreload" href="/assets/programs.html.dec531fb.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/es/" class=""><!----><span class="site-name can-hide">Solana Cookbook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribuir"><!--[--><!--]--> Contribuir <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/references/programs.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/references/programs.html" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/es/references/programs.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/references/programs.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/references/programs.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/references/programs.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/references/programs.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/references/programs.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/references/programs.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/references/programs.html" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/references/programs.html" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/references/programs.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/references/programs.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribuir"><!--[--><!--]--> Contribuir <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/references/programs.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/references/programs.html" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/es/references/programs.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/references/programs.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/references/programs.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/references/programs.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/references/programs.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/references/programs.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/references/programs.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/references/programs.html" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/references/programs.html" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/references/programs.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/references/programs.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Primeros pasos <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/es/" class="sidebar-item" aria-label="Libro de recetas de Solana"><!--[--><!--]--> Libro de recetas de Solana <!--[--><!--]--></a><!----></li><li><a href="/es/getting-started/installation.html" class="sidebar-item" aria-label="Instalación"><!--[--><!--]--> Instalación <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Conceptos clave <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/es/core-concepts/accounts.html" class="sidebar-item" aria-label="Cuentas"><!--[--><!--]--> Cuentas <!--[--><!--]--></a><!----></li><li><a href="/es/core-concepts/programs.html" class="sidebar-item" aria-label="Programas"><!--[--><!--]--> Programas <!--[--><!--]--></a><!----></li><li><a href="/es/core-concepts/transactions.html" class="sidebar-item" aria-label="Transacciones"><!--[--><!--]--> Transacciones <!--[--><!--]--></a><!----></li><li><a href="/es/core-concepts/pdas.html" class="sidebar-item" aria-label="Direcciones derivadas de programa (PDAs)"><!--[--><!--]--> Direcciones derivadas de programa (PDAs) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Guías <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/es/guides/get-program-accounts.html" class="sidebar-item" aria-label="Obtener cuentas de programa"><!--[--><!--]--> Obtener cuentas de programa <!--[--><!--]--></a><!----></li><li><a href="/es/guides/serialization.html" class="sidebar-item" aria-label="Serializando datos"><!--[--><!--]--> Serializando datos <!--[--><!--]--></a><!----></li><li><a href="/es/guides/data-migration.html" class="sidebar-item" aria-label="Migrando cuentas de datos de programas"><!--[--><!--]--> Migrando cuentas de datos de programas <!--[--><!--]--></a><!----></li><li><a href="/es/guides/account-maps.html" class="sidebar-item" aria-label="Cómo usar Map en cuentas"><!--[--><!--]--> Cómo usar Map en cuentas <!--[--><!--]--></a><!----></li><li><a href="/es/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="Depurando Programas en Solana"><!--[--><!--]--> Depurando Programas en Solana <!--[--><!--]--></a><!----></li><li><a href="/es/guides/feature-parity-testing.html" class="sidebar-item" aria-label="Prueba de paridad de características"><!--[--><!--]--> Prueba de paridad de características <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Referencias <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/es/references/local-development.html" class="sidebar-item" aria-label="Desarrollo en entorno local"><!--[--><!--]--> Desarrollo en entorno local <!--[--><!--]--></a><!----></li><li><a href="/es/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="Pares de llaves y billeteras"><!--[--><!--]--> Pares de llaves y billeteras <!--[--><!--]--></a><!----></li><li><a href="/es/references/basic-transactions.html" class="sidebar-item" aria-label="Enviando transacciones"><!--[--><!--]--> Enviando transacciones <!--[--><!--]--></a><!----></li><li><a href="/es/references/accounts.html" class="sidebar-item" aria-label="Cuentas"><!--[--><!--]--> Cuentas <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/es/references/programs.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Escribiendo Programas"><!--[--><!--]--> Escribiendo Programas <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/es/references/programs.html#como-transferir-sol-a-un-programa" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cómo transferir SOL a un programa"><!--[--><!--]--> Cómo transferir SOL a un programa <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/es/references/programs.html#como-obtener-una-referencia-al-reloj-en-un-programa" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cómo obtener una referencia al reloj en un programa"><!--[--><!--]--> Cómo obtener una referencia al reloj en un programa <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/es/references/programs.html#enviando-clock-como-una-cuenta-dentro-de-una-instruccion" class="router-link-active router-link-exact-active sidebar-item" aria-label="Enviando Clock cómo una cuenta dentro de una instrucción"><!--[--><!--]--> Enviando Clock cómo una cuenta dentro de una instrucción <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/es/references/programs.html#accediendo-al-reloj-directamente-dentro-de-una-instruccion" class="router-link-active router-link-exact-active sidebar-item" aria-label="Accediendo al reloj directamente dentro de una instrucción"><!--[--><!--]--> Accediendo al reloj directamente dentro de una instrucción <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/es/references/programs.html#como-cambiar-el-tamano-de-una-cuenta" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cómo cambiar el tamaño de una cuenta"><!--[--><!--]--> Cómo cambiar el tamaño de una cuenta <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/es/references/programs.html#como-hacer-una-invocacion-entre-programas-cross-program-invocation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cómo hacer una invocación entre programas (Cross Program Invocation)"><!--[--><!--]--> Cómo hacer una invocación entre programas (Cross Program Invocation) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/es/references/programs.html#como-crear-una-cuenta-derivada-de-programa-pda" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cómo crear una cuenta derivada de programa (PDA)"><!--[--><!--]--> Cómo crear una cuenta derivada de programa (PDA) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/es/references/programs.html#como-leer-cuentas" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cómo leer cuentas"><!--[--><!--]--> Cómo leer cuentas <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/es/references/programs.html#como-verificar-cuentas" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cómo verificar cuentas"><!--[--><!--]--> Cómo verificar cuentas <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/es/references/programs.html#como-leer-multiples-instrucciones-de-una-transaccion" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cómo leer múltiples instrucciones de una transacción"><!--[--><!--]--> Cómo leer múltiples instrucciones de una transacción <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/es/references/token.html" class="sidebar-item" aria-label="Interactuando con tokens"><!--[--><!--]--> Interactuando con tokens <!--[--><!--]--></a><!----></li><li><a href="/es/references/staking.html" class="sidebar-item" aria-label="Staking"><!--[--><!--]--> Staking <!--[--><!--]--></a><!----></li><li><a href="/es/references/nfts.html" class="sidebar-item" aria-label="NFTs"><!--[--><!--]--> NFTs <!--[--><!--]--></a><!----></li><li><a href="/es/references/offline-transactions.html" class="sidebar-item" aria-label="Enviando transacciones offline"><!--[--><!--]--> Enviando transacciones offline <!--[--><!--]--></a><!----></li><li><a href="/es/references/name-service.html" class="sidebar-item" aria-label="Servicio de nombres"><!--[--><!--]--> Servicio de nombres <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="escribiendo-programas" tabindex="-1"><a class="header-anchor" href="#escribiendo-programas" aria-hidden="true">#</a> Escribiendo Programas</h1><h2 id="como-transferir-sol-a-un-programa" tabindex="-1"><a class="header-anchor" href="#como-transferir-sol-a-un-programa" aria-hidden="true">#</a> Cómo transferir SOL a un programa</h2><p>Tu programa en Solana puede transferir lamports de una cuenta a otra sin &#39;invocar&#39; al programa del Sistema (System Program). La regla fundamental es que tu programa puede transferir lamports desde cualquier cuenta <strong>propiedad</strong> de tu programa a cualquier cuenta.</p><p>La cuenta del destinatario <em>no tiene que ser</em> una cuenta propiedad de tu programa.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Program</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">/// Transfers lamports from one account (must be program owned)</span>
<span class="token comment">/// to another account. The recipient can by any account</span>
<span class="token keyword">fn</span> <span class="token function-definition function">transfer_service_fee_lamports</span><span class="token punctuation">(</span>
    from_account<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">AccountInfo</span><span class="token punctuation">,</span>
    to_account<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">AccountInfo</span><span class="token punctuation">,</span>
    amount_of_lamports<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token comment">// Does the from account have enough lamports to transfer?</span>
    <span class="token keyword">if</span> <span class="token operator">*</span><span class="token operator">*</span>from_account<span class="token punctuation">.</span><span class="token function">try_borrow_lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">&lt;</span> amount_of_lamports <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">CustomError</span><span class="token punctuation">::</span><span class="token class-name">InsufficientFundsForTransaction</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Debit from_account and credit to_account</span>
    <span class="token operator">*</span><span class="token operator">*</span>from_account<span class="token punctuation">.</span><span class="token function">try_borrow_mut_lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">-=</span> amount_of_lamports<span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token operator">*</span>to_account<span class="token punctuation">.</span><span class="token function">try_borrow_mut_lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">+=</span> amount_of_lamports<span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Primary function handler associated with instruction sent</span>
<span class="token comment">/// to your program</span>
<span class="token keyword">fn</span> <span class="token function-definition function">instruction_handler</span><span class="token punctuation">(</span>accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the &#39;from&#39; and &#39;to&#39; accounts</span>
    <span class="token keyword">let</span> account_info_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> from_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>account_info_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> to_service_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>account_info_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Extract a service &#39;fee&#39; of 5 lamports for performing this instruction</span>
    <span class="token function">transfer_service_fee_lamports</span><span class="token punctuation">(</span>from_account<span class="token punctuation">,</span> to_service_account<span class="token punctuation">,</span> <span class="token number">5u64</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Perform the primary instruction</span>
    <span class="token comment">// ... etc.</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><!--]--></div><!--]--></div><h2 id="como-obtener-una-referencia-al-reloj-en-un-programa" tabindex="-1"><a class="header-anchor" href="#como-obtener-una-referencia-al-reloj-en-un-programa" aria-hidden="true">#</a> Cómo obtener una referencia al reloj en un programa</h2><p>Se puede obtener un reloj de dos maneras:</p><ol><li>Enviando <code>SYSVAR_CLOCK_PUBKEY</code> en una instrucción</li><li>Accediendo a Clock directamente dentro de una instrucción.</li></ol><p>Es bueno conocer ambos métodos porque algunos programas antiguos aún esperan <code>SYSVAR_CLOCK_PUBKEY</code> cómo una cuenta.</p><h3 id="enviando-clock-como-una-cuenta-dentro-de-una-instruccion" tabindex="-1"><a class="header-anchor" href="#enviando-clock-como-una-cuenta-dentro-de-una-instruccion" aria-hidden="true">#</a> Enviando Clock cómo una cuenta dentro de una instrucción</h3><p>Vamos a crear una instrucción que reciba una cuenta para inicializar y la clave pública de sysvar</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">account_info<span class="token punctuation">::</span></span><span class="token punctuation">{</span>next_account_info<span class="token punctuation">,</span> <span class="token class-name">AccountInfo</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token class-name">Clock</span><span class="token punctuation">,</span>
    entrypoint<span class="token punctuation">,</span>
    <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
    msg<span class="token punctuation">,</span>
    <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token namespace">sysvar<span class="token punctuation">::</span></span><span class="token class-name">Sysvar</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">entrypoint!</span><span class="token punctuation">(</span>process_instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(BorshSerialize, BorshDeserialize, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">HelloState</span> <span class="token punctuation">{</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Accounts required</span>
<span class="token comment">/// 1. [signer, writable] Payer</span>
<span class="token comment">/// 2. [writable] Hello state account</span>
<span class="token comment">/// 3. [] Clock sys var</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    _program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Payer account</span>
    <span class="token keyword">let</span> _payer_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Hello state account</span>
    <span class="token keyword">let</span> hello_state_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Clock sysvar</span>
    <span class="token keyword">let</span> sysvar_clock_pubkey <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> hello_state <span class="token operator">=</span> <span class="token class-name">HelloState</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hello_state_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    hello_state<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    hello_state<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> hello_state_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Account initialized :)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Type casting [AccountInfo] to [Clock]</span>
    <span class="token keyword">let</span> clock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">from_account_info</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sysvar_clock_pubkey<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Getting timestamp</span>
    <span class="token keyword">let</span> current_timestamp <span class="token operator">=</span> clock<span class="token punctuation">.</span>unix_timestamp<span class="token punctuation">;</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Current Timestamp: {}&quot;</span><span class="token punctuation">,</span> current_timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> clock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">from_account_info</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sysvar_clock_pubkey<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> current_timestamp <span class="token operator">=</span> clock<span class="token punctuation">.</span>unix_timestamp<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><!--]--></div></div><!--]--></div><p>Ahora enviamos la dirección pública de la variable del sistema (sysvar) del reloj desde el cliente</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
  SystemProgram<span class="token punctuation">,</span>
  <span class="token constant">SYSVAR_CLOCK_PUBKEY</span><span class="token punctuation">,</span>
  Transaction<span class="token punctuation">,</span>
  TransactionInstruction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;77ezihTV6mTh2Uf3ggwbYF2NyGJJ5HHah1GrdowWJVD3&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Airdropping 1 SOL</span>
  <span class="token keyword">const</span> feePayer <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>
    <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>feePayer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Hello state account</span>
  <span class="token keyword">const</span> helloAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> accountSpace <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// because there exists just one boolean variable</span>
  <span class="token keyword">const</span> rentRequired <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    accountSpace
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allocating space for hello state account</span>
  <span class="token keyword">const</span> allocateHelloAccountIx <span class="token operator">=</span> SystemProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fromPubkey<span class="token operator">:</span> feePayer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> rentRequired<span class="token punctuation">,</span>
    newAccountPubkey<span class="token operator">:</span> helloAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    space<span class="token operator">:</span> accountSpace<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Passing Clock Sys Var</span>
  <span class="token keyword">const</span> passClockIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> feePayer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> helloAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">SYSVAR_CLOCK_PUBKEY</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>allocateHelloAccountIx<span class="token punctuation">,</span> passClockIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    feePayer<span class="token punctuation">,</span>
    helloAccount<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Transaction succeeded. TxHash: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;77ezihTV6mTh2Uf3ggwbYF2NyGJJ5HHah1GrdowWJVD3&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Passing Clock Sys Var</span>
  <span class="token keyword">const</span> passClockIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> helloAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        is_signer<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        is_writable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">SYSVAR_CLOCK_PUBKEY</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>passClockIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    feePayer<span class="token punctuation">,</span>
    helloAccount<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Transaction succeeded. TxHash: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><!--]--></div></div><!--]--></div><h3 id="accediendo-al-reloj-directamente-dentro-de-una-instruccion" tabindex="-1"><a class="header-anchor" href="#accediendo-al-reloj-directamente-dentro-de-una-instruccion" aria-hidden="true">#</a> Accediendo al reloj directamente dentro de una instrucción</h3><p>Creemos la misma instrucción pero sin esperar <code>SYSVAR_CLOCK_PUBKEY</code> desde el cliente</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">account_info<span class="token punctuation">::</span></span><span class="token punctuation">{</span>next_account_info<span class="token punctuation">,</span> <span class="token class-name">AccountInfo</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token class-name">Clock</span><span class="token punctuation">,</span>
    entrypoint<span class="token punctuation">,</span>
    <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
    msg<span class="token punctuation">,</span>
    <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token namespace">sysvar<span class="token punctuation">::</span></span><span class="token class-name">Sysvar</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">entrypoint!</span><span class="token punctuation">(</span>process_instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(BorshSerialize, BorshDeserialize, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">HelloState</span> <span class="token punctuation">{</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Accounts required</span>
<span class="token comment">/// 1. [signer, writable] Payer</span>
<span class="token comment">/// 2. [writable] Hello state account</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    _program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Payer account</span>
    <span class="token keyword">let</span> _payer_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Hello state account</span>
    <span class="token keyword">let</span> hello_state_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Getting clock directly</span>
    <span class="token keyword">let</span> clock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> hello_state <span class="token operator">=</span> <span class="token class-name">HelloState</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hello_state_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    hello_state<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    hello_state<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> hello_state_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Account initialized :)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Getting timestamp</span>
    <span class="token keyword">let</span> current_timestamp <span class="token operator">=</span> clock<span class="token punctuation">.</span>unix_timestamp<span class="token punctuation">;</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Current Timestamp: {}&quot;</span><span class="token punctuation">,</span> current_timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> clock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> current_timestamp <span class="token operator">=</span> clock<span class="token punctuation">.</span>unix_timestamp<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><!--]--></div></div><!--]--></div><p>La instrucción del cliente ahora solo necesita enviar el estado y las cuentas que pagan la transacción</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
  SystemProgram<span class="token punctuation">,</span>
  Transaction<span class="token punctuation">,</span>
  TransactionInstruction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;4ZEdbCtb5UyCSiAMHV5eSHfyjq3QwbG3yXb6oHD7RYjk&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Airdropping 1 SOL</span>
  <span class="token keyword">const</span> feePayer <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>
    <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>feePayer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Hello state account</span>
  <span class="token keyword">const</span> helloAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> accountSpace <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// because there exists just one boolean variable</span>
  <span class="token keyword">const</span> rentRequired <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    accountSpace
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allocating space for hello state account</span>
  <span class="token keyword">const</span> allocateHelloAccountIx <span class="token operator">=</span> SystemProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fromPubkey<span class="token operator">:</span> feePayer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> rentRequired<span class="token punctuation">,</span>
    newAccountPubkey<span class="token operator">:</span> helloAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    space<span class="token operator">:</span> accountSpace<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> initIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> feePayer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> helloAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>allocateHelloAccountIx<span class="token punctuation">,</span> initIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    feePayer<span class="token punctuation">,</span>
    helloAccount<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Transaction succeeded. TxHash: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;4ZEdbCtb5UyCSiAMHV5eSHfyjq3QwbG3yXb6oHD7RYjk&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// No more requirement to pass clock sys var key</span>
  <span class="token keyword">const</span> initAccountIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> helloAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>initAccountIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    feePayer<span class="token punctuation">,</span>
    helloAccount<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Transaction succeeded. TxHash: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="como-cambiar-el-tamano-de-una-cuenta" tabindex="-1"><a class="header-anchor" href="#como-cambiar-el-tamano-de-una-cuenta" aria-hidden="true">#</a> Cómo cambiar el tamaño de una cuenta</h2><p>Puede cambiar el tamaño de una cuenta propiedad del programa con el uso de <code>realloc</code>. <code>realloc</code> puede cambiar el tamaño de una cuenta hasta 10 KB. Cuando uses <code>realloc</code> para aumentar el tamaño de una cuenta, debes transferir lamports para mantener esa cuenta exenta de alquiler.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token punctuation">{</span>
  <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token punctuation">{</span>
      <span class="token namespace">instruction<span class="token punctuation">::</span></span><span class="token class-name">WhitelistInstruction</span><span class="token punctuation">,</span>
      <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">WhiteListData</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
      <span class="token namespace">account_info<span class="token punctuation">::</span></span><span class="token punctuation">{</span>next_account_info<span class="token punctuation">,</span> <span class="token class-name">AccountInfo</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
      msg<span class="token punctuation">,</span>
      <span class="token namespace">program<span class="token punctuation">::</span></span>invoke_signed<span class="token punctuation">,</span>
      <span class="token namespace">program<span class="token punctuation">::</span></span>invoke<span class="token punctuation">,</span>
      <span class="token namespace">program_error<span class="token punctuation">::</span></span><span class="token class-name">ProgramError</span><span class="token punctuation">,</span>
      <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
      <span class="token namespace">sysvar<span class="token punctuation">::</span></span><span class="token class-name">Sysvar</span><span class="token punctuation">,</span>
      <span class="token namespace">sysvar<span class="token punctuation">::</span>rent<span class="token punctuation">::</span></span><span class="token class-name">Rent</span><span class="token punctuation">,</span>
      system_instruction<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token namespace">std<span class="token punctuation">::</span>convert<span class="token punctuation">::</span></span><span class="token class-name">TryInto</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
  _program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
  accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
  <span class="token comment">// Length = BOOL + VEC + Pubkey * n (n = number of keys)</span>
  <span class="token keyword">const</span> <span class="token constant">INITIAL_ACCOUNT_LEN</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">0</span> <span class="token punctuation">;</span>
  <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;input: {:?}&quot;</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> instruction <span class="token operator">=</span> <span class="token class-name">WhitelistInstruction</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> funding_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> pda_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> system_program <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token keyword">match</span> instruction <span class="token punctuation">{</span>
    <span class="token class-name">WhitelistInstruction</span><span class="token punctuation">::</span><span class="token class-name">Initialize</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Initialize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> <span class="token punctuation">(</span>pda<span class="token punctuation">,</span> pda_bump<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token class-name">Pubkey</span><span class="token punctuation">::</span><span class="token function">find_program_address</span><span class="token punctuation">(</span>
          <span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token string">b&quot;customaddress&quot;</span><span class="token punctuation">,</span>
            <span class="token operator">&amp;</span>funding_account<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">to_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          _program_id<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> signers_seeds<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
          <span class="token string">b&quot;customaddress&quot;</span><span class="token punctuation">,</span>
          <span class="token operator">&amp;</span>funding_account<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">to_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token operator">&amp;</span><span class="token punctuation">[</span>pda_bump<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
      
      <span class="token keyword">if</span> pda<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pda_account<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">let</span> lamports_required <span class="token operator">=</span> <span class="token class-name">Rent</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">minimum_balance</span><span class="token punctuation">(</span><span class="token constant">INITIAL_ACCOUNT_LEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> create_pda_account_ix <span class="token operator">=</span> <span class="token namespace">system_instruction<span class="token punctuation">::</span></span><span class="token function">create_account</span><span class="token punctuation">(</span>
          <span class="token operator">&amp;</span>funding_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
          <span class="token operator">&amp;</span>pda_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
          lamports_required<span class="token punctuation">,</span>
          <span class="token constant">INITIAL_ACCOUNT_LEN</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token operator">&amp;</span>_program_id<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">invoke_signed</span><span class="token punctuation">(</span>
          <span class="token operator">&amp;</span>create_pda_account_ix<span class="token punctuation">,</span>
          <span class="token operator">&amp;</span><span class="token punctuation">[</span>
              funding_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              pda_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              system_program<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token operator">&amp;</span><span class="token punctuation">[</span>signers_seeds<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
      
      <span class="token keyword">let</span> <span class="token keyword">mut</span> pda_account_state <span class="token operator">=</span> <span class="token class-name">WhiteListData</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pda_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

      pda_account_state<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      pda_account_state<span class="token punctuation">.</span>white_list <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pda_account_state<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> pda_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
      <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">WhitelistInstruction</span><span class="token punctuation">::</span><span class="token class-name">AddKey</span> <span class="token punctuation">{</span> key <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;AddKey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> <span class="token keyword">mut</span> pda_account_state <span class="token operator">=</span> <span class="token class-name">WhiteListData</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pda_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
      
      <span class="token keyword">if</span> <span class="token operator">!</span>pda_account_state<span class="token punctuation">.</span>is_initialized <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">let</span> new_size <span class="token operator">=</span> pda_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> rent <span class="token operator">=</span> <span class="token class-name">Rent</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> new_minimum_balance <span class="token operator">=</span> rent<span class="token punctuation">.</span><span class="token function">minimum_balance</span><span class="token punctuation">(</span>new_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">let</span> lamports_diff <span class="token operator">=</span> new_minimum_balance<span class="token punctuation">.</span><span class="token function">saturating_sub</span><span class="token punctuation">(</span>pda_account<span class="token punctuation">.</span><span class="token function">lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">invoke</span><span class="token punctuation">(</span>
          <span class="token operator">&amp;</span><span class="token namespace">system_instruction<span class="token punctuation">::</span></span><span class="token function">transfer</span><span class="token punctuation">(</span>funding_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span> pda_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span> lamports_diff<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token operator">&amp;</span><span class="token punctuation">[</span>
              funding_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              pda_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              system_program<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

      pda_account<span class="token punctuation">.</span><span class="token function">realloc</span><span class="token punctuation">(</span>new_size<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

      pda_account_state<span class="token punctuation">.</span>white_list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      pda_account_state<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> pda_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

      <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// adding a publickey to the account</span>
<span class="token keyword">let</span> new_size <span class="token operator">=</span> pda_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rent <span class="token operator">=</span> <span class="token class-name">Rent</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> new_minimum_balance <span class="token operator">=</span> rent<span class="token punctuation">.</span><span class="token function">minimum_balance</span><span class="token punctuation">(</span>new_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> lamports_diff <span class="token operator">=</span> new_minimum_balance<span class="token punctuation">.</span><span class="token function">saturating_sub</span><span class="token punctuation">(</span>pda_account<span class="token punctuation">.</span><span class="token function">lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">invoke</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span><span class="token namespace">system_instruction<span class="token punctuation">::</span></span><span class="token function">transfer</span><span class="token punctuation">(</span>funding_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span> pda_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span> lamports_diff<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span><span class="token punctuation">[</span>
        funding_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        pda_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        system_program<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

pda_account<span class="token punctuation">.</span><span class="token function">realloc</span><span class="token punctuation">(</span>new_size<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="como-hacer-una-invocacion-entre-programas-cross-program-invocation" tabindex="-1"><a class="header-anchor" href="#como-hacer-una-invocacion-entre-programas-cross-program-invocation" aria-hidden="true">#</a> Cómo hacer una invocación entre programas (Cross Program Invocation)</h2><p>Una invocación de programa cruzada (Cross Program Invocation), simplemente llama a la instrucción de otro programa dentro del nuestro. Un buen ejemplo es el <code>swap</code> de Uniswap. El contrato <code>UniswapV2Router</code>, llama a la lógica necesaria para hacer swap, y llama a la función de transferencia del contrato <code>ERC20</code> para hacer swap de una persona a otra. De la misma manera, podemos llamer a la instrucción de un programa de acuerdo a nuestras necesidades.</p><p>Echemos un vistazo a nuestro primer ejemplo, que es la instrucción <code>Transferencia del Programa Token SPL</code>. Las cuentas requeridas para que la transferencia ocurra son:</p><ol><li>La cuenta de token de origin (La cuenta donde tenemos los tokens)</li><li>La cuenta de token de destino (La cuenta a la que le vamos a transferir los tokens)</li><li>La cuenta principal del dueño de los tokens a transferir (La dirección con la que vamos a firmar)</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">account_info<span class="token punctuation">::</span></span><span class="token punctuation">{</span>next_account_info<span class="token punctuation">,</span> <span class="token class-name">AccountInfo</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    entrypoint<span class="token punctuation">,</span>
    <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
    msg<span class="token punctuation">,</span>
    <span class="token namespace">program<span class="token punctuation">::</span></span>invoke<span class="token punctuation">,</span>
    <span class="token namespace">program_error<span class="token punctuation">::</span></span><span class="token class-name">ProgramError</span><span class="token punctuation">,</span>
    <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">spl_token<span class="token punctuation">::</span>instruction<span class="token punctuation">::</span></span>transfer<span class="token punctuation">;</span>

<span class="token macro property">entrypoint!</span><span class="token punctuation">(</span>process_instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Accounts required</span>
<span class="token comment">/// 1. [writable] Source Token Account</span>
<span class="token comment">/// 2. [writable] Destination Token Account</span>
<span class="token comment">/// 3. [signer] Source Token Account holder&#39;s PubKey</span>
<span class="token comment">/// 4. [] Token Program</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    _program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Accounts required for token transfer</span>

    <span class="token comment">// 1. Token account we hold</span>
    <span class="token keyword">let</span> source_token_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. Token account to send to</span>
    <span class="token keyword">let</span> destination_token_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. Our wallet address</span>
    <span class="token keyword">let</span> source_token_account_holder <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// 4. Token Program</span>
    <span class="token keyword">let</span> token_program <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Parsing the token transfer amount from instruction data</span>
    <span class="token comment">// a. Getting the 0th to 8th index of the u8 byte array</span>
    <span class="token comment">// b. Converting the obtained non zero u8 to a proper u8 (as little endian integers)</span>
    <span class="token comment">// c. Converting the little endian integers to a u64 number</span>
    <span class="token keyword">let</span> token_transfer_amount <span class="token operator">=</span> instruction_data
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token number">8</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>slice<span class="token closure-punctuation punctuation">|</span></span> slice<span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">u64</span><span class="token punctuation">::</span>from_le_bytes<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">msg!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Transferring {} tokens from {} to {}&quot;</span><span class="token punctuation">,</span>
        token_transfer_amount<span class="token punctuation">,</span>
        source_token_account<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        destination_token_account<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Creating a new TransactionInstruction</span>
    <span class="token comment">/*
        Internal representation of the instruction&#39;s return value (Result&lt;Instruction, ProgramError&gt;)

        Ok(Instruction {
            program_id: *token_program_id, // PASSED FROM USER
            accounts,
            data,
        })
    */</span>

    <span class="token keyword">let</span> transfer_tokens_instruction <span class="token operator">=</span> <span class="token function">transfer</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>token_program<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>source_token_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>destination_token_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>source_token_account_holder<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>source_token_account_holder<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
        token_transfer_amount<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> required_accounts_for_transfer <span class="token operator">=</span> <span class="token punctuation">[</span>
        source_token_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        destination_token_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        source_token_account_holder<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Passing the TransactionInstruction to send</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>transfer_tokens_instruction<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>required_accounts_for_transfer<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Transfer successful&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> token_transfer_amount <span class="token operator">=</span> instruction_data
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>slice<span class="token closure-punctuation punctuation">|</span></span> slice<span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">u64</span><span class="token punctuation">::</span>from_le_bytes<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> transfer_tokens_instruction <span class="token operator">=</span> <span class="token function">transfer</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span>token_program<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>source_token_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>destination_token_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>source_token_account_holder<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>source_token_account_holder<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
    token_transfer_amount<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> required_accounts_for_transfer <span class="token operator">=</span> <span class="token punctuation">[</span>
    source_token_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    destination_token_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    source_token_account_holder<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">invoke</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span>transfer_tokens_instruction<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>required_accounts_for_transfer<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><!--]--></div></div><!--]--></div><br> La instrucción del cliente sería la siguiente. Para conocer las instrucciones de creación de token y mint, consulte el código completo. <br><br><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
  SystemProgram<span class="token punctuation">,</span>
  Transaction<span class="token punctuation">,</span>
  TransactionInstruction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  AccountLayout<span class="token punctuation">,</span>
  MintLayout<span class="token punctuation">,</span>
  Token<span class="token punctuation">,</span>
  <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
  u64<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/spl-token&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">BN</span> <span class="token keyword">from</span> <span class="token string">&quot;bn.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Users</span>
<span class="token keyword">const</span> <span class="token constant">PAYER_KEYPAIR</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">RECEIVER_KEYPAIR</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">;</span>

<span class="token comment">// Mint and token accounts</span>
<span class="token keyword">const</span> <span class="token constant">TOKEN_MINT_ACCOUNT</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SOURCE_TOKEN_ACCOUNT</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">DESTINATION_TOKEN_ACCOUNT</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Numbers</span>
<span class="token keyword">const</span> <span class="token constant">DEFAULT_DECIMALS_COUNT</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TOKEN_TRANSFER_AMOUNT</span> <span class="token operator">=</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">**</span> <span class="token constant">DEFAULT_DECIMALS_COUNT</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TOKEN_TRANSFER_AMOUNT_BUFFER</span> <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>
  Uint8Array<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">BN</span></span><span class="token punctuation">(</span><span class="token constant">TOKEN_TRANSFER_AMOUNT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token string">&quot;le&quot;</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;EfYK91eN3AqTwY1C34W6a33qGAtQ8HJYVhNv7cV4uMZj&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> mintDataSpace <span class="token operator">=</span> MintLayout<span class="token punctuation">.</span>span<span class="token punctuation">;</span>
  <span class="token keyword">const</span> mintRentRequired <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    mintDataSpace
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> tokenDataSpace <span class="token operator">=</span> AccountLayout<span class="token punctuation">.</span>span<span class="token punctuation">;</span>
  <span class="token keyword">const</span> tokenRentRequired <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getMinimumBalanceForRentExemption</span><span class="token punctuation">(</span>
    tokenDataSpace
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Airdropping some SOL</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>
    <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span><span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allocating space and rent for mint account</span>
  <span class="token keyword">const</span> createMintAccountIx <span class="token operator">=</span> SystemProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fromPubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> mintRentRequired<span class="token punctuation">,</span>
    newAccountPubkey<span class="token operator">:</span> <span class="token constant">TOKEN_MINT_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    programId<span class="token operator">:</span> <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
    space<span class="token operator">:</span> mintDataSpace<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Initializing mint with decimals and authority</span>
  <span class="token keyword">const</span> initializeMintIx <span class="token operator">=</span> Token<span class="token punctuation">.</span><span class="token function">createInitMintInstruction</span><span class="token punctuation">(</span>
    <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
    <span class="token constant">TOKEN_MINT_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">DEFAULT_DECIMALS_COUNT</span><span class="token punctuation">,</span>
    <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token comment">// mintAuthority</span>
    <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey <span class="token comment">// freezeAuthority</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allocating space and rent for source token account</span>
  <span class="token keyword">const</span> createSourceTokenAccountIx <span class="token operator">=</span> SystemProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fromPubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    newAccountPubkey<span class="token operator">:</span> <span class="token constant">SOURCE_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> tokenRentRequired<span class="token punctuation">,</span>
    programId<span class="token operator">:</span> <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
    space<span class="token operator">:</span> tokenDataSpace<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Initializing token account with mint and owner</span>
  <span class="token keyword">const</span> initializeSourceTokenAccountIx <span class="token operator">=</span> Token<span class="token punctuation">.</span><span class="token function">createInitAccountInstruction</span><span class="token punctuation">(</span>
    <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
    <span class="token constant">TOKEN_MINT_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">SOURCE_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Minting tokens to the source token account for transferring later to destination account</span>
  <span class="token keyword">const</span> mintTokensIx <span class="token operator">=</span> Token<span class="token punctuation">.</span><span class="token function">createMintToInstruction</span><span class="token punctuation">(</span>
    <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
    <span class="token constant">TOKEN_MINT_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">SOURCE_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token constant">TOKEN_TRANSFER_AMOUNT</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Allocating space and rent for destination token account</span>
  <span class="token keyword">const</span> createDestinationTokenAccountIx <span class="token operator">=</span> SystemProgram<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fromPubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    newAccountPubkey<span class="token operator">:</span> <span class="token constant">DESTINATION_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    lamports<span class="token operator">:</span> tokenRentRequired<span class="token punctuation">,</span>
    programId<span class="token operator">:</span> <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
    space<span class="token operator">:</span> tokenDataSpace<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Initializing token account with mint and owner</span>
  <span class="token keyword">const</span> initializeDestinationTokenAccountIx <span class="token operator">=</span>
    Token<span class="token punctuation">.</span><span class="token function">createInitAccountInstruction</span><span class="token punctuation">(</span>
      <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
      <span class="token constant">TOKEN_MINT_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token constant">DESTINATION_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token constant">RECEIVER_KEYPAIR</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Our program&#39;s CPI instruction (transfer)</span>
  <span class="token keyword">const</span> transferTokensIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token constant">TOKEN_TRANSFER_AMOUNT_BUFFER</span><span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">SOURCE_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">DESTINATION_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Adding up all the above instructions</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
    createMintAccountIx<span class="token punctuation">,</span>
    initializeMintIx<span class="token punctuation">,</span>
    createSourceTokenAccountIx<span class="token punctuation">,</span>
    initializeSourceTokenAccountIx<span class="token punctuation">,</span>
    mintTokensIx<span class="token punctuation">,</span>
    createDestinationTokenAccountIx<span class="token punctuation">,</span>
    initializeDestinationTokenAccountIx<span class="token punctuation">,</span>
    transferTokensIx
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">,</span>
    <span class="token constant">TOKEN_MINT_ACCOUNT</span><span class="token punctuation">,</span>
    <span class="token constant">SOURCE_TOKEN_ACCOUNT</span><span class="token punctuation">,</span>
    <span class="token constant">DESTINATION_TOKEN_ACCOUNT</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Token transfer CPI success: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;EfYK91eN3AqTwY1C34W6a33qGAtQ8HJYVhNv7cV4uMZj&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transferTokensIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token constant">TOKEN_TRANSFER_AMOUNT_BUFFER</span><span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">SOURCE_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">DESTINATION_TOKEN_ACCOUNT</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">TOKEN_PROGRAM_ID</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>transferTokensIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">,</span>
    <span class="token constant">TOKEN_MINT_ACCOUNT</span><span class="token punctuation">,</span>
    <span class="token constant">SOURCE_TOKEN_ACCOUNT</span><span class="token punctuation">,</span>
    <span class="token constant">DESTINATION_TOKEN_ACCOUNT</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Token transfer CPI success: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><!--]--></div></div><!--]--></div><p>Ahora echemos un vistazo a otro ejemplo, que es la instrucción <code>create_account</code> del programa del sistema. Hay una ligera diferencia entre la instrucción mencionada anteriormente y esta. En la anterior, nunca tuvimos que pasar <code>token_program</code> como una de las cuentas dentro de la función <code>invoke</code>. Sin embargo, hay excepciones en las que debe pasar el <code>program_id</code> de la instrucción de invocación. En nuestro caso, sería el id_programa del &#39;Programa del sistema&#39; (&quot;111111111111111111111111111111111&quot;). Así que ahora las cuentas requeridas serían:</p><ol><li>La cuenta del pagador de la renta</li><li>La cuenta que va a ser creada</li><li>La cuenta del programa del sistema</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">account_info<span class="token punctuation">::</span></span><span class="token punctuation">{</span>next_account_info<span class="token punctuation">,</span> <span class="token class-name">AccountInfo</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    entrypoint<span class="token punctuation">,</span>
    <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
    msg<span class="token punctuation">,</span>
    <span class="token namespace">program<span class="token punctuation">::</span></span>invoke<span class="token punctuation">,</span>
    <span class="token namespace">program_error<span class="token punctuation">::</span></span><span class="token class-name">ProgramError</span><span class="token punctuation">,</span>
    <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token namespace">rent<span class="token punctuation">::</span></span><span class="token class-name">Rent</span><span class="token punctuation">,</span>
    <span class="token namespace">system_instruction<span class="token punctuation">::</span></span>create_account<span class="token punctuation">,</span>
    <span class="token namespace">sysvar<span class="token punctuation">::</span></span><span class="token class-name">Sysvar</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">entrypoint!</span><span class="token punctuation">(</span>process_instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Accounts required</span>
<span class="token comment">/// 1. [signer, writable] Payer Account</span>
<span class="token comment">/// 2. [signer, writable] General State Account</span>
<span class="token comment">/// 3. [] System Program</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Accounts required for token transfer</span>

    <span class="token comment">// 1. Payer account for the state account creation</span>
    <span class="token keyword">let</span> payer_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. Token account we hold</span>
    <span class="token keyword">let</span> general_state_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// 3. System Program</span>
    <span class="token keyword">let</span> system_program <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">msg!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Creating account for {}&quot;</span><span class="token punctuation">,</span>
        general_state_account<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Parsing the token transfer amount from instruction data</span>
    <span class="token comment">// a. Getting the 0th to 8th index of the u8 byte array</span>
    <span class="token comment">// b. Converting the obtained non zero u8 to a proper u8 (as little endian integers)</span>
    <span class="token comment">// c. Converting the little endian integers to a u64 number</span>
    <span class="token keyword">let</span> account_span <span class="token operator">=</span> instruction_data
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token number">8</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>slice<span class="token closure-punctuation punctuation">|</span></span> slice<span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">u64</span><span class="token punctuation">::</span>from_le_bytes<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> lamports_required <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Rent</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minimum_balance</span><span class="token punctuation">(</span>account_span <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Creating a new TransactionInstruction</span>
    <span class="token comment">/*
        Internal representation of the instruction&#39;s return value (Instruction)

        Instruction::new_with_bincode(
            system_program::id(), // NOT PASSED FROM USER
            &amp;SystemInstruction::CreateAccount {
                lamports,
                space,
                owner: *owner,
            },
            account_metas,
        )
    */</span>

    <span class="token keyword">let</span> create_account_instruction <span class="token operator">=</span> <span class="token function">create_account</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>payer_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>general_state_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        lamports_required<span class="token punctuation">,</span>
        account_span<span class="token punctuation">,</span>
        program_id<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> required_accounts_for_create <span class="token operator">=</span> <span class="token punctuation">[</span>
        payer_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        general_state_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        system_program<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Passing the TransactionInstruction to send (with the issused program_id)</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>create_account_instruction<span class="token punctuation">,</span> <span class="token operator">&amp;</span>required_accounts_for_create<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Transfer successful&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> account_span <span class="token operator">=</span> instruction_data
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>slice<span class="token closure-punctuation punctuation">|</span></span> slice<span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">u64</span><span class="token punctuation">::</span>from_le_bytes<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> lamports_required <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Rent</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minimum_balance</span><span class="token punctuation">(</span>account_span <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> create_account_instruction <span class="token operator">=</span> <span class="token function">create_account</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span>payer_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>general_state_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    lamports_required<span class="token punctuation">,</span>
    account_span<span class="token punctuation">,</span>
    program_id<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> required_accounts_for_create <span class="token operator">=</span> <span class="token punctuation">[</span>
    payer_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    general_state_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    system_program<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">invoke</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>create_account_instruction<span class="token punctuation">,</span> <span class="token operator">&amp;</span>required_accounts_for_create<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><!--]--></div></div><!--]--></div><p>El código del lado del cliente se verá de la siguiente manera:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> clusterApiUrl<span class="token punctuation">,</span> Connection<span class="token punctuation">,</span> Keypair <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span> PublicKey<span class="token punctuation">,</span> SystemProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Transaction<span class="token punctuation">,</span> TransactionInstruction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">BN</span> <span class="token keyword">from</span> <span class="token string">&quot;bn.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Users</span>
<span class="token keyword">const</span> <span class="token constant">PAYER_KEYPAIR</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">GENERAL_STATE_KEYPAIR</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">ACCOUNT_SPACE_BUFFER</span> <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>
  Uint8Array<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">BN</span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token string">&quot;le&quot;</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;DkuQ5wsndkzXfgqDB6Lgf4sDjBi4gkLSak1dM5Mn2RuQ&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Airdropping some SOL</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>
    <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span><span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Our program&#39;s CPI instruction (create_account)</span>
  <span class="token keyword">const</span> createAccountIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token constant">ACCOUNT_SPACE_BUFFER</span><span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">GENERAL_STATE_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> SystemProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Adding up all the above instructions</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>createAccountIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">,</span>
    <span class="token constant">GENERAL_STATE_KEYPAIR</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Create Account CPI Success: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;DkuQ5wsndkzXfgqDB6Lgf4sDjBi4gkLSak1dM5Mn2RuQ&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Airdropping some SOL</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>
    <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span><span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Our program&#39;s CPI instruction (create_account)</span>
  <span class="token keyword">const</span> creataAccountIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token constant">ACCOUNT_SPACE_BUFFER</span><span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">GENERAL_STATE_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> SystemProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Adding up all the above instructions</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>creataAccountIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">,</span>
    <span class="token constant">GENERAL_STATE_KEYPAIR</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Create Account CPI Success: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="como-crear-una-cuenta-derivada-de-programa-pda" tabindex="-1"><a class="header-anchor" href="#como-crear-una-cuenta-derivada-de-programa-pda" aria-hidden="true">#</a> Cómo crear una cuenta derivada de programa (PDA)</h2><p>Una dirección derivada del programa es simplemente una cuenta propiedad del programa, pero no tiene clave privada. En cambio, su firma se obtiene mediante un conjunto de semillas y un &quot;bump&quot; (un número que asegura que está fuera de la curva). &quot;<strong>Generar</strong>&quot; una dirección de programa es diferente de &quot;<strong>crearla</strong>&quot;. Se puede generar un PDA usando <code>Pubkey::find_program_address</code>. Crear un PDA esencialmente significa inicializar la dirección con espacio y establecer el estado. Se puede crear una cuenta Keypair normal fuera de nuestro programa y luego enviarla para inicializar su estado. Desafortunadamente, para las PDA, se tienen que crear en la blockchain, debido a la naturaleza de no poder firmar en su nombre. Por lo tanto, usamos <code>invoke_signed</code> para pasar las semillas de la PDA, junto con la firma de la cuenta de fondos, lo que da como resultado la creación de la cuenta de una PDA.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">account_info<span class="token punctuation">::</span></span><span class="token punctuation">{</span>next_account_info<span class="token punctuation">,</span> <span class="token class-name">AccountInfo</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    entrypoint<span class="token punctuation">,</span>
    <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
    <span class="token namespace">program<span class="token punctuation">::</span></span>invoke_signed<span class="token punctuation">,</span>
    <span class="token namespace">program_error<span class="token punctuation">::</span></span><span class="token class-name">ProgramError</span><span class="token punctuation">,</span>
    <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token namespace">rent<span class="token punctuation">::</span></span><span class="token class-name">Rent</span><span class="token punctuation">,</span>
    system_instruction<span class="token punctuation">,</span>
    <span class="token namespace">sysvar<span class="token punctuation">::</span></span><span class="token class-name">Sysvar</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">entrypoint!</span><span class="token punctuation">(</span>process_instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(BorshSerialize, BorshDeserialize, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">HelloState</span> <span class="token punctuation">{</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Accounts required</span>
<span class="token comment">/// 1. [signer, writable] Funding account</span>
<span class="token comment">/// 2. [writable] PDA account</span>
<span class="token comment">/// 3. [] System Program</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">ACCOUNT_DATA_LEN</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Getting required accounts</span>
    <span class="token keyword">let</span> funding_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> pda_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> system_program <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Getting PDA Bump from instruction data</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>pda_bump<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> instruction_data
        <span class="token punctuation">.</span><span class="token function">split_first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidInstructionData</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Checking if passed PDA and expected PDA are equal</span>
    <span class="token keyword">let</span> signers_seeds<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
        <span class="token string">b&quot;customaddress&quot;</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>funding_account<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">to_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">*</span>pda_bump<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> pda <span class="token operator">=</span> <span class="token class-name">Pubkey</span><span class="token punctuation">::</span><span class="token function">create_program_address</span><span class="token punctuation">(</span>signers_seeds<span class="token punctuation">,</span> program_id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> pda<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pda_account<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Assessing required lamports and creating transaction instruction</span>
    <span class="token keyword">let</span> lamports_required <span class="token operator">=</span> <span class="token class-name">Rent</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">minimum_balance</span><span class="token punctuation">(</span><span class="token constant">ACCOUNT_DATA_LEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> create_pda_account_ix <span class="token operator">=</span> <span class="token namespace">system_instruction<span class="token punctuation">::</span></span><span class="token function">create_account</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>funding_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>pda_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        lamports_required<span class="token punctuation">,</span>
        <span class="token constant">ACCOUNT_DATA_LEN</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>program_id<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Invoking the instruction but with PDAs as additional signer</span>
    <span class="token function">invoke_signed</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>create_pda_account_ix<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span><span class="token punctuation">[</span>
            funding_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            pda_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            system_program<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span><span class="token punctuation">[</span>signers_seeds<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Setting state for PDA</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> pda_account_state <span class="token operator">=</span> <span class="token class-name">HelloState</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pda_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    pda_account_state<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    pda_account_state<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> pda_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> create_pda_account_ix <span class="token operator">=</span> <span class="token namespace">system_instruction<span class="token punctuation">::</span></span><span class="token function">create_account</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span>funding_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>pda_account<span class="token punctuation">.</span>key<span class="token punctuation">,</span>
    lamports_required<span class="token punctuation">,</span>
    <span class="token constant">ACCOUNT_DATA_LEN</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>program_id<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">invoke_signed</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span>create_pda_account_ix<span class="token punctuation">,</span>
    <span class="token operator">&amp;</span><span class="token punctuation">[</span>funding_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pda_account<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span><span class="token punctuation">[</span>signers_seeds<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><!--]--></div></div><!--]--></div><p>Uno puede enviar las cuentas requeridas a través del cliente de la siguiente manera</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
  SystemProgram<span class="token punctuation">,</span>
  Transaction<span class="token punctuation">,</span>
  TransactionInstruction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">PAYER_KEYPAIR</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;6eW5nnSosr2LpkUGCdznsjRGDhVb26tLmiM1P8RV1QQp&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Airdop to Payer</span>
  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>
    <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span><span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>pda<span class="token punctuation">,</span> bump<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> PublicKey<span class="token punctuation">.</span><span class="token function">findProgramAddress</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;customaddress&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">.</span><span class="token function">toBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    programId
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">PDA Pubkey: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pda<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> createPDAIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    data<span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>Uint8Array<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>bump<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> pda<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> SystemProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>createPDAIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Created PDA successfully. Tx Hash: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token constant">PAYER_KEYPAIR</span> <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> programId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>
    <span class="token string">&quot;6eW5nnSosr2LpkUGCdznsjRGDhVb26tLmiM1P8RV1QQp&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>pda<span class="token punctuation">,</span> bump<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> PublicKey<span class="token punctuation">.</span><span class="token function">findProgramAddress</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;customaddress&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">.</span><span class="token function">toBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    programId
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> createPDAIx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    programId<span class="token operator">:</span> programId<span class="token punctuation">,</span>
    data<span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>Uint8Array<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>bump<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> <span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> pda<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isWritable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        pubkey<span class="token operator">:</span> SystemProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>createPDAIx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> txHash <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>transaction<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token constant">PAYER_KEYPAIR</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="como-leer-cuentas" tabindex="-1"><a class="header-anchor" href="#como-leer-cuentas" aria-hidden="true">#</a> Cómo leer cuentas</h2><p>Casi todas las instrucciones en Solana requerirían al menos 2 o 3 cuentas, y se mencionarían sobre los controladores de instrucciones en qué orden espera ese conjunto de cuentas. Es bastante simple si aprovechamos el método <code>iter()</code> en Rust, en lugar de indicar manualmente las cuentas. El método <code>next_account_info</code> básicamente obtiene el primer índice del iterable y devuelve la cuenta presente dentro de la matriz de cuentas. Veamos una instrucción simple que espera varias cuentas y requiere analizar cada una de ellas.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">account_info<span class="token punctuation">::</span></span><span class="token punctuation">{</span>next_account_info<span class="token punctuation">,</span> <span class="token class-name">AccountInfo</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    entrypoint<span class="token punctuation">,</span>
    <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
    <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">entrypoint!</span><span class="token punctuation">(</span>process_instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(BorshSerialize, BorshDeserialize, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">HelloState</span> <span class="token punctuation">{</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Accounts required</span>
<span class="token comment">/// 1. [signer] Payer</span>
<span class="token comment">/// 2. [writable] Hello state account</span>
<span class="token comment">/// 3. [] Rent account</span>
<span class="token comment">/// 4. [] System Program</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    _program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token comment">// Fetching all the accounts as a iterator (facilitating for loops and iterations)</span>
    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Payer account</span>
    <span class="token keyword">let</span> payer_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Hello state account</span>
    <span class="token keyword">let</span> hello_state_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Rent account</span>
    <span class="token keyword">let</span> rent_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// System Program</span>
    <span class="token keyword">let</span> system_program <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    _program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token comment">// Fetching all the accounts as a iterator (facilitating for loops and iterations)</span>
    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Payer account</span>
    <span class="token keyword">let</span> payer_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Hello state account</span>
    <span class="token keyword">let</span> hello_state_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Rent account</span>
    <span class="token keyword">let</span> rent_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// System Program</span>
    <span class="token keyword">let</span> system_program <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="como-verificar-cuentas" tabindex="-1"><a class="header-anchor" href="#como-verificar-cuentas" aria-hidden="true">#</a> Cómo verificar cuentas</h2><p>Dado que los programas en Solana no tienen estado, nosotros, como creadores de programas, debemos asegurarnos de que las cuentas pasadas se validen tanto como sea posible para evitar cualquier entrada de cuentas maliciosas. Las comprobaciones básicas que se pueden hacer son</p><ol><li>Validar si el el firmante esperado ha firmado</li><li>Validar si el estado de la cuenta está como escribible</li><li>Validar si el dueño del estado de la cuenta es el id del programa</li><li>Validar si la cuenta ya fue inicializada</li><li>Validar si los ids de programas que se envían (cuando se necesite) son los esperados</li></ol><p>A continuación se define una instrucción básica que inicializa una cuenta de estado de héroe, pero con las comprobaciones mencionadas anteriormente.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">account_info<span class="token punctuation">::</span></span><span class="token punctuation">{</span>next_account_info<span class="token punctuation">,</span> <span class="token class-name">AccountInfo</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token class-name">Clock</span><span class="token punctuation">,</span>
    entrypoint<span class="token punctuation">,</span>
    <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
    msg<span class="token punctuation">,</span>
    <span class="token namespace">program_error<span class="token punctuation">::</span></span><span class="token class-name">ProgramError</span><span class="token punctuation">,</span>
    <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token namespace">rent<span class="token punctuation">::</span></span><span class="token class-name">Rent</span><span class="token punctuation">,</span>
    <span class="token namespace">system_program<span class="token punctuation">::</span></span><span class="token constant">ID</span> <span class="token keyword">as</span> <span class="token constant">SYSTEM_PROGRAM_ID</span><span class="token punctuation">,</span>
    <span class="token namespace">sysvar<span class="token punctuation">::</span></span><span class="token class-name">Sysvar</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">entrypoint!</span><span class="token punctuation">(</span>process_instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(BorshSerialize, BorshDeserialize, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">HelloState</span> <span class="token punctuation">{</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Accounts required</span>
<span class="token comment">/// 1. [signer] Payer</span>
<span class="token comment">/// 2. [writable] Hello state account</span>
<span class="token comment">/// 3. [] System Program</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Payer account</span>
    <span class="token keyword">let</span> payer_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Hello state account</span>
    <span class="token keyword">let</span> hello_state_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// System Program</span>
    <span class="token keyword">let</span> system_program <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> rent <span class="token operator">=</span> <span class="token class-name">Rent</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Checking if payer account is the signer</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>payer_account<span class="token punctuation">.</span>is_signer <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">MissingRequiredSignature</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Checking if hello state account is rent exempt</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>rent<span class="token punctuation">.</span><span class="token function">is_exempt</span><span class="token punctuation">(</span>hello_state_account<span class="token punctuation">.</span><span class="token function">lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">AccountNotRentExempt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Checking if hello state account is writable</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>hello_state_account<span class="token punctuation">.</span>is_writable <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Checking if hello state account&#39;s owner is the current program</span>
    <span class="token keyword">if</span> hello_state_account<span class="token punctuation">.</span>owner<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>program_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">IllegalOwner</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Checking if the system program is valid</span>
    <span class="token keyword">if</span> system_program<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token constant">SYSTEM_PROGRAM_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">IncorrectProgramId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> hello_state <span class="token operator">=</span> <span class="token class-name">HelloState</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hello_state_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Checking if the state has already been initialized</span>
    <span class="token keyword">if</span> hello_state<span class="token punctuation">.</span>is_initialized <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">AccountAlreadyInitialized</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    hello_state<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    hello_state<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> hello_state_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Account initialized :)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_instruction</span><span class="token punctuation">(</span>
    program_id<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _instruction_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> accounts_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> payer_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello_state_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> system_program <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>accounts_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> rent <span class="token operator">=</span> <span class="token class-name">Rent</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Checking if payer account is the signer</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>payer_account<span class="token punctuation">.</span>is_signer <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">MissingRequiredSignature</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Checking if hello state account is rent exempt</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>rent<span class="token punctuation">.</span><span class="token function">is_exempt</span><span class="token punctuation">(</span>hello_state_account<span class="token punctuation">.</span><span class="token function">lamports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">AccountNotRentExempt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Checking if hello state account is writable</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>hello_state_account<span class="token punctuation">.</span>is_writable <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Checking if hello state account&#39;s owner is the current program</span>
    <span class="token keyword">if</span> hello_state_account<span class="token punctuation">.</span>owner<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>program_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">IllegalOwner</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Checking if the system program is valid</span>
    <span class="token keyword">if</span> system_program<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token constant">SYSTEM_PROGRAM_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">IncorrectProgramId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> hello_state <span class="token operator">=</span> <span class="token class-name">HelloState</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hello_state_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token comment">// Checking if the state has already been initialized</span>
    <span class="token keyword">if</span> hello_state<span class="token punctuation">.</span>is_initialized <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">AccountAlreadyInitialized</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    hello_state<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    hello_state<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> hello_state_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Account initialized :)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="como-leer-multiples-instrucciones-de-una-transaccion" tabindex="-1"><a class="header-anchor" href="#como-leer-multiples-instrucciones-de-una-transaccion" aria-hidden="true">#</a> Cómo leer múltiples instrucciones de una transacción</h2><p>Solana nos permite echar un vistazo a todas las instrucciones en la transacción actual. Podemos almacenarlas en una variable e iterar sobre ellas. Podemos hacer muchas cosas con esto, como verificar transacciones sospechosas.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">,</span>
    <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
        sysvar<span class="token punctuation">,</span>
        <span class="token namespace">serialize_utils<span class="token punctuation">::</span></span><span class="token punctuation">{</span>read_pubkey<span class="token punctuation">,</span>read_u16<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token macro property">declare_id!</span><span class="token punctuation">(</span><span class="token string">&quot;8DJXJRV8DBFjJDYyU9cTHBVK1F1CTCi6JUBDVfyBxqsT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[program]</span>
<span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">cookbook</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">read_multiple_instruction</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">ReadMultipleInstruction</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> creator_bump<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> instruction_sysvar_account <span class="token operator">=</span> <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>instruction_sysvar_account<span class="token punctuation">;</span>

        <span class="token keyword">let</span> instruction_sysvar_account_info <span class="token operator">=</span> instruction_sysvar_account<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token string">&quot;8DJXJRV8DBFjJDYyU9cTHBVK1F1CTCi6JUBDVfyBxqsT&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> instruction_sysvar <span class="token operator">=</span> instruction_sysvar_account_info<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> <span class="token keyword">mut</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> num_instructions <span class="token operator">=</span> <span class="token function">read_u16</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> idx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>instruction_sysvar<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">NoInstructionFound</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>num_instructions <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token keyword">mut</span> current <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>index <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token function">read_u16</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> current<span class="token punctuation">,</span> <span class="token operator">&amp;</span>instruction_sysvar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            current <span class="token operator">=</span> start <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> num_accounts <span class="token operator">=</span> <span class="token function">read_u16</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> current<span class="token punctuation">,</span> <span class="token operator">&amp;</span>instruction_sysvar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            current <span class="token operator">+=</span> <span class="token punctuation">(</span>num_accounts <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> program_id <span class="token operator">=</span> <span class="token function">read_pubkey</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> current<span class="token punctuation">,</span> <span class="token operator">&amp;</span>instruction_sysvar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> program_id <span class="token operator">!=</span> id
            <span class="token punctuation">{</span>
                <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction had ix with program id {}&quot;</span><span class="token punctuation">,</span> program_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">SuspiciousTransaction</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token attribute attr-name">#[instruction(creator_bump:u8)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">ReadMultipleInstruction</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[account(address = sysvar::instructions::id())]</span>
    instruction_sysvar_account<span class="token punctuation">:</span> <span class="token class-name">UncheckedAccount</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[error_code]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">MyError</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[msg(<span class="token string">&quot;No instructions found&quot;</span>)]</span>
    <span class="token class-name">NoInstructionFound</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[msg(<span class="token string">&quot;Suspicious transaction detected&quot;</span>)]</span>
    <span class="token class-name">SuspiciousTransaction</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token keyword">mut</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num_instructions <span class="token operator">=</span> <span class="token function">read_u16</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> idx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>instruction_sysvar<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">MyError</span><span class="token punctuation">::</span><span class="token class-name">NoInstructionFound</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>


<span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>num_instructions <span class="token punctuation">{</span>
    
    <span class="token keyword">let</span> <span class="token keyword">mut</span> current <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>index <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token function">read_u16</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> current<span class="token punctuation">,</span> <span class="token operator">&amp;</span>instruction_sysvar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    current <span class="token operator">=</span> start <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> num_accounts <span class="token operator">=</span> <span class="token function">read_u16</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> current<span class="token punctuation">,</span> <span class="token operator">&amp;</span>instruction_sysvar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    current <span class="token operator">+=</span> <span class="token punctuation">(</span>num_accounts <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><!--]--></div></div><!--]--></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: marco@evolbit.net">Marco Ordonez</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/es/references/accounts.html" class="" aria-label="Cuentas"><!--[--><!--]--> Cuentas <!--[--><!--]--></a></span><span class="next"><a href="/es/references/token.html" class="" aria-label="Interactuando con tokens"><!--[--><!--]--> Interactuando con tokens <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.07ce7a66.js" defer></script>
  </body>
</html>
