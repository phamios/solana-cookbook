<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Livro de Receitas da Solana - Solana Cookbook | Transações Versionadas"><meta name="og:title" content="Livro de Receitas da Solana - Solana Cookbook | Transações Versionadas"><meta name="description" content="Formato novo e aprimorado de transações na Solana."><meta name="og:description" content="Formato novo e aprimorado de transações na Solana."><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Transações Versionadas | Solana Cookbook</title>
    <link rel="modulepreload" href="/assets/app.07ce7a66.js"><link rel="modulepreload" href="/assets/versioned-transactions.html.8ddb12df.js"><link rel="modulepreload" href="/assets/versioned-transactions.html.20e4c983.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/pt/" class=""><!----><span class="site-name can-hide">Solana Cookbook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribuir"><!--[--><!--]--> Contribuir <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/guides/versioned-transactions.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guides/versioned-transactions.html" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/pt/guides/versioned-transactions.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/versioned-transactions.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/guides/versioned-transactions.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/guides/versioned-transactions.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/guides/versioned-transactions.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribuir"><!--[--><!--]--> Contribuir <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/guides/versioned-transactions.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guides/versioned-transactions.html" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/pt/guides/versioned-transactions.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/versioned-transactions.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/guides/versioned-transactions.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/guides/versioned-transactions.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/guides/versioned-transactions.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Primeiros pasos <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/pt/" class="sidebar-item" aria-label="Cozinhando com a Solana"><!--[--><!--]--> Cozinhando com a Solana <!--[--><!--]--></a><!----></li><li><a href="/pt/getting-started/installation.html" class="sidebar-item" aria-label="Instalação"><!--[--><!--]--> Instalação <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Conceitos chaves <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/pt/core-concepts/accounts.html" class="sidebar-item" aria-label="Contas"><!--[--><!--]--> Contas <!--[--><!--]--></a><!----></li><li><a href="/pt/core-concepts/programs.html" class="sidebar-item" aria-label="Programas"><!--[--><!--]--> Programas <!--[--><!--]--></a><!----></li><li><a href="/pt/core-concepts/transactions.html" class="sidebar-item" aria-label="Transações"><!--[--><!--]--> Transações <!--[--><!--]--></a><!----></li><li><a href="/pt/core-concepts/pdas.html" class="sidebar-item" aria-label="Endereços Derivados de Programa (PDAs)"><!--[--><!--]--> Endereços Derivados de Programa (PDAs) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Guias <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/pt/guides/get-program-accounts.html" class="sidebar-item" aria-label="Obter Contas do Programa"><!--[--><!--]--> Obter Contas do Programa <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/serialization.html" class="sidebar-item" aria-label="Serializando Dados"><!--[--><!--]--> Serializando Dados <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/data-migration.html" class="sidebar-item" aria-label="Migrando Contas de Dados do Programa"><!--[--><!--]--> Migrando Contas de Dados do Programa <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/account-maps.html" class="sidebar-item" aria-label="Mapeamentos de Conta"><!--[--><!--]--> Mapeamentos de Conta <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="Depurando Programas da Solana"><!--[--><!--]--> Depurando Programas da Solana <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/feature-parity-testing.html" class="sidebar-item" aria-label="Teste de Paridade de Recursos"><!--[--><!--]--> Teste de Paridade de Recursos <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Referências <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/pt/references/local-development.html" class="sidebar-item" aria-label="Desenvolvimento Local"><!--[--><!--]--> Desenvolvimento Local <!--[--><!--]--></a><!----></li><li><a href="/pt/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="Pares de Chaves e Carteiras"><!--[--><!--]--> Pares de Chaves e Carteiras <!--[--><!--]--></a><!----></li><li><a href="/pt/references/basic-transactions.html" class="sidebar-item" aria-label="Enviando Transações"><!--[--><!--]--> Enviando Transações <!--[--><!--]--></a><!----></li><li><a href="/pt/references/accounts.html" class="sidebar-item" aria-label="Contas"><!--[--><!--]--> Contas <!--[--><!--]--></a><!----></li><li><a href="/pt/references/programs.html" class="sidebar-item" aria-label="Escrevendo Programas"><!--[--><!--]--> Escrevendo Programas <!--[--><!--]--></a><!----></li><li><a href="/pt/references/token.html" class="sidebar-item" aria-label="Interagindo com Tokens"><!--[--><!--]--> Interagindo com Tokens <!--[--><!--]--></a><!----></li><li><a href="/pt/references/staking.html" class="sidebar-item" aria-label="Staking"><!--[--><!--]--> Staking <!--[--><!--]--></a><!----></li><li><a href="/pt/references/nfts.html" class="sidebar-item" aria-label="NFTs"><!--[--><!--]--> NFTs <!--[--><!--]--></a><!----></li><li><a href="/pt/references/offline-transactions.html" class="sidebar-item" aria-label="Enviando Transações Offline"><!--[--><!--]--> Enviando Transações Offline <!--[--><!--]--></a><!----></li><li><a href="/pt/references/name-service.html" class="sidebar-item" aria-label="Serviço de Nomes"><!--[--><!--]--> Serviço de Nomes <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="transacoes-versionadas" tabindex="-1"><a class="header-anchor" href="#transacoes-versionadas" aria-hidden="true">#</a> Transações Versionadas</h1><p>A Solana lançou recentemente as &quot;Transações Versionadas&quot;. As mudanças propostas são as seguintes:</p><ol><li><p>Introdução de um novo programa que gerencia tabelas de pesquisa de endereços na cadeia</p></li><li><p>Adição de um novo formato de transação que pode utilizar as tabelas de pesquisa de endereços na cadeia</p></li></ol><h2 id="fatos" tabindex="-1"><a class="header-anchor" href="#fatos" aria-hidden="true">#</a> Fatos</h2><div class="custom-container tip"><p class="custom-container-title">Ficha Informativa</p><ul><li>As Transações legadas (legacy) da Solana têm um problema importante: o tamanho máximo permitido é de 1232 bytes, o que limita o número de contas que podem ser incluídas em uma transação atômica a 35 endereços.</li><li>As Tabelas de Pesquisa de Endereços (Address Lookup Tables, ou LUTs): Depois que as contas são armazenadas em uma tabela LUT, o endereço da tabela pode ser referenciado em uma mensagem de transação usando índices u8 de 1 byte.</li><li>A função <code>createLookupTable()</code> do <code>solana/web3.js</code> pode ser usada para construir uma nova tabela de pesquisa, bem como determinar seu endereço.</li><li>Uma vez criada uma LUT, ela pode ser estendida, ou seja, contas podem ser adicionadas à tabela.</li><li>As Transações Versionadas mudam a estrutura das transações legadas para incorporar as LUTs.</li><li>Antes da introdução do versionamento, as transações deixavam um bit superior não utilizado no primeiro byte de seus cabeçalhos, que agora pode ser usado para declarar explicitamente a versão das transações.</li></ul></div><p>Vamos falar mais sobre as mudanças introduzidas acima e o que elas significam para os desenvolvedores. No entanto, para entender melhor as mudanças, precisamos primeiro entender a anatomia de uma transação regular (ou legada).</p><h2 id="transacao-legada" tabindex="-1"><a class="header-anchor" href="#transacao-legada" aria-hidden="true">#</a> Transação Legada</h2><p>A rede Solana usa um tamanho máximo de unidade transacional (MTU) de 1280 bytes, em conformidade com as restrições de tamanho do <a href="https://en.wikipedia.org/wiki/IPv6_packet" target="_blank" rel="noopener noreferrer">MTU IPv6<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> para garantir velocidade e confiabilidade. Isso deixa <strong>1232 bytes</strong> para dados do pacote, como transações serializadas.</p><p>Uma transação é composta por:</p><ol><li>Um array compacto de assinaturas, onde cada assinatura é um <a href="https://ed25519.cr.yp.to/" target="_blank" rel="noopener noreferrer">ed25519<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> de 64 bytes</li><li>Uma mensagem (legada)</li></ol><p><img src="/assets/tx_format.1023848a.png" alt="Formato da Transação"></p><div class="custom-container tip"><p class="custom-container-title">Formato de Array Compacto</p><p>Um array compacto é um array serializado que tem os seguintes componentes:</p><ol><li>O comprimento do array em uma codificação de vários bytes chamada <a href="https://beta.docs.solana.com/developing/programming-model/transactions#compact-u16-format" target="_blank" rel="noopener noreferrer">Compact-u16<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Seguido de cada item do array</li></ol><p><img src="/assets/compact_array_format.6984243f.png" alt="Formato do Array Compacto"></p></div><h2 id="mensagem-legada" tabindex="-1"><a class="header-anchor" href="#mensagem-legada" aria-hidden="true">#</a> Mensagem Legada</h2><p>Uma Mensagem Legada tem os seguintes componentes:</p><ol><li>Um cabeçalho</li><li>Um array compacto de endereços de conta, onde cada endereço de conta ocupa 32 bytes</li><li>Um hash de bloco recente</li></ol><ul><li>um hash SHA-256 de 32 bytes usado para indicar quando o livro-razão foi visitado pela última vez. Se um hash de bloco for muito antigo, os validadores o rejeitarão.</li></ul><ol start="4"><li>Um array compacto de instruções</li></ol><p><img src="/assets/legacy_message.09ab30b7.png" alt="Mensagem Legada"></p><h3 id="cabecalho" tabindex="-1"><a class="header-anchor" href="#cabecalho" aria-hidden="true">#</a> Cabeçalho</h3><p>O cabeçalho da mensagem tem 3 bytes de comprimento e contém 3 inteiros u8:</p><ol><li>O número de assinaturas necessárias: o tempo de execução da Solana verifica este número com o comprimento do array compacto de assinaturas na transação.</li><li>O número de endereços de contas somente leitura que exigem assinaturas.</li><li>O número de endereços de contas somente leitura que não exigem assinaturas.</li></ol><p><img src="/assets/message_header.8eb7d589.png" alt="Cabeçalho da Mensagem"></p><h3 id="array-compacto-de-enderecos-de-conta" tabindex="-1"><a class="header-anchor" href="#array-compacto-de-enderecos-de-conta" aria-hidden="true">#</a> Array compacto de endereços de conta</h3><p>Este array compacto começa com uma codificação compact-u16 do número de endereços de conta, seguido por:</p><ol><li><strong>Endereços de conta que exigem assinaturas</strong>: os endereços que solicitam acesso de leitura e gravação são listados primeiro, seguidos pelos que solicitam acesso somente de leitura</li><li><strong>Endereços de conta que não exigem assinaturas</strong>: mesmo que acima, os endereços que solicitam acesso de leitura e gravação são listados primeiro, seguidos pelos que solicitam acesso somente de leitura</li></ol><p><img src="/assets/compat_array_of_account_addresses.7792e5c7.png" alt="Array compacto de endereços de conta"></p><h3 id="array-compacto-de-instrucoes" tabindex="-1"><a class="header-anchor" href="#array-compacto-de-instrucoes" aria-hidden="true">#</a> Array compacto de instruções</h3><p>Assim como o array de endereços de conta, este array compacto começa com uma codificação compact-u16 do número de instruções, seguido por um array de instruções. Cada instrução no array tem os seguintes componentes:</p><ol><li><strong>ID do programa</strong>: identifica um programa na cadeia que processará a instrução. Isso é representado como um índice u8 para um endereço no array compacto de endereços de conta dentro da mensagem.</li><li><strong>Array compacto de índices de endereços de conta</strong>: índices u8 para um subconjunto de endereços de conta no array compacto de endereços de conta, que exigem assinaturas.</li><li><strong>Array compacto de dados u8 opacos</strong>: um array de bytes de propósito geral que é específico para o ID do programa mencionado anteriormente. Este array de dados especifica quaisquer operações que o programa deve realizar e qualquer informação adicional que as contas podem não conter.</li></ol><p><img src="/assets/compact_array_of_ixs.6281d70b.png" alt="Array compacto de instruções"></p><h2 id="problemas-com-as-transacoes-legadas" tabindex="-1"><a class="header-anchor" href="#problemas-com-as-transacoes-legadas" aria-hidden="true">#</a> Problemas com as Transações Legadas</h2><p>Qual é o problema com o modelo de transação acima?</p><p><strong>O tamanho máximo de uma transação, e consequentemente o número de contas que podem caber em uma única transação atômica.</strong></p><p>Como discutido anteriormente, o tamanho máximo permitido de uma transação é de <strong>1232 bytes</strong>. O tamanho de um endereço de conta é de 32 bytes. Assim, uma transação pode no máximo armazenar <strong>35 contas</strong>, levando em consideração algum espaço para cabeçalhos, assinaturas e outros metadados.</p><p><img src="/assets/issues_with_legacy_txs.5766db66.png" alt="Problemas com as Transações Legadas"></p><p>Isso é problemático, já que há vários casos em que os desenvolvedores precisam incluir centenas de contas sem assinatura em uma única transação. Isso atualmente não é possível com o modelo de transação legada. A solução atualmente utilizada é armazenar temporariamente o estado na cadeia e consumi-lo posteriormente em transações. Essa solução alternativa não funciona quando vários programas precisam ser compostos em uma única transação. Cada programa requer várias contas como entrada e, portanto, caímos no mesmo problema de antes.</p><p>É aqui que as <strong>Tabelas de Pesquisa de Endereços (LUT)</strong> são introduzidas.</p><h2 id="tabelas-de-pesquisa-de-enderecos-lut" tabindex="-1"><a class="header-anchor" href="#tabelas-de-pesquisa-de-enderecos-lut" aria-hidden="true">#</a> Tabelas de Pesquisa de Endereços (LUT)</h2><p>A ideia por trás das Tabelas de Pesquisa de Endereços é armazenar endereços de contas em uma estrutura de dados em forma de tabela (array) na cadeia. Uma vez que as contas são armazenadas nesta tabela, o endereço da tabela pode ser referenciado em uma mensagem de transação. Para apontar para uma conta individual dentro da tabela, é necessário um índice u8 de 1 byte.</p><p><img src="/assets/luts.96a8a310.png" alt="LUTs"></p><p>Isso libera espaço, já que os endereços não precisam mais ser armazenados dentro da mensagem da transação. Eles apenas precisam ser referenciados na forma de um índice dentro da tabela em forma de array. Isso leva a uma possibilidade de referenciar 2^8=<strong>256</strong> contas, já que as contas são referenciadas usando um índice u8.</p><p>As LUTs precisam estar isentas de aluguel ao serem inicializadas ou sempre que um novo endereço é adicionado à tabela. Os endereços podem ser adicionados a essa tabela por meio de um buffer na cadeia, ou diretamente anexando-os à tabela por meio da instrução <code>Extension</code>. Além disso, as LUTs podem armazenar metadados associados seguidos por um array compacto de contas. Abaixo, você pode ver a estrutura de uma típica Tabela de Pesquisa de Endereços.</p><p><img src="/assets/lut_format.060d6be2.png" alt="LUT Format"></p><p>Uma ponto de atenção importante das LUTs é que, como as pesquisas de endereço exigem sobrecarga extra durante o processamento da transação, elas geralmente incorrem em custos mais altos para uma transação.</p><h2 id="transacoes-versionadas-transacao-v0-transactionv0" tabindex="-1"><a class="header-anchor" href="#transacoes-versionadas-transacao-v0-transactionv0" aria-hidden="true">#</a> Transações Versionadas: Transação V0 (TransactionV0)</h2><p>A estrutura da transação legada precisa ser modificada para incorporar as pesquisas de tabela de endereços. Essas mudanças não devem quebrar o processamento de transações na Solana, nem indicar quaisquer mudanças de formato para os programas invocados.</p><p>Para garantir o que foi descrito acima, é importante mencionar explicitamente o tipo de transação: <code>legacy</code> ou <code>versioned</code>. Como incluímos essas informações em uma transação?</p><p>Antes da introdução ao versionamento, as transações deixavam um bit superior não utilizado nos cabeçalhos de mensagem: <code>num_required_signatures</code>. Agora podemos usar esse bit para declarar explicitamente a versão de nossas transações.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">VersionedMessage</span> <span class="token punctuation">{</span>
    <span class="token class-name">Legacy</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">V0</span><span class="token punctuation">(</span><span class="token namespace">v0<span class="token punctuation">::</span></span><span class="token class-name">Message</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Se o primeiro bit estiver definido, os bits restantes no primeiro byte codificarão um número de versão. A Solana está começando com a &quot;Versão 0&quot;, que é a versão necessária para começar a usar as LUTs.</p><p>Se o primeiro bit não estiver definido, a transação será considerada uma &quot;Transação Legada&quot; e o restante do primeiro byte será tratado como o primeiro byte de uma Mensagem Legada codificada.</p><h2 id="mensagem-v0-messagev0" tabindex="-1"><a class="header-anchor" href="#mensagem-v0-messagev0" aria-hidden="true">#</a> Mensagem V0 (MessageV0)</h2><p>A estrutura da nova Mensagem V0 é mais ou menos a mesma, exceto por duas pequenas, mas importantes mudanças:</p><ol><li><strong>Cabeçalho da mensagem</strong>: inalterado em relação à versão legada</li><li><strong>Array compacto de chaves de conta</strong>: inalterado em relação à versão legada. Vamos denotar o array de índices apontando para elementos neste array como <em>array de índices A</em> (você verá por que estamos denominando isso em breve)</li><li><strong>Hash recente do bloco</strong>: inalterado em relação à versão legada</li><li><strong>Array compacto de instruções</strong>: mudança em relação à versão legada</li><li><strong>Array compacto de pesquisas de tabela de endereços</strong>: introduzido na V0</li></ol><p><img src="/assets/messagev0.c089b240.png" alt="Mensagem v0"></p><p>Vamos discutir primeiro a estrutura do array compacto de pesquisas na tabela de endereços antes de vermos o que mudou no array de instruções.</p><h3 id="array-compacto-de-pesquisas-na-tabela-de-enderecos" tabindex="-1"><a class="header-anchor" href="#array-compacto-de-pesquisas-na-tabela-de-enderecos" aria-hidden="true">#</a> Array compacto de pesquisas na tabela de endereços</h3><p>Essa estrutura introduz as Tabelas de Pesquisa de Endereços (LUT) em Transações Versionadas, permitindo assim o uso de LUTs para carregar mais contas somente leitura e graváveis em uma única transação.</p><p>O array compacto começa com uma codificação compact-u16 do número de pesquisas na tabela de endereços, seguido por um array de pesquisas na tabela de endereços. Cada pesquisa tem a seguinte estrutura:</p><ol><li><strong>Chave da conta</strong>: chave da conta da tabela de pesquisa de endereços.</li><li><strong>Índices graváveis</strong>: array compacto de índices usados para carregar endereços de conta graváveis. Vamos denotar esse array como <em>array de índices B</em>.</li><li><strong>Índices somente leitura</strong>: array compacto de índices usados para carregar endereços de conta somente leitura. Vamos denotar esse array como <em>array de índices C</em>.</li></ol><p><img src="/assets/compact_array_of_luts.9175e491.png" alt="Array compacto de LUTs"></p><p>Vamos ver agora quais mudanças foram feitas na estrutura do array compacto de instruções.</p><h3 id="array-compacto-de-instrucoes-1" tabindex="-1"><a class="header-anchor" href="#array-compacto-de-instrucoes-1" aria-hidden="true">#</a> Array compacto de instruções</h3><p>Como discutido anteriormente, o array compacto de instruções legado armazena instruções legadas individuais que, por sua vez, armazenam o seguinte:</p><ol><li>Índice do ID do programa</li><li>Array compacto de índices de endereços de conta</li><li>Array compacto de dados opacos de 8 bits</li></ol><p>A mudança na nova instrução não está na estrutura da instrução em si, mas no array sendo usado para obter índices para 1 e 2. Em transações legadas, é usado um subconjunto do array compacto A de contas armazenadas na mensagem, enquanto em Transações Versionadas, é usado um subconjunto do array combinado dos seguintes:</p><ol><li><strong>array de índices A</strong>: Array compacto de contas armazenadas na mensagem</li><li><strong>array de índices B</strong>: índices graváveis na tabela de pesquisa de endereços</li><li><strong>array de índices C</strong>: índices somente leitura na tabela de pesquisa de endereços</li></ol><p><img src="/assets/new_compact_array_of_ixs.54090dc5.png" alt="Novo array compacto de Instruções"></p><h2 id="mudancas-na-rpc" tabindex="-1"><a class="header-anchor" href="#mudancas-na-rpc" aria-hidden="true">#</a> Mudanças na RPC</h2><p>As respostas de transações exigirão um novo campo de versão: <code>maxSupportedTransactionVersion</code> para indicar aos clientes qual estrutura de transação deve ser seguida para desserialização.</p><p>Os seguintes métodos precisam ser atualizados para evitar erros:</p><ul><li><code>getTransaction</code></li><li><code>getBlock</code></li></ul><p>O seguinte parâmetro precisa ser adicionado às solicitações:</p><p><code>maxSupportedTransactionVersion: 0</code></p><p>Se <code>maxSupportedTransactionVersion</code> não for adicionado explicitamente à solicitação, a versão da transação será revertida para <code>legacy</code>. Qualquer bloco que contenha uma transação versionada retornará um erro ao cliente no caso de uma transação legada.</p><p>Você pode definir isso por meio de solicitações formatadas em JSON para o ponto de extremidade RPC como abaixo:</p><div class="language-plaintext ext-plaintext line-numbers-mode"><pre class="language-plaintext"><code>curl http://localhost:8899 -X POST -H &quot;Content-Type: application/json&quot; -d \
&#39;{&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;:1, &quot;method&quot;: &quot;getBlock&quot;, &quot;params&quot;: [430, {
  &quot;encoding&quot;:&quot;json&quot;,
  &quot;maxSupportedTransactionVersion&quot;:0,
  &quot;transactionDetails&quot;:&quot;full&quot;,
  &quot;rewards&quot;:false
}]}&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Você também pode fazer o mesmo usando a biblioteca <a href="https://solana-labs.github.io/solana-web3.js/" target="_blank" rel="noopener noreferrer"><code>@solana/web3.js</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// conecte-se ao cluster `devnet` e obtenha o `slot` atual</span>
<span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">web3<span class="token punctuation">.</span>Connection</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// obtenha o bloco mais recente (permitindo transações v0)</span>
<span class="token keyword">const</span> block <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBlock</span><span class="token punctuation">(</span>slot<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">maxSupportedTransactionVersion</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// obtenha uma transação específica (permitindo transações v0)</span>
<span class="token keyword">const</span> getTx <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span>
  <span class="token string">&quot;3jpoANiFeVGisWRY5UP648xRXs3iQasCHABPWRWnoEjeA93nc79WrnGgpgazjq4K9m8g2NJoyKoWBV1Kx5VmtwHQ&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">maxSupportedTransactionVersion</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="outros-recursos" tabindex="-1"><a class="header-anchor" href="#outros-recursos" aria-hidden="true">#</a> Outros recursos</h2><ul><li><a href="https://beta.docs.solana.com/developing/versioned-transactions#how-create-a-versioned-transaction" target="_blank" rel="noopener noreferrer">Como construir uma Transação Versionada<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://beta.docs.solana.com/developing/lookup-tables#how-to-create-an-address-lookup-table" target="_blank" rel="noopener noreferrer">Como construir uma Transação Versionada com pesquisa de endereço usando LUTs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://beta.docs.solana.com/proposals/transactions-v2#limitations" target="_blank" rel="noopener noreferrer">Limitações das Transações Versionadas<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://beta.docs.solana.com/proposals/transactions-v2#security-concerns" target="_blank" rel="noopener noreferrer">Preocupações de segurança das Transações Versionadas<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://beta.docs.solana.com/proposals/transactions-v2#other-proposals" target="_blank" rel="noopener noreferrer">Soluções alternativas propostas para as Transações Versionadas<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="referencias" tabindex="-1"><a class="header-anchor" href="#referencias" aria-hidden="true">#</a> Referências</h2><ul><li><a href="https://beta.docs.solana.com/proposals/transactions-v2" target="_blank" rel="noopener noreferrer">Proposta de Transações V2<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://beta.docs.solana.com/developing/versioned-transactions" target="_blank" rel="noopener noreferrer">Desenvolvendo com as Transações Versionadas<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: danicuki@gmail.com">Daniel Cukier</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.07ce7a66.js" defer></script>
  </body>
</html>
