<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Livro de Receitas da Solana - Solana Cookbook | CPIs"><meta name="og:title" content="Livro de Receitas da Solana - Solana Cookbook | CPIs"><meta name="description" content="As CPIs permitem que programas chamem instruções em outros programas, permitindo a componibilidade dos programas Solana. Saiba mais sobre CPIs e outros Conceitos Principais no Livro de Receitas da Solana."><meta name="og:description" content="As CPIs permitem que programas chamem instruções em outros programas, permitindo a componibilidade dos programas Solana. Saiba mais sobre CPIs e outros Conceitos Principais no Livro de Receitas da Solana."><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Invocações de Programas Cruzados (CPIs) | Solana Cookbook</title>
    <link rel="modulepreload" href="/assets/app.07ce7a66.js"><link rel="modulepreload" href="/assets/cpi.html.dc41f18c.js"><link rel="modulepreload" href="/assets/cpi.html.9d257983.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/pt/" class=""><!----><span class="site-name can-hide">Solana Cookbook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribuir"><!--[--><!--]--> Contribuir <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/core-concepts/cpi.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/pt/core-concepts/cpi.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/core-concepts/cpi.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/core-concepts/cpi.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/core-concepts/cpi.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribuir"><!--[--><!--]--> Contribuir <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/core-concepts/cpi.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/pt/core-concepts/cpi.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/core-concepts/cpi.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/core-concepts/cpi.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/core-concepts/cpi.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Primeiros pasos <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/pt/" class="sidebar-item" aria-label="Cozinhando com a Solana"><!--[--><!--]--> Cozinhando com a Solana <!--[--><!--]--></a><!----></li><li><a href="/pt/getting-started/installation.html" class="sidebar-item" aria-label="Instalação"><!--[--><!--]--> Instalação <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Conceitos chaves <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/pt/core-concepts/accounts.html" class="sidebar-item" aria-label="Contas"><!--[--><!--]--> Contas <!--[--><!--]--></a><!----></li><li><a href="/pt/core-concepts/programs.html" class="sidebar-item" aria-label="Programas"><!--[--><!--]--> Programas <!--[--><!--]--></a><!----></li><li><a href="/pt/core-concepts/transactions.html" class="sidebar-item" aria-label="Transações"><!--[--><!--]--> Transações <!--[--><!--]--></a><!----></li><li><a href="/pt/core-concepts/pdas.html" class="sidebar-item" aria-label="Endereços Derivados de Programa (PDAs)"><!--[--><!--]--> Endereços Derivados de Programa (PDAs) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Guias <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/pt/guides/get-program-accounts.html" class="sidebar-item" aria-label="Obter Contas do Programa"><!--[--><!--]--> Obter Contas do Programa <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/serialization.html" class="sidebar-item" aria-label="Serializando Dados"><!--[--><!--]--> Serializando Dados <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/data-migration.html" class="sidebar-item" aria-label="Migrando Contas de Dados do Programa"><!--[--><!--]--> Migrando Contas de Dados do Programa <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/account-maps.html" class="sidebar-item" aria-label="Mapeamentos de Conta"><!--[--><!--]--> Mapeamentos de Conta <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="Depurando Programas da Solana"><!--[--><!--]--> Depurando Programas da Solana <!--[--><!--]--></a><!----></li><li><a href="/pt/guides/feature-parity-testing.html" class="sidebar-item" aria-label="Teste de Paridade de Recursos"><!--[--><!--]--> Teste de Paridade de Recursos <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Referências <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/pt/references/local-development.html" class="sidebar-item" aria-label="Desenvolvimento Local"><!--[--><!--]--> Desenvolvimento Local <!--[--><!--]--></a><!----></li><li><a href="/pt/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="Pares de Chaves e Carteiras"><!--[--><!--]--> Pares de Chaves e Carteiras <!--[--><!--]--></a><!----></li><li><a href="/pt/references/basic-transactions.html" class="sidebar-item" aria-label="Enviando Transações"><!--[--><!--]--> Enviando Transações <!--[--><!--]--></a><!----></li><li><a href="/pt/references/accounts.html" class="sidebar-item" aria-label="Contas"><!--[--><!--]--> Contas <!--[--><!--]--></a><!----></li><li><a href="/pt/references/programs.html" class="sidebar-item" aria-label="Escrevendo Programas"><!--[--><!--]--> Escrevendo Programas <!--[--><!--]--></a><!----></li><li><a href="/pt/references/token.html" class="sidebar-item" aria-label="Interagindo com Tokens"><!--[--><!--]--> Interagindo com Tokens <!--[--><!--]--></a><!----></li><li><a href="/pt/references/staking.html" class="sidebar-item" aria-label="Staking"><!--[--><!--]--> Staking <!--[--><!--]--></a><!----></li><li><a href="/pt/references/nfts.html" class="sidebar-item" aria-label="NFTs"><!--[--><!--]--> NFTs <!--[--><!--]--></a><!----></li><li><a href="/pt/references/offline-transactions.html" class="sidebar-item" aria-label="Enviando Transações Offline"><!--[--><!--]--> Enviando Transações Offline <!--[--><!--]--></a><!----></li><li><a href="/pt/references/name-service.html" class="sidebar-item" aria-label="Serviço de Nomes"><!--[--><!--]--> Serviço de Nomes <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="invocacoes-de-programas-cruzados-cpis" tabindex="-1"><a class="header-anchor" href="#invocacoes-de-programas-cruzados-cpis" aria-hidden="true">#</a> Invocações de Programas Cruzados (CPIs)</h1><p>A Invocação de Programas Cruzados (Cross-Program Invocation, ou CPI) é uma chamada direta de um programa em outro, permitindo a componibilidade de programas Solana. Assim como qualquer cliente pode chamar qualquer programa usando o protocolo JSON-RPC, qualquer programa pode chamar outro programa via uma CPI. As CPIs essencialmente transformam todo o ecossistema Solana em uma única API gigante que está à disposição do desenvolvedor.</p><p>O objetivo desta seção é fornecer uma visão geral de alto nível das CPIs. Por favor, consulte os recursos vinculados abaixo para explicações mais detalhadas, exemplos e tutoriais passo a passo.</p><h2 id="fatos" tabindex="-1"><a class="header-anchor" href="#fatos" aria-hidden="true">#</a> Fatos</h2><div class="custom-container tip"><p class="custom-container-title">Ficha Informativa</p><ul><li>Uma Invocação de Programas Cruzados (CPI) é uma chamada de um programa para outro, visando uma instrução específica no programa que está sendo chamado</li><li>As CPIs permitem que o programa chamador estenda seus privilégios de assinatura para o programa chamado</li><li>Os programas podem executar CPIs usando <code>invoke</code> ou <code>invoke_signed</code> dentro de suas instruções</li><li><code>invoke</code> é usado quando todas as assinaturas necessárias estão acessíveis antes da invocação, sem a necessidade de PDAs atuarem como signatários.</li><li><code>invoke_signed</code> é usado quando PDAs do programa chamador são necessários como signatários na CPI</li><li>Depois que uma CPI é feita para outro programa, o programa chamado pode fazer novas CPIs para outros programas, até uma profundidade máxima de 4</li></ul></div><h2 id="mergulho-profundo" tabindex="-1"><a class="header-anchor" href="#mergulho-profundo" aria-hidden="true">#</a> Mergulho Profundo</h2><p>As Invocações de Programas Cruzados (CPIs) permitem a componibilidade de programas Solana, o que permite que os desenvolvedores utilizem e construam sobre as instruções de programas existentes.</p><p>Para executar CPIs, use a função <a href="https://docs.rs/solana-program/latest/solana_program/program/fn.invoke.html" target="_blank" rel="noopener noreferrer">invoke<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> or <a href="https://docs.rs/solana-program/latest/solana_program/program/fn.invoke_signed.html" target="_blank" rel="noopener noreferrer">invoke_signed<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> encontrada no crate <code>solana_program</code>.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// Usado quando não são necessárias assinaturas para PDAs</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">invoke</span><span class="token punctuation">(</span>
    instruction<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Instruction</span><span class="token punctuation">,</span>
    account_infos<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span>

<span class="token comment">// Usado quando um programa precisa fornecer uma &#39;assinatura&#39; para um PDA, daí o parâmetro signer_seeds</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">invoke_signed</span><span class="token punctuation">(</span>
    instruction<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Instruction</span><span class="token punctuation">,</span>
    account_infos<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    signers_seeds<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Para fazer uma CPI, você deve especificar e construir uma instrução no programa que está sendo invocado e fornecer uma lista de contas necessárias para essa instrução. Se um PDA for necessário como signatário, <code>signers_seeds</code> também deve ser preenchido ao usar a função <code>invoke_signed</code>.</p><h3 id="cpi-com-invoke" tabindex="-1"><a class="header-anchor" href="#cpi-com-invoke" aria-hidden="true">#</a> CPI com <code>invoke</code></h3><p>A função <code>invoke</code> é usada ao fazer uma CPI que não requer que nenhum PDA atue como signatário. Ao fazer CPIs, o tempo de execução da Solana estende a assinatura original passada para um programa ao programa chamado.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token function">invoke</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span>some_instruction<span class="token punctuation">,</span>                           <span class="token comment">// instrução para invocar</span>
    <span class="token operator">&amp;</span><span class="token punctuation">[</span>account_one<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> account_two<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// contas exigidas por instrução</span>
<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="cpi-com-invoke-signed" tabindex="-1"><a class="header-anchor" href="#cpi-com-invoke-signed" aria-hidden="true">#</a> CPI com <code>invoke_signed</code></h3><p>Para fazer uma CPI que requer um PDA como signatário, use a função <code>invoke_signed</code> e forneça as sementes necessárias para derivar o PDA exigido pelo programa chamador.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token function">invoke_signed</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span>some_instruction<span class="token punctuation">,</span>                   <span class="token comment">// instrução para invocar</span>
    <span class="token operator">&amp;</span><span class="token punctuation">[</span>account_one<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pda<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// contas exigidas por instrução, em que a primeira conta é um PDA necessário como signatário</span>
    <span class="token operator">&amp;</span><span class="token punctuation">[</span>signers_seeds<span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token comment">// sementes para derivar o PDA</span>
<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Embora os PDAs não tenham chaves privadas próprias, eles ainda podem atuar como signatários em uma instrução por meio de uma CPI. Para verificar se um PDA pertence ao programa chamador, as sementes usadas para gerar o PDA necessário como signatário devem ser incluídas como <code>signers_seeds</code>.</p><p>O tempo de execução da Solana chamará internamente <code>create_program_address</code> usando as sementes fornecidas e o <code>program_id</code> do programa chamador. O PDA resultante é então comparado com os endereços fornecidos na instrução. Se houver uma correspondência, o PDA é considerado um signatário válido.</p><h3 id="struct-da-cpi-instruction" tabindex="-1"><a class="header-anchor" href="#struct-da-cpi-instruction" aria-hidden="true">#</a> Struct da CPI - <code>Instruction</code></h3><p>Dependendo do programa para o qual você está fazendo a chamada, pode haver uma crate disponível com funções auxiliares para criar a instrução, ou seja, <code>Instruction</code>. Muitas pessoas e organizações criam crates publicamente disponíveis ao lado de seus programas que expõem esses tipos de funções para simplificar a chamada de seus programas.</p><p>A definição do tipo <code>Instruction</code> exigido para uma CPI inclui:</p><ul><li><code>program_id</code> - a chave pública do programa que executa a instrução</li><li><code>accounts</code> - uma lista de todas as contas que podem ser lidas ou escritas durante a execução da instrução</li><li><code>data</code> - os dados de instrução exigidos pela instrução</li></ul><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Instruction</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> program_id<span class="token punctuation">:</span> <span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> accounts<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">AccountMeta</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>A struct <code>AccountMeta</code> tem a seguinte definição:</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">AccountMeta</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> pubkey<span class="token punctuation">:</span> <span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> is_signer<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> is_writable<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Ao criar uma CPI, use a seguinte sintaxe para especificar o <code>AccountMeta</code> para cada conta:</p><ul><li><code>AccountMeta::new</code> - indica que é gravável (writable)</li><li><code>AccountMeta::new_readonly</code> - indica que <em>não</em> é gravável (not writable)</li><li><code>(pubkey, true)</code> - indica que a conta é signatária</li><li><code>(pubkey, false)</code> - indica que a conta <em>não</em> é signatária</li></ul><p>Aqui está um exemplo:</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span>instruction<span class="token punctuation">::</span></span><span class="token class-name">AccountMeta</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> account_metas <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>
    <span class="token class-name">AccountMeta</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>account1_pubkey<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">AccountMeta</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>account2_pubkey<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">AccountMeta</span><span class="token punctuation">::</span><span class="token function">new_readonly</span><span class="token punctuation">(</span>account3_pubkey<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">AccountMeta</span><span class="token punctuation">::</span><span class="token function">new_readonly</span><span class="token punctuation">(</span>account4_pubkey<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="struct-da-cpi-accountinfo" tabindex="-1"><a class="header-anchor" href="#struct-da-cpi-accountinfo" aria-hidden="true">#</a> Struct da CPI - <code>AccountInfo</code></h3><p>Para usar <code>invoke</code> e <code>invoke_signed</code>, também é necessário fornecer uma lista de <code>account_infos</code>. Assim como na lista de <code>AccountMeta</code> na instrução, é necessário incluir todas as ocorrências de <code>AccountInfo</code> de cada conta que o programa chamado lerá ou escreverá.</p><p>Para referência, a struct <code>AccountInfo</code> tem a seguinte definição:</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">/// Informação da conta</span>
<span class="token attribute attr-name">#[derive(Clone)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Chave pública da conta</span>
    <span class="token keyword">pub</span> key<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token comment">/// A transação foi assinada pela chave pública desta conta?</span>
    <span class="token keyword">pub</span> is_signer<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token comment">/// A conta é gravável?</span>
    <span class="token keyword">pub</span> is_writable<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token comment">/// Os lamports na conta. Modificável por programas.</span>
    <span class="token keyword">pub</span> lamports<span class="token punctuation">:</span> <span class="token class-name">Rc</span><span class="token operator">&lt;</span><span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token keyword">mut</span> <span class="token keyword">u64</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
    <span class="token comment">/// Os dados mantidos nesta conta. Modificável por programas.</span>
    <span class="token keyword">pub</span> data<span class="token punctuation">:</span> <span class="token class-name">Rc</span><span class="token operator">&lt;</span><span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
    <span class="token comment">/// Programa que possui esta conta</span>
    <span class="token keyword">pub</span> owner<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Pubkey</span><span class="token punctuation">,</span>
    <span class="token comment">/// Os dados desta conta contêm um programa carregado (e agora são somente leitura)</span>
    <span class="token keyword">pub</span> executable<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token comment">/// A época em que esta conta deverá o próximo aluguel</span>
    <span class="token keyword">pub</span> rent_epoch<span class="token punctuation">:</span> <span class="token class-name">Epoch</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Você pode criar uma cópia do <code>AccountInfo</code> para cada conta necessária usando o trait <a href="https://docs.rs/solana-program/latest/solana_program/account_info/struct.AccountInfo.html#impl-Clone-for-AccountInfo%3C&#39;a%3E" target="_blank" rel="noopener noreferrer">Clone<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, que é implementado para a struct <a href="https://docs.rs/solana-program/latest/solana_program/account_info/struct.AccountInfo.html" target="_blank" rel="noopener noreferrer">AccountInfo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> no crate <code>solana_program</code>.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> accounts_infos <span class="token operator">=</span> <span class="token punctuation">[</span>
    account_one<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    account_two<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    account_three<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Embora esta seção tenha fornecido uma visão geral de alto nível das CPIs, explicações mais detalhadas, exemplos e tutoriais podem ser encontrados nos recursos vinculados abaixo.</p><h2 id="outros-recursos" tabindex="-1"><a class="header-anchor" href="#outros-recursos" aria-hidden="true">#</a> Outros Recursos</h2><ul><li><a href="https://docs.solana.com/developing/programming-model/calling-between-programs#cross-program-invocations" target="_blank" rel="noopener noreferrer">Documentação Oficial<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://solanacookbook.com/references/programs.html#how-to-do-cross-program-invocation" target="_blank" rel="noopener noreferrer">Referência do Livro de Receitas da Solana<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.soldev.app/course/cpi" target="_blank" rel="noopener noreferrer">Curso Solana - Lição sobre a CPI nativa<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.soldev.app/course/anchor-cpi" target="_blank" rel="noopener noreferrer">Curso Solana - Lição sobre a CPI do Anchor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-developers/program-examples/tree/main/basics/cross-program-invocation" target="_blank" rel="noopener noreferrer">Exemplos do Programa de Desenvolvedores da Solana<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: danicuki@gmail.com">Daniel Cukier</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.07ce7a66.js" defer></script>
  </body>
</html>
