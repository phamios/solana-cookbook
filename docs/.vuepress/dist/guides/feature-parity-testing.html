<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Solana Cookbook | Feature Parity Testing"><meta name="og:title" content="Solana Cookbook | Feature Parity Testing"><meta name="description" content="Features vary by Solana cluster. Feature testing ensures predictable results."><meta name="og:description" content="Features vary by Solana cluster. Feature testing ensures predictable results."><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Feature Parity Testing | Solana Cookbook</title>
    <link rel="modulepreload" href="/assets/app.07ce7a66.js"><link rel="modulepreload" href="/assets/feature-parity-testing.html.61786585.js"><link rel="modulepreload" href="/assets/feature-parity-testing.html.2d03e4b5.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Solana Cookbook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribute"><!--[--><!--]--> Contribute <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/guides/feature-parity-testing.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guides/feature-parity-testing.html" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guides/feature-parity-testing.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/guides/feature-parity-testing.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/guides/feature-parity-testing.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/guides/feature-parity-testing.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/feature-parity-testing.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/guides/feature-parity-testing.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guides/feature-parity-testing.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/guides/feature-parity-testing.html" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/guides/feature-parity-testing.html" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/guides/feature-parity-testing.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/guides/feature-parity-testing.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribute"><!--[--><!--]--> Contribute <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/guides/feature-parity-testing.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guides/feature-parity-testing.html" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guides/feature-parity-testing.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/guides/feature-parity-testing.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/guides/feature-parity-testing.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/guides/feature-parity-testing.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/feature-parity-testing.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/guides/feature-parity-testing.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guides/feature-parity-testing.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/guides/feature-parity-testing.html" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/guides/feature-parity-testing.html" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/guides/feature-parity-testing.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/guides/feature-parity-testing.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Getting Started <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/" class="sidebar-item" aria-label="Cooking with Solana"><!--[--><!--]--> Cooking with Solana <!--[--><!--]--></a><!----></li><li><a href="/getting-started/installation.html" class="sidebar-item" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Core Concepts <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/core-concepts/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/core-concepts/programs.html" class="sidebar-item" aria-label="Programs"><!--[--><!--]--> Programs <!--[--><!--]--></a><!----></li><li><a href="/core-concepts/transactions.html" class="sidebar-item" aria-label="Transactions"><!--[--><!--]--> Transactions <!--[--><!--]--></a><!----></li><li><a href="/core-concepts/pdas.html" class="sidebar-item" aria-label="Program Derived Addresses (PDAs)"><!--[--><!--]--> Program Derived Addresses (PDAs) <!--[--><!--]--></a><!----></li><li><a href="/core-concepts/cpi.html" class="sidebar-item" aria-label="Cross Program Invocations (CPIs)"><!--[--><!--]--> Cross Program Invocations (CPIs) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Guides <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/guides/get-program-accounts.html" class="sidebar-item" aria-label="Get Program Accounts"><!--[--><!--]--> Get Program Accounts <!--[--><!--]--></a><!----></li><li><a href="/guides/serialization.html" class="sidebar-item" aria-label="Serializing Data"><!--[--><!--]--> Serializing Data <!--[--><!--]--></a><!----></li><li><a href="/guides/data-migration.html" class="sidebar-item" aria-label="Migrating Program Data Accounts"><!--[--><!--]--> Migrating Program Data Accounts <!--[--><!--]--></a><!----></li><li><a href="/guides/account-maps.html" class="sidebar-item" aria-label="Account Maps"><!--[--><!--]--> Account Maps <!--[--><!--]--></a><!----></li><li><a href="/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="Debugging Solana Programs"><!--[--><!--]--> Debugging Solana Programs <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/feature-parity-testing.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Feature Parity Testing"><!--[--><!--]--> Feature Parity Testing <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guides/feature-parity-testing.html#facts" class="router-link-active router-link-exact-active sidebar-item" aria-label="Facts"><!--[--><!--]--> Facts <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/feature-parity-testing.html#scenario" class="router-link-active router-link-exact-active sidebar-item" aria-label="Scenario"><!--[--><!--]--> Scenario <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/feature-parity-testing.html#feature-status" class="router-link-active router-link-exact-active sidebar-item" aria-label="Feature Status"><!--[--><!--]--> Feature Status <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/feature-parity-testing.html#parity-testing" class="router-link-active router-link-exact-active sidebar-item" aria-label="Parity Testing"><!--[--><!--]--> Parity Testing <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/feature-parity-testing.html#simple-demonstration" class="router-link-active router-link-exact-active sidebar-item" aria-label="Simple Demonstration"><!--[--><!--]--> Simple Demonstration <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guides/feature-parity-testing.html#all-features-activated" class="router-link-active router-link-exact-active sidebar-item" aria-label="All features activated"><!--[--><!--]--> All features activated <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/feature-parity-testing.html#selective-features-deactivated" class="router-link-active router-link-exact-active sidebar-item" aria-label="Selective features deactivated"><!--[--><!--]--> Selective features deactivated <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guides/feature-parity-testing.html#full-parity-testing" class="router-link-active router-link-exact-active sidebar-item" aria-label="Full Parity Testing"><!--[--><!--]--> Full Parity Testing <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/feature-parity-testing.html#full-parity-testing-programmatically" class="router-link-active router-link-exact-active sidebar-item" aria-label="Full Parity Testing Programmatically"><!--[--><!--]--> Full Parity Testing Programmatically <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/feature-parity-testing.html#resources" class="router-link-active router-link-exact-active sidebar-item" aria-label="Resources"><!--[--><!--]--> Resources <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/guides/versioned-transactions.html" class="sidebar-item" aria-label="Versioned Transactions"><!--[--><!--]--> Versioned Transactions <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">References <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/references/local-development.html" class="sidebar-item" aria-label="Local Development"><!--[--><!--]--> Local Development <!--[--><!--]--></a><!----></li><li><a href="/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="Keypairs and Wallets"><!--[--><!--]--> Keypairs and Wallets <!--[--><!--]--></a><!----></li><li><a href="/references/basic-transactions.html" class="sidebar-item" aria-label="Sending Transactions"><!--[--><!--]--> Sending Transactions <!--[--><!--]--></a><!----></li><li><a href="/references/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/references/programs.html" class="sidebar-item" aria-label="Writing Programs"><!--[--><!--]--> Writing Programs <!--[--><!--]--></a><!----></li><li><a href="/references/token.html" class="sidebar-item" aria-label="Interacting with Tokens"><!--[--><!--]--> Interacting with Tokens <!--[--><!--]--></a><!----></li><li><a href="/references/staking.html" class="sidebar-item" aria-label="Staking"><!--[--><!--]--> Staking <!--[--><!--]--></a><!----></li><li><a href="/references/nfts.html" class="sidebar-item" aria-label="NFTs"><!--[--><!--]--> NFTs <!--[--><!--]--></a><!----></li><li><a href="/references/offline-transactions.html" class="sidebar-item" aria-label="Sending Offline Transactions"><!--[--><!--]--> Sending Offline Transactions <!--[--><!--]--></a><!----></li><li><a href="/references/name-service.html" class="sidebar-item" aria-label="Name Service"><!--[--><!--]--> Name Service <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item collapsible">Gaming <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/gaming/intro.html" class="sidebar-item" aria-label="Introduction to Gaming on Solana"><!--[--><!--]--> Introduction to Gaming on Solana <!--[--><!--]--></a><!----></li><li><a href="/gaming/game-sdks.html" class="sidebar-item" aria-label="Solana Gaming SDKs"><!--[--><!--]--> Solana Gaming SDKs <!--[--><!--]--></a><!----></li><li><a href="/gaming/nfts-in-games.html" class="sidebar-item" aria-label="Gaming with NFTs"><!--[--><!--]--> Gaming with NFTs <!--[--><!--]--></a><!----></li><li><a href="/gaming/hello-world.html" class="sidebar-item" aria-label="Hello World example"><!--[--><!--]--> Hello World example <!--[--><!--]--></a><!----></li><li><a href="/gaming/store-sol-in-pda.html" class="sidebar-item" aria-label="Storing SOL in a PDA"><!--[--><!--]--> Storing SOL in a PDA <!--[--><!--]--></a><!----></li><li><a href="/gaming/saving-game-state.html" class="sidebar-item" aria-label="Saving game state"><!--[--><!--]--> Saving game state <!--[--><!--]--></a><!----></li><li><a href="/gaming/energy-system.html" class="sidebar-item" aria-label="Energy System"><!--[--><!--]--> Energy System <!--[--><!--]--></a><!----></li><li><a href="/gaming/interact-with-tokens.html" class="sidebar-item" aria-label="How interact with tokens in programs"><!--[--><!--]--> How interact with tokens in programs <!--[--><!--]--></a><!----></li><li><a href="/gaming/porting-anchor-to-unity.html" class="sidebar-item" aria-label="Port Anchor to Unity"><!--[--><!--]--> Port Anchor to Unity <!--[--><!--]--></a><!----></li><li><a href="/gaming/distribution.html" class="sidebar-item" aria-label="Distribution"><!--[--><!--]--> Distribution <!--[--><!--]--></a><!----></li><li><a href="/gaming/game-examples.html" class="sidebar-item" aria-label="Learn By Example"><!--[--><!--]--> Learn By Example <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="feature-parity-testing" tabindex="-1"><a class="header-anchor" href="#feature-parity-testing" aria-hidden="true">#</a> Feature Parity Testing</h1><p>When testing your program, assurances that it will run the same in various clusters is essential to both quality and producing expected outcomes.</p><h2 id="facts" tabindex="-1"><a class="header-anchor" href="#facts" aria-hidden="true">#</a> Facts</h2><div class="custom-container tip"><p class="custom-container-title">Fact Sheet</p><ul><li>Features are capabilities that are introduced to Solana validators and require activation to be used.</li><li>Features may be activated in one cluster (e.g. testnet) but not so in another (e.g. mainnet-beta).</li><li>However; when running default <code>solana-test-validator</code> locally, all available features in your Solana version are automagically activated. The result is that when testing locally, the capabilities and results of your testing may not be the same when deploying and running in a different cluster!</li></ul></div><h2 id="scenario" tabindex="-1"><a class="header-anchor" href="#scenario" aria-hidden="true">#</a> Scenario</h2><p>Assume you have a Transaction that contained three (3) instructions and each instruction consumes approximately 100_000 Compute Units (CU). When running in a Solana 1.8.x version, you would observe your instruction CU consumption similar to:</p><table><thead><tr><th>Instruction</th><th>Starting CU</th><th>Execution</th><th>Remaining CU</th></tr></thead><tbody><tr><td>1</td><td>200_000</td><td>-100_000</td><td>100_000</td></tr><tr><td>2</td><td>200_000</td><td>-100_000</td><td>100_000</td></tr><tr><td>3</td><td>200_000</td><td>-100_000</td><td>100_000</td></tr></tbody></table><p>In Solana 1.9.2 a feature called &#39;transaction wide compute cap&#39; was introduced where a Transaction, by default, has a 200_000 CU budget and the encapsulated instructions <strong><em>draw down</em></strong> from that Transaction budget. Running the same transaction as noted above would have very different behavior:</p><table><thead><tr><th>Instruction</th><th>Starting CU</th><th>Execution</th><th>Remaining CU</th></tr></thead><tbody><tr><td>1</td><td>200_000</td><td>-100_000</td><td>100_000</td></tr><tr><td>2</td><td>100_000</td><td>-100_000</td><td>0</td></tr><tr><td>3</td><td>0</td><td>FAIL!!!</td><td>FAIL!!!</td></tr></tbody></table><p>Yikes! If you were unaware of this you&#39;d likely be frustrated as there was no change to your instruction behavior that would cause this. In devnet it worked fine, but locally it was failing?!?</p><p>There is the ability to increase the overall Transaction budget, to lets say 300_000 CU, and salvage your sanity but this demonstrates why testing with <strong><em>Feature Parity</em></strong> provides a proactive way to avoid any confusion.</p><h2 id="feature-status" tabindex="-1"><a class="header-anchor" href="#feature-status" aria-hidden="true">#</a> Feature Status</h2><p>It is fairly easy to check what features are enabled for a particular cluster with the <code>solana feature status</code> command.</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana feature status -ud   // Displays by feature status for devnet
solana feature status -ut   // Displays for testnet
solana feature status -um   // Displays for mainnet-beta
solana feature status -ul   // Displays for local, requires running solana-test-validator
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Alternatively, you could use a tool like <a href="#resources">scfsd</a> to observe all feature state across clusters which would display, partial screen shown here, and does not require <code>solana-test-validator</code> to be running:</p><img src="/assets/scfsd.cc67ec33.png" alt="Feature Status Heatmap"><h2 id="parity-testing" tabindex="-1"><a class="header-anchor" href="#parity-testing" aria-hidden="true">#</a> Parity Testing</h2><p>As noted above, the <code>solana-test-validator</code> activates <strong>all</strong> features automagically. So to answer the question &quot;How can I test locally in an environment that has parity with devnet, testnet or even mainnet-beta?&quot;.</p><p>Solution: PRs were added to Solana 1.9.6 to allow deactivation of features:</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana-test-validator --deactivate-feature &lt;FEATURE_PUBKEY&gt; ...
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="simple-demonstration" tabindex="-1"><a class="header-anchor" href="#simple-demonstration" aria-hidden="true">#</a> Simple Demonstration</h2><p>Suppose you have a simple program that logs the data it receives in it&#39;s entry-point. And you are testing a transaction that adds two (2) instructions for your program.</p><h3 id="all-features-activated" tabindex="-1"><a class="header-anchor" href="#all-features-activated" aria-hidden="true">#</a> All features activated</h3><ol><li>You start the test validator in one terminal:</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana config set -ul
solana-test-validator -l ./ledger --bpf-program ADDRESS target/deploy/PROGNAME.so --reset`
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>In another terminal you start the log streamer:</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana logs
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="3"><li>You then run your transaction. You would see something similar in the log terminal (edited for clarity):</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc invoke [1]
Program log: process_instruction: PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc: 0 accounts, data=[0]
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc consumed 12843 of 200000 compute units
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc success
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc invoke [1]
Program log: process_instruction: PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc: 0 accounts, data=[1]
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc consumed 12843 of 187157 compute units
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc success[
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Because our feature &#39;transaction wide compute cap&#39; is automatically activated by default, we observe each instruction drawing down CU from the starting Transaction budget of 200_000 CU.</p><h3 id="selective-features-deactivated" tabindex="-1"><a class="header-anchor" href="#selective-features-deactivated" aria-hidden="true">#</a> Selective features deactivated</h3><ol><li>For this run, we want to run so that the CU budget behavior is in parity with what is running in devnet. Using the tool(s) described in <a href="#feature-status">Feature Status</a> we isolate the <code>transaction wide compute cap</code> public key and use the <code>--deactivate-feature</code> on the test validator startup</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana-test-validator -l ./ledger --deactivate-feature 5ekBxc8itEnPv4NzGJtr8BVVQLNMQuLMNQQj7pHoLNZ9 --bpf-program target/deploy/PROGNAME.so --reset`
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>We now see in our logs that our instructions now have their own 200_000 CU budget (edited for clarity) which is currently the state in all upstream clusters:</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc invoke [1]
Program log: process_instruction: PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc: 0 accounts, data=[0]
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc consumed 12843 of 200000 compute units
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc success
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc invoke [1]
Program log: process_instruction: PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc: 0 accounts, data=[0]
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc consumed 12843 of 200000 compute units
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc success
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="full-parity-testing" tabindex="-1"><a class="header-anchor" href="#full-parity-testing" aria-hidden="true">#</a> Full Parity Testing</h2><p>You can be in full parity with a specific cluster by identifying each feature that is not yet activated and add a <code>--deactivate-feature &lt;FEATURE_PUBKEY&gt;</code> for each when invoking <code>solana-test-validator</code>:</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana-test-validator --deactivate-feature PUBKEY_1 --deactivate-feature PUBKEY_2 ...
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Alternatively, <a href="#resources">scfsd</a> provides a command switch to output the complete deactivated feature set for a cluster to feed directly into the <code>solana-test-validator</code> startup:</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana-test-validator -l ./.ledger $(scfsd -c devnet -k -t)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>If you open another terminal, while the validator is running, and <code>solana feature status</code> you will see features deactivated that were found deactivated in devnet</p><h2 id="full-parity-testing-programmatically" tabindex="-1"><a class="header-anchor" href="#full-parity-testing-programmatically" aria-hidden="true">#</a> Full Parity Testing Programmatically</h2><p>For those who control running the test validator within their test code, modifying the test validator activated/deactivated features is possible using TestValidatorGenesis. With Solana 1.9.6 a function has been added to the validator builder to support this.</p><p>At the root of your program folder, create a new folder called <code>tests</code> and add a <code>parity_test.rs</code> file. Here is the boiler place functions (boiler-plate if you will) used by each test</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Test Boiler Plate</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">tests</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>error<span class="token punctuation">,</span> <span class="token namespace">path<span class="token punctuation">::</span></span><span class="token class-name">PathBuf</span><span class="token punctuation">,</span> <span class="token keyword">str</span><span class="token punctuation">::</span><span class="token class-name">FromStr</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Use gadget-scfs to get interegate feature lists from clusters</span>
    <span class="token comment">// must have `gadgets-scfs = &quot;0.2.0&quot; in Cargo.toml [dev-dependencies] to use</span>
    <span class="token keyword">use</span> <span class="token namespace">gadgets_scfs<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">ScfsCriteria</span><span class="token punctuation">,</span> <span class="token class-name">ScfsMatrix</span><span class="token punctuation">,</span> <span class="token constant">SCFS_DEVNET</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">use</span> <span class="token namespace">solana_client<span class="token punctuation">::</span>rpc_client<span class="token punctuation">::</span></span><span class="token class-name">RpcClient</span><span class="token punctuation">;</span>
    <span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">instruction<span class="token punctuation">::</span></span><span class="token class-name">Instruction</span><span class="token punctuation">,</span> <span class="token namespace">message<span class="token punctuation">::</span></span><span class="token class-name">Message</span><span class="token punctuation">,</span> <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">use</span> <span class="token namespace">solana_sdk<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
        <span class="token comment">// Added in Solana 1.9.2</span>
        <span class="token namespace">compute_budget<span class="token punctuation">::</span></span><span class="token class-name">ComputeBudgetInstruction</span><span class="token punctuation">,</span>
        pubkey<span class="token punctuation">,</span>
        <span class="token namespace">signature<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Keypair</span><span class="token punctuation">,</span> <span class="token class-name">Signature</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token namespace">signer<span class="token punctuation">::</span></span><span class="token class-name">Signer</span><span class="token punctuation">,</span>
        <span class="token namespace">transaction<span class="token punctuation">::</span></span><span class="token class-name">Transaction</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Extended in Solana 1.9.6</span>
    <span class="token keyword">use</span> <span class="token namespace">solana_test_validator<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">TestValidator</span><span class="token punctuation">,</span> <span class="token class-name">TestValidatorGenesis</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">/// Location/Name of ProgramTestGenesis ledger</span>
    <span class="token keyword">const</span> <span class="token constant">LEDGER_PATH</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;./.ledger&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">/// Path to BPF program (*.so) change if needed</span>
    <span class="token keyword">const</span> <span class="token constant">PROG_PATH</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;target/deploy/&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">/// Program name from program Cargo.toml</span>
    <span class="token comment">/// FILL IN WITH YOUR PROGRAM_NAME</span>
    <span class="token keyword">const</span> <span class="token constant">PROG_NAME</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;PROGRAM_NAME&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">/// Program public key</span>
    <span class="token comment">/// FILL IN WITH YOUR PROGRAM&#39;S PUBLIC KEY str</span>
    <span class="token keyword">const</span> <span class="token constant">PROG_KEY</span><span class="token punctuation">:</span> <span class="token class-name">Pubkey</span> <span class="token operator">=</span> <span class="token macro property">pubkey!</span><span class="token punctuation">(</span><span class="token string">&quot;PROGRAMS_PUBLIC_KEY_BASE58_STRING&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/// &#39;transaction wide compute cap&#39; public key</span>
    <span class="token keyword">const</span> <span class="token constant">TXWIDE_LIMITS</span><span class="token punctuation">:</span> <span class="token class-name">Pubkey</span> <span class="token operator">=</span> <span class="token macro property">pubkey!</span><span class="token punctuation">(</span><span class="token string">&quot;5ekBxc8itEnPv4NzGJtr8BVVQLNMQuLMNQQj7pHoLNZ9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// Setup the test validator passing features</span>
    <span class="token comment">/// you want to deactivate before running transactions</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">setup_validator</span><span class="token punctuation">(</span>
        invalidate_features<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Pubkey</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">TestValidator</span><span class="token punctuation">,</span> <span class="token class-name">Keypair</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Extend environment variable to include our program location</span>
        <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">set_var</span><span class="token punctuation">(</span><span class="token string">&quot;BPF_OUT_DIR&quot;</span><span class="token punctuation">,</span> <span class="token constant">PROG_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Instantiate the test validator</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> test_validator <span class="token operator">=</span> <span class="token class-name">TestValidatorGenesis</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Once instantiated, TestValidatorGenesis configuration functions follow</span>
        <span class="token comment">// a builder pattern enabling chaining of settings function calls</span>
        <span class="token keyword">let</span> <span class="token punctuation">(</span>test_validator<span class="token punctuation">,</span> kp<span class="token punctuation">)</span> <span class="token operator">=</span> test_validator
            <span class="token comment">// Set the ledger path and name</span>
            <span class="token comment">// maps to `solana-test-validator --ledger &lt;DIR&gt;`</span>
            <span class="token punctuation">.</span><span class="token function">ledger_path</span><span class="token punctuation">(</span><span class="token constant">LEDGER_PATH</span><span class="token punctuation">)</span>
            <span class="token comment">// Load our program. Ignored if reusing ledger</span>
            <span class="token comment">// maps to `solana-test-validator --bpf-program &lt;ADDRESS_OR_PATH BPF_PROGRAM.SO&gt;`</span>
            <span class="token punctuation">.</span><span class="token function">add_program</span><span class="token punctuation">(</span><span class="token constant">PROG_NAME</span><span class="token punctuation">,</span> <span class="token constant">PROG_KEY</span><span class="token punctuation">)</span>
            <span class="token comment">// Identify features to deactivate. Ignored if reusing ledger</span>
            <span class="token comment">// maps to `solana-test-validator --deactivate-feature &lt;FEATURE_PUBKEY&gt;`</span>
            <span class="token punctuation">.</span><span class="token function">deactivate_features</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>invalidate_features<span class="token punctuation">)</span>
            <span class="token comment">// Start the test validator</span>
            <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>test_validator<span class="token punctuation">,</span> kp<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// Convenience function to remove existing ledger before TestValidatorGenesis setup</span>
    <span class="token comment">/// maps to `solana-test-validator ... --reset`</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">clean_ledger_setup_validator</span><span class="token punctuation">(</span>
        invalidate_features<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Pubkey</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">TestValidator</span><span class="token punctuation">,</span> <span class="token class-name">Keypair</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token constant">LEDGER_PATH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token function">remove_dir_all</span><span class="token punctuation">(</span><span class="token constant">LEDGER_PATH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setup_validator</span><span class="token punctuation">(</span>invalidate_features<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// Submits a transaction with programs instruction</span>
    <span class="token comment">/// Boiler plate</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">submit_transaction</span><span class="token punctuation">(</span>
        rpc_client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">RpcClient</span><span class="token punctuation">,</span>
        wallet_signer<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Signer</span><span class="token punctuation">,</span>
        instructions<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Instruction</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Signature</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> transaction <span class="token operator">=</span>
            <span class="token class-name">Transaction</span><span class="token punctuation">::</span><span class="token function">new_unsigned</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>instructions<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wallet_signer<span class="token punctuation">.</span><span class="token function">pubkey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> recent_blockhash <span class="token operator">=</span> rpc_client
            <span class="token punctuation">.</span><span class="token function">get_latest_blockhash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: unable to get recent blockhash: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
        transaction
            <span class="token punctuation">.</span><span class="token function">try_sign</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">vec!</span><span class="token punctuation">[</span>wallet_signer<span class="token punctuation">]</span><span class="token punctuation">,</span> recent_blockhash<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: failed to sign transaction: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> signature <span class="token operator">=</span> rpc_client
            <span class="token punctuation">.</span><span class="token function">send_and_confirm_transaction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>transaction<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: send transaction: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// UNIT TEST FOLLOWS</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">/// Setup the test validator passing features</span>
<span class="token comment">/// you want to deactivate before running transactions</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">setup_validator</span><span class="token punctuation">(</span>
    invalidate_features<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Pubkey</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">TestValidator</span><span class="token punctuation">,</span> <span class="token class-name">Keypair</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Extend environment variable to include our program location</span>
    <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">set_var</span><span class="token punctuation">(</span><span class="token string">&quot;BPF_OUT_DIR&quot;</span><span class="token punctuation">,</span> <span class="token constant">PROG_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Instantiate the test validator</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> test_validator <span class="token operator">=</span> <span class="token class-name">TestValidatorGenesis</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Once instantiated, TestValidatorGenesis configuration functions follow</span>
    <span class="token comment">// a builder pattern enabling chaining of settings function calls</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>test_validator<span class="token punctuation">,</span> kp<span class="token punctuation">)</span> <span class="token operator">=</span> test_validator
        <span class="token comment">// Set the ledger path and name</span>
        <span class="token comment">// maps to `solana-test-validator --ledger &lt;DIR&gt;`</span>
        <span class="token punctuation">.</span><span class="token function">ledger_path</span><span class="token punctuation">(</span><span class="token constant">LEDGER_PATH</span><span class="token punctuation">)</span>
        <span class="token comment">// Load our program. Ignored if reusing ledger</span>
        <span class="token comment">// maps to `solana-test-validator --bpf-program &lt;ADDRESS_OR_PATH BPF_PROGRAM.SO&gt;`</span>
        <span class="token punctuation">.</span><span class="token function">add_program</span><span class="token punctuation">(</span><span class="token constant">PROG_NAME</span><span class="token punctuation">,</span> <span class="token constant">PROG_KEY</span><span class="token punctuation">)</span>
        <span class="token comment">// Identify features to deactivate. Ignored if reusing ledger</span>
        <span class="token comment">// maps to `solana-test-validator --deactivate-feature &lt;FEATURE_PUBKEY&gt;`</span>
        <span class="token punctuation">.</span><span class="token function">deactivate_features</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>invalidate_features<span class="token punctuation">)</span>
        <span class="token comment">// Start the test validator</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>test_validator<span class="token punctuation">,</span> kp<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Convenience function to remove existing ledger before TestValidatorGenesis setup</span>
<span class="token comment">/// maps to `solana-test-validator ... --reset`</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">clean_ledger_setup_validator</span><span class="token punctuation">(</span>
    invalidate_features<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Pubkey</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">TestValidator</span><span class="token punctuation">,</span> <span class="token class-name">Keypair</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token constant">LEDGER_PATH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token function">remove_dir_all</span><span class="token punctuation">(</span><span class="token constant">LEDGER_PATH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setup_validator</span><span class="token punctuation">(</span>invalidate_features<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Submits a transaction with programs instruction</span>
<span class="token comment">/// Boiler plate</span>
<span class="token keyword">fn</span> <span class="token function-definition function">submit_transaction</span><span class="token punctuation">(</span>
    rpc_client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">RpcClient</span><span class="token punctuation">,</span>
    wallet_signer<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Signer</span><span class="token punctuation">,</span>
    instructions<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Instruction</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Signature</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> transaction <span class="token operator">=</span>
        <span class="token class-name">Transaction</span><span class="token punctuation">::</span><span class="token function">new_unsigned</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>instructions<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wallet_signer<span class="token punctuation">.</span><span class="token function">pubkey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> recent_blockhash <span class="token operator">=</span> rpc_client
        <span class="token punctuation">.</span><span class="token function">get_latest_blockhash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: unable to get recent blockhash: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    transaction
        <span class="token punctuation">.</span><span class="token function">try_sign</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">vec!</span><span class="token punctuation">[</span>wallet_signer<span class="token punctuation">]</span><span class="token punctuation">,</span> recent_blockhash<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: failed to sign transaction: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> signature <span class="token operator">=</span> rpc_client
        <span class="token punctuation">.</span><span class="token function">send_and_confirm_transaction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>transaction<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: send transaction: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><!--]--></div></div><!--]--></div><p>We can now add test functions in the body of <code>mod test {...}</code> to demonstrate default validator setup (all features enabled) and then disabling the <code>transaction wide compute cap</code> as per previous examples running <code>solana-test-validator</code> from the command line.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">All Features Test</button></li><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Disable Tx CU Test</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test_base_pass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Run with all features activated (default for TestValidatorGenesis)</span>
    <span class="token keyword">let</span> inv_feat <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Start validator with clean (new) ledger</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>test_validator<span class="token punctuation">,</span> main_payer<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">clean_ledger_setup_validator</span><span class="token punctuation">(</span>inv_feat<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get the RpcClient</span>
    <span class="token keyword">let</span> connection <span class="token operator">=</span> test_validator<span class="token punctuation">.</span><span class="token function">get_rpc_client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Capture our programs log statements</span>
    <span class="token namespace">solana_logger<span class="token punctuation">::</span></span><span class="token function">setup_with_default</span><span class="token punctuation">(</span><span class="token string">&quot;solana_runtime::message=debug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// This example doesn&#39;t require sending any accounts to program</span>
    <span class="token keyword">let</span> accounts <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Build instruction array and submit transaction</span>
    <span class="token keyword">let</span> txn <span class="token operator">=</span> <span class="token function">submit_transaction</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>connection<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>main_payer<span class="token punctuation">,</span>
        <span class="token comment">// Add two (2) instructions to transaction to demonstrate</span>
        <span class="token comment">// that each instruction CU draws down from default Transaction CU (200_000)</span>
        <span class="token comment">// Replace with instructions that make sense for your program</span>
        <span class="token punctuation">[</span>
            <span class="token class-name">Instruction</span><span class="token punctuation">::</span><span class="token function">new_with_borsh</span><span class="token punctuation">(</span><span class="token constant">PROG_KEY</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">0u8</span><span class="token punctuation">,</span> accounts<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Instruction</span><span class="token punctuation">::</span><span class="token function">new_with_borsh</span><span class="token punctuation">(</span><span class="token constant">PROG_KEY</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">1u8</span><span class="token punctuation">,</span> accounts<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span>txn<span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><!--]--></div><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test_deactivate_tx_cu_pass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Run with all features activated except &#39;transaction wide compute cap&#39;</span>
    <span class="token keyword">let</span> inv_feat <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token constant">TXWIDE_LIMITS</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Start validator with clean (new) ledger</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>test_validator<span class="token punctuation">,</span> main_payer<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">clean_ledger_setup_validator</span><span class="token punctuation">(</span>inv_feat<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get the RpcClient</span>
    <span class="token keyword">let</span> connection <span class="token operator">=</span> test_validator<span class="token punctuation">.</span><span class="token function">get_rpc_client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Capture our programs log statements</span>
    <span class="token namespace">solana_logger<span class="token punctuation">::</span></span><span class="token function">setup_with_default</span><span class="token punctuation">(</span><span class="token string">&quot;solana_runtime::message=debug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// This example doesn&#39;t require sending any accounts to program</span>
    <span class="token keyword">let</span> accounts <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Build instruction array and submit transaction</span>
    <span class="token keyword">let</span> txn <span class="token operator">=</span> <span class="token function">submit_transaction</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>connection<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>main_payer<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token comment">// This instruction adds CU to transaction budget (1.9.2) but does nothing</span>
            <span class="token comment">// when we deactivate the &#39;transaction wide compute cap&#39; feature</span>
            <span class="token class-name">ComputeBudgetInstruction</span><span class="token punctuation">::</span><span class="token function">request_units</span><span class="token punctuation">(</span><span class="token number">400_000u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// Add two (2) instructions to transaction</span>
            <span class="token comment">// Replace with instructions that make sense for your program</span>
            <span class="token comment">// You will see that each instruction has the 1.8.x 200_000 CU per budget</span>
            <span class="token class-name">Instruction</span><span class="token punctuation">::</span><span class="token function">new_with_borsh</span><span class="token punctuation">(</span><span class="token constant">PROG_KEY</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">0u8</span><span class="token punctuation">,</span> accounts<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Instruction</span><span class="token punctuation">::</span><span class="token function">new_with_borsh</span><span class="token punctuation">(</span><span class="token constant">PROG_KEY</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">1u8</span><span class="token punctuation">,</span> accounts<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span>txn<span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><!--]--></div><!--]--></div><p>Alternatively, the <a href="#resources">scfs engine gadget</a> can produce a full vector of deactivated features for a cluster. The following demonstrates using that engine to get a list of all deactivated features for devnet.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Devnet Parity</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test_devnet_parity_pass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Use gadget-scfs to get all deactivated features from devnet</span>
    <span class="token comment">// must have `gadgets-scfs = &quot;0.2.0&quot; in Cargo.toml to use</span>
    <span class="token comment">// Here we setup for a run that samples features only</span>
    <span class="token comment">// from devnet</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> my_matrix <span class="token operator">=</span> <span class="token class-name">ScfsMatrix</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">ScfsCriteria</span> <span class="token punctuation">{</span>
        clusters<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token constant">SCFS_DEVNET</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Run the sampler matrix</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span>my_matrix<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get all deactivated features</span>
    <span class="token keyword">let</span> deactivated <span class="token operator">=</span> my_matrix
        <span class="token punctuation">.</span><span class="token function">get_features</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">ScfsMatrix</span><span class="token punctuation">::</span>any_inactive<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Confirm we have them</span>
    <span class="token macro property">assert_ne!</span><span class="token punctuation">(</span>deactivated<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Setup test validator and logging while deactivating all</span>
    <span class="token comment">// features that are deactivated in devnet</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>test_validator<span class="token punctuation">,</span> main_payer<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">clean_ledger_setup_validator</span><span class="token punctuation">(</span>deactivated<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> connection <span class="token operator">=</span> test_validator<span class="token punctuation">.</span><span class="token function">get_rpc_client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">solana_logger<span class="token punctuation">::</span></span><span class="token function">setup_with_default</span><span class="token punctuation">(</span><span class="token string">&quot;solana_runtime::message=debug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> accounts <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> txn <span class="token operator">=</span> <span class="token function">submit_transaction</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>connection<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>main_payer<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token comment">// Add two (2) instructions to transaction</span>
            <span class="token comment">// Replace with instructions that make sense for your program</span>
            <span class="token class-name">Instruction</span><span class="token punctuation">::</span><span class="token function">new_with_borsh</span><span class="token punctuation">(</span><span class="token constant">PROG_KEY</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">0u8</span><span class="token punctuation">,</span> accounts<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Instruction</span><span class="token punctuation">::</span><span class="token function">new_with_borsh</span><span class="token punctuation">(</span><span class="token constant">PROG_KEY</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">1u8</span><span class="token punctuation">,</span> accounts<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span>txn<span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><!--]--></div><!--]--></div><p>Happy Testing!</p><h2 id="resources" tabindex="-1"><a class="header-anchor" href="#resources" aria-hidden="true">#</a> Resources</h2><p><a href="https://github.com/FrankC01/solana-gadgets/tree/main/rust/scfsd" target="_blank" rel="noopener noreferrer">scfsd<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://github.com/FrankC01/solana-gadgets/tree/main/rust/gadgets-scfs" target="_blank" rel="noopener noreferrer">gadget-scfs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 5435165+FrankC01@users.noreply.github.com">Frank V. Castellucci</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: frankiecast@gmail.com">Frank V. Castellucci</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: jacob.creech@solana.com">Jacob Creech</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: lykov.kirill@gmail.com">kirill lykov</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/guides/debugging-solana-programs.html" class="" aria-label="Debugging Solana Programs"><!--[--><!--]--> Debugging Solana Programs <!--[--><!--]--></a></span><span class="next"><a href="/guides/versioned-transactions.html" class="" aria-label="Versioned Transactions"><!--[--><!--]--> Versioned Transactions <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.07ce7a66.js" defer></script>
  </body>
</html>
