<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Solana Cookbook | Serializing Data"><meta name="og:title" content="Solana Cookbook | Serializing Data"><meta name="description" content="Learn how to serialize and deserialize data on Solana"><meta name="og:description" content="Learn how to serialize and deserialize data on Solana"><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Serializing Data | Solana Cookbook</title>
    <link rel="modulepreload" href="/assets/app.07ce7a66.js"><link rel="modulepreload" href="/assets/serialization.html.32c33a1b.js"><link rel="modulepreload" href="/assets/serialization.html.bb0b6d3d.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Solana Cookbook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribute"><!--[--><!--]--> Contribute <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/guides/serialization.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guides/serialization.html" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guides/serialization.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/guides/serialization.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/guides/serialization.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/guides/serialization.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/serialization.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/guides/serialization.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guides/serialization.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/guides/serialization.html" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/guides/serialization.html" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/guides/serialization.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/guides/serialization.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribute"><!--[--><!--]--> Contribute <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/guides/serialization.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/guides/serialization.html" class="" aria-label="中文（简体）"><!--[--><!--]--> 中文（简体） <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guides/serialization.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/guides/serialization.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/guides/serialization.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/guides/serialization.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/serialization.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/guides/serialization.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guides/serialization.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/kr/guides/serialization.html" class="" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/guides/serialization.html" class="" aria-label="Türkçe"><!--[--><!--]--> Türkçe <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/guides/serialization.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fil/guides/serialization.html" class="" aria-label="Filipino"><!--[--><!--]--> Filipino <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Getting Started <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/" class="sidebar-item" aria-label="Cooking with Solana"><!--[--><!--]--> Cooking with Solana <!--[--><!--]--></a><!----></li><li><a href="/getting-started/installation.html" class="sidebar-item" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Core Concepts <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/core-concepts/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/core-concepts/programs.html" class="sidebar-item" aria-label="Programs"><!--[--><!--]--> Programs <!--[--><!--]--></a><!----></li><li><a href="/core-concepts/transactions.html" class="sidebar-item" aria-label="Transactions"><!--[--><!--]--> Transactions <!--[--><!--]--></a><!----></li><li><a href="/core-concepts/pdas.html" class="sidebar-item" aria-label="Program Derived Addresses (PDAs)"><!--[--><!--]--> Program Derived Addresses (PDAs) <!--[--><!--]--></a><!----></li><li><a href="/core-concepts/cpi.html" class="sidebar-item" aria-label="Cross Program Invocations (CPIs)"><!--[--><!--]--> Cross Program Invocations (CPIs) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Guides <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/guides/get-program-accounts.html" class="sidebar-item" aria-label="Get Program Accounts"><!--[--><!--]--> Get Program Accounts <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/serialization.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Serializing Data"><!--[--><!--]--> Serializing Data <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guides/serialization.html#setting-up-for-borsh-serialization" class="router-link-active router-link-exact-active sidebar-item" aria-label="Setting up for Borsh Serialization"><!--[--><!--]--> Setting up for Borsh Serialization <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/serialization.html#how-to-serialize-instruction-data-on-the-client" class="router-link-active router-link-exact-active sidebar-item" aria-label="How to serialize instruction data on the client"><!--[--><!--]--> How to serialize instruction data on the client <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/serialization.html#how-to-deserialize-instruction-data-on-the-program" class="router-link-active router-link-exact-active sidebar-item" aria-label="How to deserialize instruction data on the program"><!--[--><!--]--> How to deserialize instruction data on the program <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/serialization.html#how-to-serialize-account-data-on-the-program" class="router-link-active router-link-exact-active sidebar-item" aria-label="How to serialize account data on the program"><!--[--><!--]--> How to serialize account data on the program <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guides/serialization.html#pack" class="router-link-active router-link-exact-active sidebar-item" aria-label="Pack"><!--[--><!--]--> Pack <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/serialization.html#serialization-deserialization" class="router-link-active router-link-exact-active sidebar-item" aria-label="Serialization/Deserialization"><!--[--><!--]--> Serialization/Deserialization <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/serialization.html#usage" class="router-link-active router-link-exact-active sidebar-item" aria-label="Usage"><!--[--><!--]--> Usage <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guides/serialization.html#how-to-deserialize-account-data-on-the-client" class="router-link-active router-link-exact-active sidebar-item" aria-label="How to deserialize account data on the client"><!--[--><!--]--> How to deserialize account data on the client <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/serialization.html#common-solana-ts-js-mappings" class="router-link-active router-link-exact-active sidebar-item" aria-label="Common Solana TS/JS Mappings"><!--[--><!--]--> Common Solana TS/JS Mappings <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/guides/serialization.html#advanced-constructs" class="router-link-active router-link-exact-active sidebar-item" aria-label="Advanced Constructs"><!--[--><!--]--> Advanced Constructs <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/guides/serialization.html#coption" class="router-link-active router-link-exact-active sidebar-item" aria-label="COption"><!--[--><!--]--> COption <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/guides/serialization.html#resources" class="router-link-active router-link-exact-active sidebar-item" aria-label="Resources"><!--[--><!--]--> Resources <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/guides/data-migration.html" class="sidebar-item" aria-label="Migrating Program Data Accounts"><!--[--><!--]--> Migrating Program Data Accounts <!--[--><!--]--></a><!----></li><li><a href="/guides/account-maps.html" class="sidebar-item" aria-label="Account Maps"><!--[--><!--]--> Account Maps <!--[--><!--]--></a><!----></li><li><a href="/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="Debugging Solana Programs"><!--[--><!--]--> Debugging Solana Programs <!--[--><!--]--></a><!----></li><li><a href="/guides/feature-parity-testing.html" class="sidebar-item" aria-label="Feature Parity Testing"><!--[--><!--]--> Feature Parity Testing <!--[--><!--]--></a><!----></li><li><a href="/guides/versioned-transactions.html" class="sidebar-item" aria-label="Versioned Transactions"><!--[--><!--]--> Versioned Transactions <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">References <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/references/local-development.html" class="sidebar-item" aria-label="Local Development"><!--[--><!--]--> Local Development <!--[--><!--]--></a><!----></li><li><a href="/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="Keypairs and Wallets"><!--[--><!--]--> Keypairs and Wallets <!--[--><!--]--></a><!----></li><li><a href="/references/basic-transactions.html" class="sidebar-item" aria-label="Sending Transactions"><!--[--><!--]--> Sending Transactions <!--[--><!--]--></a><!----></li><li><a href="/references/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/references/programs.html" class="sidebar-item" aria-label="Writing Programs"><!--[--><!--]--> Writing Programs <!--[--><!--]--></a><!----></li><li><a href="/references/token.html" class="sidebar-item" aria-label="Interacting with Tokens"><!--[--><!--]--> Interacting with Tokens <!--[--><!--]--></a><!----></li><li><a href="/references/staking.html" class="sidebar-item" aria-label="Staking"><!--[--><!--]--> Staking <!--[--><!--]--></a><!----></li><li><a href="/references/nfts.html" class="sidebar-item" aria-label="NFTs"><!--[--><!--]--> NFTs <!--[--><!--]--></a><!----></li><li><a href="/references/offline-transactions.html" class="sidebar-item" aria-label="Sending Offline Transactions"><!--[--><!--]--> Sending Offline Transactions <!--[--><!--]--></a><!----></li><li><a href="/references/name-service.html" class="sidebar-item" aria-label="Name Service"><!--[--><!--]--> Name Service <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item collapsible">Gaming <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/gaming/intro.html" class="sidebar-item" aria-label="Introduction to Gaming on Solana"><!--[--><!--]--> Introduction to Gaming on Solana <!--[--><!--]--></a><!----></li><li><a href="/gaming/game-sdks.html" class="sidebar-item" aria-label="Solana Gaming SDKs"><!--[--><!--]--> Solana Gaming SDKs <!--[--><!--]--></a><!----></li><li><a href="/gaming/nfts-in-games.html" class="sidebar-item" aria-label="Gaming with NFTs"><!--[--><!--]--> Gaming with NFTs <!--[--><!--]--></a><!----></li><li><a href="/gaming/hello-world.html" class="sidebar-item" aria-label="Hello World example"><!--[--><!--]--> Hello World example <!--[--><!--]--></a><!----></li><li><a href="/gaming/store-sol-in-pda.html" class="sidebar-item" aria-label="Storing SOL in a PDA"><!--[--><!--]--> Storing SOL in a PDA <!--[--><!--]--></a><!----></li><li><a href="/gaming/saving-game-state.html" class="sidebar-item" aria-label="Saving game state"><!--[--><!--]--> Saving game state <!--[--><!--]--></a><!----></li><li><a href="/gaming/energy-system.html" class="sidebar-item" aria-label="Energy System"><!--[--><!--]--> Energy System <!--[--><!--]--></a><!----></li><li><a href="/gaming/interact-with-tokens.html" class="sidebar-item" aria-label="How interact with tokens in programs"><!--[--><!--]--> How interact with tokens in programs <!--[--><!--]--></a><!----></li><li><a href="/gaming/porting-anchor-to-unity.html" class="sidebar-item" aria-label="Port Anchor to Unity"><!--[--><!--]--> Port Anchor to Unity <!--[--><!--]--></a><!----></li><li><a href="/gaming/distribution.html" class="sidebar-item" aria-label="Distribution"><!--[--><!--]--> Distribution <!--[--><!--]--></a><!----></li><li><a href="/gaming/game-examples.html" class="sidebar-item" aria-label="Learn By Example"><!--[--><!--]--> Learn By Example <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="serializing-data" tabindex="-1"><a class="header-anchor" href="#serializing-data" aria-hidden="true">#</a> Serializing Data</h1><p>When we talk about serialization we mean both serializing data as well as deserialization of data.</p><p>Serialization comes into play at a few points along Solana program and program accounts lifecycle:</p><ol><li>Serializing instruction data on to client</li><li>Deserializing instruction data on the program</li><li>Serializing Account data on the program</li><li>Deserializing Account Data on the client</li></ol><p>It is important that the above actions are all supported by the same serialization approach. The included snippets are demonstrating serialization using <a href="#resources">Borsh</a>.</p><p>The samples in the remainder of this document are excerpts as taken from the <a href="#resources">Solana CLI Program Template</a></p><h2 id="setting-up-for-borsh-serialization" tabindex="-1"><a class="header-anchor" href="#setting-up-for-borsh-serialization" aria-hidden="true">#</a> Setting up for Borsh Serialization</h2><p>Libraries for Borsh must be setup for the Rust program, Rust client, Node and/or Python client.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Program</button></li><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust Client</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Node Client</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Python Client</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-toml ext-toml line-numbers-mode"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;solana-cli-template-program-bpf&quot;</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.1.0&quot;</span>
<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">&quot;2018&quot;</span>
<span class="token key property">license</span> <span class="token punctuation">=</span> <span class="token string">&quot;WTFPL&quot;</span>

<span class="token comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="token punctuation">[</span><span class="token table class-name">features</span><span class="token punctuation">]</span>
<span class="token key property">no-entrypoint</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">borsh</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.9.0&quot;</span>
<span class="token key property">lazy_static</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.4.0&quot;</span>
<span class="token key property">num-derive</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.3&quot;</span>
<span class="token key property">num_enum</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.5.1&quot;</span>
<span class="token key property">num-integer</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.1.44&quot;</span>
<span class="token key property">num-traits</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.2&quot;</span>
<span class="token key property">sol-template-shared</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;../shared&quot;</span><span class="token punctuation">}</span>
<span class="token key property">solana-program</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">thiserror</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.0&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">dev-dependencies</span><span class="token punctuation">]</span>
<span class="token key property">solana-program-test</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">solana-sdk</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">lib</span><span class="token punctuation">]</span>
<span class="token key property">crate-type</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cdylib&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lib&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><!--]--></div><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-toml ext-toml line-numbers-mode"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>
<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;cli-program-template&quot;</span>
<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.1.5&quot;</span>
<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">&quot;2018&quot;</span>
<span class="token key property">license</span> <span class="token punctuation">=</span> <span class="token string">&quot;WTFPL&quot;</span>
<span class="token key property">publish</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">borsh</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.9.0&quot;</span>
<span class="token key property">clap</span> <span class="token punctuation">=</span> <span class="token string">&quot;2.33.3&quot;</span>
<span class="token key property">lazy_static</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.4.0&quot;</span>
<span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.0.125&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;derive&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token key property">serde_yaml</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.8.17&quot;</span>
<span class="token key property">sol-template-shared</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;shared&quot;</span><span class="token punctuation">}</span>
<span class="token key property">solana-clap-utils</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">solana-cli-config</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">solana-client</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">solana-logger</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">solana-remote-wallet</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">solana-sdk</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">tokio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;full&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token table class-name">workspace</span><span class="token punctuation">]</span>
<span class="token key property">members</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;program&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;shared&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token table class-name">dev-dependencies</span><span class="token punctuation">]</span>
<span class="token key property">lazy_static</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.4.0&quot;</span>
<span class="token key property">solana-validator</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
<span class="token key property">solana-streamer</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.8.2&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><!--]--></div><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ts-program-template&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Sample TS App&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;client/nmain.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;workspace&quot;</span><span class="token operator">:</span> <span class="token string">&quot;client/&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https: //github.com/hashblock/solana-cli-program-template&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;homepage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https: //github.com/hashblock/solana-cli-program-template&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test:all&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build:client &amp;&amp; npm run test:client&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:client&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf ./.dist/client &amp;&amp; tsc &quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./node_modules/.bin/mocha .dist/client/main.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test:client&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run start&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .ts client/* &amp;&amp; prettier --check \&quot;client/**/*.ts\&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint:fix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .ts client/* --fix&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pretty&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prettier --write &#39;{,client/**/}*.ts&#39;&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@tsconfig/recommended&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/chai&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.3.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/eslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.28.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/eslint-plugin-prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/mkdirp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/mocha&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^9.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@types/prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.4.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@typescript-eslint/eslint-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.6.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@typescript-eslint/parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.6.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;chai&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.3.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint-config-google&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.14.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint-config-prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.3.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint-plugin-prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;html-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.5.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mocha&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^9.1.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.4.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start-server-and-test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.14.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ts-node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.4.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.5.2&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@solana/web3.js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.31.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;borsh&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.7.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.1-security&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mkdirp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;npm-check-updates&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^12.0.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sync-request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;update&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.4.2&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><!--]--></div><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-txt ext-txt line-numbers-mode"><pre class="language-txt"><code>borsh-construct==0.1.0
solana==0.20.0
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><!--]--></div><!--]--></div><h2 id="how-to-serialize-instruction-data-on-the-client" tabindex="-1"><a class="header-anchor" href="#how-to-serialize-instruction-data-on-the-client" aria-hidden="true">#</a> How to serialize instruction data on the client</h2><img src="/assets/ser1.ceec0bad.png" alt="Serialize Instruction Data"><p>If you are serializing outbound instruction data to send to a program it must mirror how the program deserializes the inbound instruction data.</p><p>In this template, an instruction data block is a serialized array containing, with examples:</p><table><thead><tr><th>Instruction (Variant index)</th><th>Serialized Key</th><th>Serialized Value</th></tr></thead><tbody><tr><td>Initialize (0)</td><td>not applicable for instruction</td><td>not applicable for instruction</td></tr><tr><td>Mint (1)</td><td>&quot;foo&quot;</td><td>&quot;bar&quot;</td></tr><tr><td>Transfer (2)</td><td>&quot;foo&quot;</td><td>not applicable for instruction</td></tr><tr><td>Burn (2)</td><td>&quot;foo&quot;</td><td>not applicable for instruction</td></tr></tbody></table><p>In the following example we assume the program owned account has been initialized</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS Client</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Python Client</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Rust Client</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Include borsh functionality</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> serialize<span class="token punctuation">,</span> deserialize<span class="token punctuation">,</span> deserializeUnchecked <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;borsh&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;buffer&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Get Solana</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Keypair<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
  Transaction<span class="token punctuation">,</span>
  TransactionInstruction<span class="token punctuation">,</span>
  sendAndConfirmTransaction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Flexible class that takes properties and imbues them</span>
<span class="token comment">// to the object instance</span>
<span class="token keyword">class</span> <span class="token class-name">Assignable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> properties<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Our instruction payload vocabulary</span>
<span class="token keyword">class</span> <span class="token class-name">Payload</span> <span class="token keyword">extends</span> <span class="token class-name">Assignable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// Borsh needs a schema describing the payload</span>
<span class="token keyword">const</span> payloadSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span>
    Payload<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> <span class="token string">&quot;struct&quot;</span><span class="token punctuation">,</span>
      fields<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u8&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Instruction variant indexes</span>
<span class="token keyword">enum</span> InstructionVariant <span class="token punctuation">{</span>
  InitializeAccount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  MintKeypair<span class="token punctuation">,</span>
  TransferKeypair<span class="token punctuation">,</span>
  BurnKeypair<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Mint a key value pair to account
 * <span class="token keyword">@param</span> <span class="token punctuation">{</span>Connection<span class="token punctuation">}</span> connection - Solana RPC connection
 * <span class="token keyword">@param</span> <span class="token punctuation">{</span>PublicKey<span class="token punctuation">}</span> progId - Sample Program public key
 * <span class="token keyword">@param</span> <span class="token punctuation">{</span>PublicKey<span class="token punctuation">}</span> account - Target program owned account for Mint
 * <span class="token keyword">@param</span> <span class="token punctuation">{</span>Keypair<span class="token punctuation">}</span> wallet - Wallet for signing and payment
 * <span class="token keyword">@param</span> <span class="token punctuation">{</span>string<span class="token punctuation">}</span> mintKey - The key being minted key
 * <span class="token keyword">@param</span> <span class="token punctuation">{</span>string<span class="token punctuation">}</span> mintValue - The value being minted
 * <span class="token keyword">@return</span> <span class="token punctuation">{</span>Promise&lt;Keypair&gt;<span class="token punctuation">}</span> - Keypair
 */</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mintKV</span><span class="token punctuation">(</span>
  connection<span class="token operator">:</span> Connection<span class="token punctuation">,</span>
  progId<span class="token operator">:</span> PublicKey<span class="token punctuation">,</span>
  account<span class="token operator">:</span> PublicKey<span class="token punctuation">,</span>
  wallet<span class="token operator">:</span> Keypair<span class="token punctuation">,</span>
  mintKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  mintValue<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Construct the payload</span>
  <span class="token keyword">const</span> mint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payload</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> InstructionVariant<span class="token punctuation">.</span>MintKeypair<span class="token punctuation">,</span>
    key<span class="token operator">:</span> mintKey<span class="token punctuation">,</span> <span class="token comment">// &#39;ts key&#39;</span>
    value<span class="token operator">:</span> mintValue<span class="token punctuation">,</span> <span class="token comment">// &#39;ts first value&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Serialize the payload</span>
  <span class="token keyword">const</span> mintSerBuf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span>payloadSchema<span class="token punctuation">,</span> mint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// console.log(mintSerBuf)</span>
  <span class="token comment">// =&gt; &lt;Buffer 01 06 00 00 00 74 73 20 6b 65 79 0e 00 00 00 74 73 20 66 69 72 73 74 20 76 61 6c 75 65&gt;</span>
  <span class="token comment">// let mintPayloadCopy = deserialize(schema, Payload, mintSerBuf)</span>
  <span class="token comment">// console.log(mintPayloadCopy)</span>
  <span class="token comment">// =&gt; Payload { id: 1, key: &#39;ts key&#39;, value: &#39;ts first value&#39; }</span>

  <span class="token comment">// Create Solana Instruction</span>
  <span class="token keyword">const</span> instruction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionInstruction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token operator">:</span> mintSerBuf<span class="token punctuation">,</span>
    keys<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> pubkey<span class="token operator">:</span> account<span class="token punctuation">,</span> isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isWritable<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> pubkey<span class="token operator">:</span> wallet<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isWritable<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    programId<span class="token operator">:</span> progId<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Send Solana Transaction</span>
  <span class="token keyword">const</span> transactionSignature <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAndConfirmTransaction</span><span class="token punctuation">(</span>
    connection<span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>instruction<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>wallet<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      commitment<span class="token operator">:</span> <span class="token string">&quot;singleGossip&quot;</span><span class="token punctuation">,</span>
      preflightCommitment<span class="token operator">:</span> <span class="token string">&quot;singleGossip&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Signature = &quot;</span><span class="token punctuation">,</span> transactionSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> transactionSignature<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br></div></div><!--]--></div><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> borsh_construct <span class="token keyword">import</span> String<span class="token punctuation">,</span> CStruct<span class="token punctuation">,</span> U8
<span class="token keyword">from</span> enum <span class="token keyword">import</span> IntEnum
<span class="token keyword">from</span> solana<span class="token punctuation">.</span>transaction <span class="token keyword">import</span> Transaction
<span class="token keyword">from</span> solders<span class="token punctuation">.</span>pubkey <span class="token keyword">import</span> Pubkey
<span class="token keyword">from</span> solders<span class="token punctuation">.</span>keypair <span class="token keyword">import</span> Keypair
<span class="token keyword">from</span> solders<span class="token punctuation">.</span>instruction <span class="token keyword">import</span> Instruction<span class="token punctuation">,</span> AccountMeta
<span class="token keyword">from</span> solders<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>responses <span class="token keyword">import</span> SendTransactionResp
<span class="token keyword">from</span> solana<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>api <span class="token keyword">import</span> Client


<span class="token comment"># Instruction variants for target program</span>
<span class="token keyword">class</span> <span class="token class-name">InstructionVariant</span><span class="token punctuation">(</span>IntEnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    INITIALIZE <span class="token operator">=</span> <span class="token number">0</span>
    MINT <span class="token operator">=</span> <span class="token number">1</span>
    TRANSFER <span class="token operator">=</span> <span class="token number">2</span>
    BURN <span class="token operator">=</span> <span class="token number">3</span>


<span class="token comment"># Schema for sending instructionVariants to on-chain sample program</span>
payload_schema <span class="token operator">=</span> CStruct<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> <span class="token operator">/</span> U8<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span> <span class="token operator">/</span> String<span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span> <span class="token operator">/</span> String<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">construct_payload</span><span class="token punctuation">(</span>instruction_variant<span class="token punctuation">:</span> InstructionVariant<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Generate a serialized instructionVariant&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> payload_schema<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> instruction_variant<span class="token punctuation">,</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">:</span> key<span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">mint_kv</span><span class="token punctuation">(</span>
    client<span class="token punctuation">:</span> Client<span class="token punctuation">,</span>
    program_pk<span class="token punctuation">:</span> Pubkey<span class="token punctuation">,</span>
    account_pk<span class="token punctuation">:</span> Pubkey<span class="token punctuation">,</span>
    wallet_kp<span class="token punctuation">:</span> Keypair<span class="token punctuation">,</span>
    mint_key<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
    mint_value<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> SendTransactionResp<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Mint with a key/value pair to an account&quot;&quot;&quot;</span>
    <span class="token comment"># Construct the program payload for Mint invariant</span>
    payload_ser <span class="token operator">=</span> construct_payload<span class="token punctuation">(</span>InstructionVariant<span class="token punctuation">.</span>MINT<span class="token punctuation">,</span> mint_key<span class="token punctuation">,</span> mint_value<span class="token punctuation">)</span>

    <span class="token comment"># print(payload_ser)</span>
    <span class="token comment"># =&gt; b&#39;\x01\n\x00\x00\x00python key\x0c\x00\x00\x00python value&#39;</span>
    <span class="token comment"># mint_payload_copy = payload_schema.parse(payload_ser)</span>
    <span class="token comment"># print(mint_payload_copy)</span>
    <span class="token comment"># =&gt; Container:</span>
    <span class="token comment"># =&gt;     initialized = 1</span>
    <span class="token comment"># =&gt;     key = u&#39;python key&#39; (total 10)</span>
    <span class="token comment"># =&gt;     value = u&#39;python value&#39; (total 12)</span>

    <span class="token comment"># Construct the transaction with instructionVariant</span>
    txn <span class="token operator">=</span> Transaction<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span>
        Instruction<span class="token punctuation">(</span>
            accounts<span class="token operator">=</span><span class="token punctuation">[</span>AccountMeta<span class="token punctuation">(</span>account_pk<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> program_id<span class="token operator">=</span>program_pk<span class="token punctuation">,</span> data<span class="token operator">=</span>payload_ser
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> client<span class="token punctuation">.</span>send_transaction<span class="token punctuation">(</span>txn<span class="token punctuation">,</span> wallet_kp<span class="token punctuation">)</span>
    <span class="token comment"># =&gt; {&#39;jsonrpc&#39;: &#39;2.0&#39;, &#39;result&#39;: &#39;4ZdpWNdovdVaLextWSiqEBWp67k9rNTTUaX3qviHDXWY9c98bVtaRt5sasPhYzMVXHqhex78gzNKytcBnVH5CSTZ&#39;, &#39;id&#39;: 2}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>
<span class="token comment">/// Instruction payload gets serialized</span>
<span class="token attribute attr-name">#[derive(BorshSerialize)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Payload</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    variant<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token keyword">str</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token keyword">str</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Perform a mint transaction consisting of a key/value pair</span>
<span class="token comment">/// See submit_transaction below</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">mint_transaction</span><span class="token punctuation">(</span>
    rpc_client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">RpcClient</span><span class="token punctuation">,</span>
    accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountMeta</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    wallet_signer<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Signer</span><span class="token punctuation">,</span>
    mint_key<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span>
    mint_value<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span>
    mint_instruction_id<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    commitment_config<span class="token punctuation">:</span> <span class="token class-name">CommitmentConfig</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Signature</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Setup the payload. `mint_instruction_id` is instruction variant index = 1</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token class-name">Payload</span><span class="token operator">&lt;</span>`_<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        variant<span class="token punctuation">:</span> mint_instruction_id<span class="token punctuation">,</span>
        key<span class="token punctuation">:</span> mint_key<span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> mint_value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> instruction <span class="token operator">=</span> <span class="token class-name">Instruction</span><span class="token punctuation">::</span><span class="token function">new_with_borsh</span><span class="token punctuation">(</span><span class="token constant">PROG_KEY</span><span class="token punctuation">.</span><span class="token function">pubkey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>data<span class="token punctuation">,</span> accounts<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">submit_transaction</span><span class="token punctuation">(</span>rpc_client<span class="token punctuation">,</span> wallet_signer<span class="token punctuation">,</span> instruction<span class="token punctuation">,</span> commitment_config<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Submits the program instruction as per the</span>
<span class="token comment">/// instruction definition</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">submit_transaction</span><span class="token punctuation">(</span>
    rpc_client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">RpcClient</span><span class="token punctuation">,</span>
    wallet_signer<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Signer</span><span class="token punctuation">,</span>
    instruction<span class="token punctuation">:</span> <span class="token class-name">Instruction</span><span class="token punctuation">,</span>
    commitment_config<span class="token punctuation">:</span> <span class="token class-name">CommitmentConfig</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Signature</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> transaction <span class="token operator">=</span>
        <span class="token class-name">Transaction</span><span class="token punctuation">::</span><span class="token function">new_unsigned</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>instruction<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wallet_signer<span class="token punctuation">.</span><span class="token function">pubkey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>recent_blockhash<span class="token punctuation">,</span> _fee_calculator<span class="token punctuation">)</span> <span class="token operator">=</span> rpc_client
        <span class="token punctuation">.</span><span class="token function">get_recent_blockhash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: unable to get recent blockhash: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    transaction
        <span class="token punctuation">.</span><span class="token function">try_sign</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">vec!</span><span class="token punctuation">[</span>wallet_signer<span class="token punctuation">]</span><span class="token punctuation">,</span> recent_blockhash<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: failed to sign transaction: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> signature <span class="token operator">=</span> rpc_client
        <span class="token punctuation">.</span><span class="token function">send_and_confirm_transaction_with_spinner_and_commitment</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>transaction<span class="token punctuation">,</span> commitment_config<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;error: send transaction: {}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><!--]--></div><!--]--></div><h2 id="how-to-deserialize-instruction-data-on-the-program" tabindex="-1"><a class="header-anchor" href="#how-to-deserialize-instruction-data-on-the-program" aria-hidden="true">#</a> How to deserialize instruction data on the program</h2><img src="/assets/ser2.38d4ca5b.png" alt="Deserialize Instruction Data"><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust Program</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//! instruction Contains the main ProgramInstruction enum</span>

<span class="token keyword">use</span> <span class="token punctuation">{</span>
    <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">SampleError</span><span class="token punctuation">,</span> <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token namespace">solana_program<span class="token punctuation">::</span>program_error<span class="token punctuation">::</span></span><span class="token class-name">ProgramError</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span>
<span class="token comment">/// All custom program instructions</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">ProgramInstruction</span> <span class="token punctuation">{</span>
    <span class="token class-name">InitializeAccount</span><span class="token punctuation">,</span>
    <span class="token class-name">MintToAccount</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">TransferBetweenAccounts</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">BurnFromAccount</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">MintToAccountWithFee</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">TransferBetweenAccountsWithFee</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">BurnFromAccountWithFee</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Generic Payload Deserialization</span>
<span class="token attribute attr-name">#[derive(BorshDeserialize, Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Payload</span> <span class="token punctuation">{</span>
    variant<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    arg1<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    arg2<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ProgramInstruction</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Unpack inbound buffer to associated Instruction</span>
    <span class="token comment">/// The expected format for input is a Borsh serialized vector</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">unpack</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">ProgramError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> payload <span class="token operator">=</span> <span class="token class-name">Payload</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">match</span> payload<span class="token punctuation">.</span>variant <span class="token punctuation">{</span>
            <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">ProgramInstruction</span><span class="token punctuation">::</span><span class="token class-name">InitializeAccount</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">MintToAccount</span> <span class="token punctuation">{</span>
                key<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>arg1<span class="token punctuation">,</span>
                value<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>arg2<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">2</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">TransferBetweenAccounts</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>arg1 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">3</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">BurnFromAccount</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>arg1 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">4</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">MintToAccountWithFee</span> <span class="token punctuation">{</span>
                key<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>arg1<span class="token punctuation">,</span>
                value<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>arg2<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">5</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">TransferBetweenAccountsWithFee</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>arg1 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">6</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">BurnFromAccountWithFee</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>arg1 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            _ <span class="token operator">=&gt;</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">SampleError</span><span class="token punctuation">::</span><span class="token class-name">DeserializationFailure</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><!--]--></div><!--]--></div><h2 id="how-to-serialize-account-data-on-the-program" tabindex="-1"><a class="header-anchor" href="#how-to-serialize-account-data-on-the-program" aria-hidden="true">#</a> How to serialize account data on the program</h2><img src="/assets/ser3.7cdd43c8.png" alt="Account Data Serialization"><p>The program account data block (from the sample repo) is layed out as</p><table><thead><tr><th>Byte 0</th><th>Bytes 1-4</th><th>Remaining Byte up to 1019</th></tr></thead><tbody><tr><td>Initialized flag</td><td>length of serialized BTreeMap</td><td>BTreeMap (where key value pairs are stored)</td></tr></tbody></table><h3 id="pack" tabindex="-1"><a class="header-anchor" href="#pack" aria-hidden="true">#</a> Pack</h3><p>A word about the <a href="https://github.com/solana-labs/solana/blob/22a18a68e3ee68ae013d647e62e12128433d7230/sdk/program/src/program_pack.rs" target="_blank" rel="noopener noreferrer">Pack<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> trait</p><p>The Pack trait makes it easier to hide the details of account data serialization/deserialization from your core Program instruction processing. So instead of putting all the serialize/deserialize log in the program processing code, it encapsulates the details behind (3) functions:</p><ol><li><code>unpack_unchecked</code> - Allows you to deserialize an account without checking if it has been initialized. This is useful when you are actually processing the Initialization function (variant index 0)</li><li><code>unpack</code> - Calls your Pack implementation of <code>unpack_from_slice</code> and checks if account has been initialized.</li><li><code>pack</code> - Calls your Pack implementation of <code>pack_into_slice</code></li></ol><p>Here is the implementation of the Pack trait for our sample program. This is followed with the actual processing of the account data using borsh.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust Program</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//! @brief account_state manages account data</span>

<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">SampleError</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">sol_template_shared<span class="token punctuation">::</span></span><span class="token constant">ACCOUNT_STATE_SPACE</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">entrypoint<span class="token punctuation">::</span></span><span class="token class-name">ProgramResult</span><span class="token punctuation">,</span>
    <span class="token namespace">program_error<span class="token punctuation">::</span></span><span class="token class-name">ProgramError</span><span class="token punctuation">,</span>
    <span class="token namespace">program_pack<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">IsInitialized</span><span class="token punctuation">,</span> <span class="token class-name">Pack</span><span class="token punctuation">,</span> <span class="token class-name">Sealed</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">BTreeMap</span><span class="token punctuation">;</span>

<span class="token comment">/// Maintains global accumulator</span>
<span class="token attribute attr-name">#[derive(Debug, Default, PartialEq)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">ProgramAccountState</span> <span class="token punctuation">{</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    btree_storage<span class="token punctuation">:</span> <span class="token class-name">BTreeMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ProgramAccountState</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Returns indicator if this account has been initialized</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">set_initialized</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// Adds a new key/value pair to the account</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token keyword">self</span><span class="token punctuation">.</span>btree_storage<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token boolean">true</span> <span class="token operator">=&gt;</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">SampleError</span><span class="token punctuation">::</span><span class="token class-name">KeyAlreadyExists</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token boolean">false</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>btree_storage<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// Removes a key from account and returns the keys value</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SampleError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token keyword">self</span><span class="token punctuation">.</span>btree_storage<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token boolean">true</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>btree_storage<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token boolean">false</span> <span class="token operator">=&gt;</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">SampleError</span><span class="token punctuation">::</span><span class="token class-name">KeyNotFoundInAccount</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Sealed</span> <span class="token keyword">for</span> <span class="token class-name">ProgramAccountState</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// Pack expects the implementation to satisfy whether the</span>
<span class="token comment">// account is initialzed.</span>
<span class="token keyword">impl</span> <span class="token class-name">IsInitialized</span> <span class="token keyword">for</span> <span class="token class-name">ProgramAccountState</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">is_initialized</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>is_initialized
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Pack</span> <span class="token keyword">for</span> <span class="token class-name">ProgramAccountState</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">LEN</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">ACCOUNT_STATE_SPACE</span><span class="token punctuation">;</span>

    <span class="token comment">/// Store &#39;state&#39; of account to its data area</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">pack_into_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> dst<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token namespace">sol_template_shared<span class="token punctuation">::</span></span><span class="token function">pack_into_slice</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>is_initialized<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>btree_storage<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// Retrieve &#39;state&#39; of account from account data area</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">unpack_from_slice</span><span class="token punctuation">(</span>src<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">ProgramError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token namespace">sol_template_shared<span class="token punctuation">::</span></span><span class="token function">unpack_from_slice</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>is_initialized<span class="token punctuation">,</span> btree_map<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">ProgramAccountState</span> <span class="token punctuation">{</span>
                is_initialized<span class="token punctuation">,</span>
                btree_storage<span class="token punctuation">:</span> btree_map<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ProgramError</span><span class="token punctuation">::</span><span class="token class-name">InvalidAccountData</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><!--]--></div><!--]--></div><h3 id="serialization-deserialization" tabindex="-1"><a class="header-anchor" href="#serialization-deserialization" aria-hidden="true">#</a> Serialization/Deserialization</h3><p>To complete the underlying serialization and deserialization:</p><ol><li><code>sol_template_shared::pack_into_slice</code> - Where the actual serialization occurs</li><li><code>sol_template_shared::unpack_from_slice</code> - Where the actual deserialization occurs</li></ol><p><strong>Note</strong> that in the following we have a <code>u32</code> (4 bytes) partition in the data layout for <code>BTREE_LENGTH</code> preceding the <code>BTREE_STORAGE</code>. This is because borsh, during deserialization, checks that the length of the slice you are deserializing agrees with the amount of data it reads prior to actually recombobulation of the receiving object. The approach demonstrated below first reads the <code>BTREE_LENGTH</code> to get the size to <code>slice</code> out of the <code>BTREE_STORAGE</code> pointer.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust Program</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token punctuation">{</span>
    <span class="token namespace">arrayref<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">,</span>
    <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">solana_program<span class="token punctuation">::</span>program_memory<span class="token punctuation">::</span></span>sol_memcpy<span class="token punctuation">,</span>
    <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">collections<span class="token punctuation">::</span></span><span class="token class-name">BTreeMap</span><span class="token punctuation">,</span> <span class="token namespace">error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/// Initialization flag size for account state</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">INITIALIZED_BYTES</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">/// Storage for the serialized size of the BTreeMap control</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">BTREE_LENGTH</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">/// Storage for the serialized BTreeMap container</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">BTREE_STORAGE</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">1019</span><span class="token punctuation">;</span>
<span class="token comment">/// Sum of all account state lengths</span>
<span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">ACCOUNT_STATE_SPACE</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token constant">INITIALIZED_BYTES</span> <span class="token operator">+</span> <span class="token constant">BTREE_LENGTH</span> <span class="token operator">+</span> <span class="token constant">BTREE_STORAGE</span><span class="token punctuation">;</span>

<span class="token comment">/// Packs the initialized flag and data content into destination slice</span>
<span class="token attribute attr-name">#[allow(clippy::ptr_offset_with_cast)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">pack_into_slice</span><span class="token punctuation">(</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    btree_storage<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">BTreeMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    dst<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dst <span class="token operator">=</span> <span class="token macro property">array_mut_ref!</span><span class="token punctuation">[</span>dst<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">ACCOUNT_STATE_SPACE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Setup pointers to key areas of account state data</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>is_initialized_dst<span class="token punctuation">,</span> data_len_dst<span class="token punctuation">,</span> data_dst<span class="token punctuation">)</span> <span class="token operator">=</span>
        <span class="token macro property">mut_array_refs!</span><span class="token punctuation">[</span>dst<span class="token punctuation">,</span> <span class="token constant">INITIALIZED_BYTES</span><span class="token punctuation">,</span> <span class="token constant">BTREE_LENGTH</span><span class="token punctuation">,</span> <span class="token constant">BTREE_STORAGE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Set the initialized flag</span>
    is_initialized_dst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> is_initialized <span class="token keyword">as</span> <span class="token keyword">u8</span><span class="token punctuation">;</span>
    <span class="token comment">// Store the core data length and serialized content</span>
    <span class="token keyword">let</span> keyval_store_data <span class="token operator">=</span> btree_storage<span class="token punctuation">.</span><span class="token function">try_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data_len <span class="token operator">=</span> keyval_store_data<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> data_len <span class="token operator">&lt;</span> <span class="token constant">BTREE_STORAGE</span> <span class="token punctuation">{</span>
        data_len_dst<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">copy_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>data_len <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sol_memcpy</span><span class="token punctuation">(</span>data_dst<span class="token punctuation">,</span> <span class="token operator">&amp;</span>keyval_store_data<span class="token punctuation">,</span> data_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Unpacks the data from slice and return the initialized flag and data content</span>
<span class="token attribute attr-name">#[allow(clippy::ptr_offset_with_cast)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">unpack_from_slice</span><span class="token punctuation">(</span>src<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">,</span> <span class="token class-name">BTreeMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token macro property">array_ref!</span><span class="token punctuation">[</span>src<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">ACCOUNT_STATE_SPACE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Setup pointers to key areas of account state data</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>is_initialized_src<span class="token punctuation">,</span> data_len_src<span class="token punctuation">,</span> data_src<span class="token punctuation">)</span> <span class="token operator">=</span>
        <span class="token macro property">array_refs!</span><span class="token punctuation">[</span>src<span class="token punctuation">,</span> <span class="token constant">INITIALIZED_BYTES</span><span class="token punctuation">,</span> <span class="token constant">BTREE_LENGTH</span><span class="token punctuation">,</span> <span class="token constant">BTREE_STORAGE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> is_initialized <span class="token operator">=</span> <span class="token keyword">match</span> is_initialized_src <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token macro property">format!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;unrecognized initialization flag \&quot;{:?}\&quot;. in account&quot;</span><span class="token punctuation">,</span>
                is_initialized_src
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Get current size of content in data area</span>
    <span class="token keyword">let</span> data_len <span class="token operator">=</span> <span class="token keyword">u32</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token operator">*</span>data_len_src<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">;</span>
    <span class="token comment">// If emptry, create a default</span>
    <span class="token keyword">if</span> data_len <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>is_initialized<span class="token punctuation">,</span> <span class="token class-name">BTreeMap</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> data_dser <span class="token operator">=</span> <span class="token class-name">BTreeMap</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data_src<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span>data_len<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>is_initialized<span class="token punctuation">,</span> data_dser<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><!--]--></div><!--]--></div><h3 id="usage" tabindex="-1"><a class="header-anchor" href="#usage" aria-hidden="true">#</a> Usage</h3><p>The following pulls it all together and demonstrates how the program interacts with the <code>ProgramAccountState</code> which encapsulates the initialization flag as well as the underlying <code>BTreeMap</code> for our key/value pairs.</p><p>First when we want to initialize a brand new account:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">/// Initialize a new program account, which is the first in AccountInfo array</span>
<span class="token keyword">fn</span> <span class="token function-definition function">initialize_account</span><span class="token punctuation">(</span>accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Initialize account&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> account_info_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> program_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>account_info_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> account_data <span class="token operator">=</span> program_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Here we use unpack_unchecked as we have yet to initialize</span>
    <span class="token comment">// Had we tried to use unpack it would fail because, well, chicken and egg</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> account_state <span class="token operator">=</span> <span class="token class-name">ProgramAccountState</span><span class="token punctuation">::</span><span class="token function">unpack_unchecked</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>account_data<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// We double check that we haven&#39;t already initialized this accounts data</span>
    <span class="token comment">// more than once. If we are good, we set the initialized flag</span>
    <span class="token keyword">if</span> account_state<span class="token punctuation">.</span><span class="token function">is_initialized</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">SampleError</span><span class="token punctuation">::</span><span class="token class-name">AlreadyInitializedState</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        account_state<span class="token punctuation">.</span><span class="token function">set_initialized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Finally, we store back to the accounts space</span>
    <span class="token class-name">ProgramAccountState</span><span class="token punctuation">::</span><span class="token function">pack</span><span class="token punctuation">(</span>account_state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> account_data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><!--]--></div><!--]--></div><p>Now we can operate on our other instructions as the following demonstrates minting a new key value pair that we demonstrated above when sending instructions from a client:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">/// Mint a key/pair to the programs account, which is the first in accounts</span>
<span class="token keyword">fn</span> <span class="token function-definition function">mint_keypair_to_account</span><span class="token punctuation">(</span>accounts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">AccountInfo</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">ProgramResult</span> <span class="token punctuation">{</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Mint to account&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> account_info_iter <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> accounts<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> program_account <span class="token operator">=</span> <span class="token function">next_account_info</span><span class="token punctuation">(</span>account_info_iter<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> account_data <span class="token operator">=</span> program_account<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Unpacking an uninitialized account state will fail</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> account_state <span class="token operator">=</span> <span class="token class-name">ProgramAccountState</span><span class="token punctuation">::</span><span class="token function">unpack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>account_data<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Add the key value pair to the underlying BTreeMap</span>
    account_state<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token comment">// Finally, serialize back to the accounts data</span>
    <span class="token class-name">ProgramAccountState</span><span class="token punctuation">::</span><span class="token function">pack</span><span class="token punctuation">(</span>account_state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> account_data<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><!--]--></div><!--]--></div><h2 id="how-to-deserialize-account-data-on-the-client" tabindex="-1"><a class="header-anchor" href="#how-to-deserialize-account-data-on-the-client" aria-hidden="true">#</a> How to deserialize account data on the client</h2><p>Clients can call Solana to fetch program owned account, in which the serialized data block is a part of the return. Deserializing requires knowing the data block layout.</p><p>The layout of the account data was described <a href="#account-data-serialization">Here</a></p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Python</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Rust</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> serialize<span class="token punctuation">,</span> deserialize<span class="token punctuation">,</span> deserializeUnchecked <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;borsh&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;buffer&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Keypair<span class="token punctuation">,</span>
  AccountMeta<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
  SystemProgram<span class="token punctuation">,</span>
  Transaction<span class="token punctuation">,</span>
  TransactionInstruction<span class="token punctuation">,</span>
  sendAndConfirmTransaction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Flexible class that takes properties and imbues them</span>
<span class="token comment">// to the object instance</span>
<span class="token keyword">class</span> <span class="token class-name">Assignable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> properties<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AccoundData</span> <span class="token keyword">extends</span> <span class="token class-name">Assignable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> dataSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span>
    AccoundData<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> <span class="token string">&quot;struct&quot;</span><span class="token punctuation">,</span>
      fields<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">&quot;initialized&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u8&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;tree_length&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u32&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> kind<span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Fetch program account data
 * <span class="token keyword">@param</span> <span class="token punctuation">{</span>Connection<span class="token punctuation">}</span> connection - Solana RPC connection
 * <span class="token keyword">@param</span> <span class="token punctuation">{</span>PublicKey<span class="token punctuation">}</span> account - Public key for account whose data we want
 * <span class="token keyword">@return</span> <span class="token punctuation">{</span>Promise&lt;AccoundData&gt;<span class="token punctuation">}</span> - Keypair
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getAccountData</span><span class="token punctuation">(</span>
  connection<span class="token operator">:</span> Connection<span class="token punctuation">,</span>
  account<span class="token operator">:</span> PublicKey
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AccoundData<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> nameAccount <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getAccountInfo</span><span class="token punctuation">(</span>account<span class="token punctuation">,</span> <span class="token string">&quot;processed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">deserializeUnchecked</span><span class="token punctuation">(</span>dataSchema<span class="token punctuation">,</span> AccoundData<span class="token punctuation">,</span> nameAccount<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><!--]--></div><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> borsh_construct <span class="token keyword">import</span> CStruct<span class="token punctuation">,</span> U8<span class="token punctuation">,</span> U32<span class="token punctuation">,</span> HashMap<span class="token punctuation">,</span> String
<span class="token keyword">from</span> solana<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>commitment <span class="token keyword">import</span> Confirmed
<span class="token keyword">from</span> solders<span class="token punctuation">.</span>pubkey <span class="token keyword">import</span> Pubkey
<span class="token keyword">from</span> solana<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>api <span class="token keyword">import</span> Client


<span class="token comment"># Schema to deserialize program&#39;s account data</span>
account_schema <span class="token operator">=</span> CStruct<span class="token punctuation">(</span>
    <span class="token string">&quot;initialized&quot;</span> <span class="token operator">/</span> U8<span class="token punctuation">,</span>
    <span class="token string">&quot;map_length&quot;</span> <span class="token operator">/</span> U32<span class="token punctuation">,</span>
    <span class="token string">&quot;map&quot;</span> <span class="token operator">/</span> HashMap<span class="token punctuation">(</span>String<span class="token punctuation">,</span> String<span class="token punctuation">)</span>
<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_account_info</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> Client<span class="token punctuation">,</span> account_pk<span class="token punctuation">:</span> Pubkey<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Fetch account information from RPC, parse out the data and deserialize&quot;&quot;&quot;</span>
    res <span class="token operator">=</span> client<span class="token punctuation">.</span>get_account_info<span class="token punctuation">(</span>account_pk<span class="token punctuation">,</span> Confirmed<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;base64&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> account_schema<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>res<span class="token punctuation">.</span>value<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

<span class="token comment"># Results in or similar</span>
<span class="token comment"># =&gt; Container:</span>
<span class="token comment"># =&gt;     initialized = 1</span>
<span class="token comment"># =&gt;     map_length = 109</span>
<span class="token comment"># =&gt;     map = {&#39;Happy&#39;: &#39;New Year!&#39;, &#39;newKey&#39;: &#39;A new value&#39;,</span>
<span class="token comment"># =&gt;            &#39;python key&#39;: &#39;python value&#39;, &#39;ts key&#39;: &#39;ts first value&#39;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token punctuation">{</span>
    <span class="token namespace">arrayref<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">,</span>
    <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">collections<span class="token punctuation">::</span></span><span class="token class-name">BTreeMap</span><span class="token punctuation">,</span> <span class="token namespace">error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[allow(clippy::ptr_offset_with_cast)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">unpack_from_slice</span><span class="token punctuation">(</span>src<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">,</span> <span class="token class-name">BTreeMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> src <span class="token operator">=</span> <span class="token macro property">array_ref!</span><span class="token punctuation">[</span>src<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">ACCOUNT_STATE_SPACE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Setup pointers to key areas of account state data</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>is_initialized_src<span class="token punctuation">,</span> data_len_src<span class="token punctuation">,</span> data_src<span class="token punctuation">)</span> <span class="token operator">=</span>
        <span class="token macro property">array_refs!</span><span class="token punctuation">[</span>src<span class="token punctuation">,</span> <span class="token constant">INITIALIZED_BYTES</span><span class="token punctuation">,</span> <span class="token constant">BTREE_LENGTH</span><span class="token punctuation">,</span> <span class="token constant">BTREE_STORAGE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> is_initialized <span class="token operator">=</span> <span class="token keyword">match</span> is_initialized_src <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token macro property">format!</span><span class="token punctuation">(</span>
                <span class="token string">&quot;unrecognized initialization flag \&quot;{:?}\&quot;. in account&quot;</span><span class="token punctuation">,</span>
                is_initialized_src
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Get current size of content in data area</span>
    <span class="token keyword">let</span> data_len <span class="token operator">=</span> <span class="token keyword">u32</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token operator">*</span>data_len_src<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">usize</span><span class="token punctuation">;</span>
    <span class="token comment">// If emptry, create a default</span>
    <span class="token keyword">if</span> data_len <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>is_initialized<span class="token punctuation">,</span> <span class="token class-name">BTreeMap</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> data_dser <span class="token operator">=</span> <span class="token class-name">BTreeMap</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data_src<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span>data_len<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>is_initialized<span class="token punctuation">,</span> data_dser<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><!--]--></div><!--]--></div><h2 id="common-solana-ts-js-mappings" tabindex="-1"><a class="header-anchor" href="#common-solana-ts-js-mappings" aria-hidden="true">#</a> Common Solana TS/JS Mappings</h2><p>The <a href="#resources">Borsh Specification</a> contains most mappings for primitive and compound data types.</p><p>The key to TS/JS and Python is creating a Borsh Schema with a proper definition so the serialize and deserialize can generate or walk the respective inputs.</p><p>Here we demonstrate serialization of primitives (numbers, strings) and compound types (fixed size array, Map) first in Typescript, then in Python and then equivalent deserialization on the Rust side:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Python</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Rust</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> serialize<span class="token punctuation">,</span> deserialize<span class="token punctuation">,</span> deserializeUnchecked <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;borsh&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;buffer&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;chai&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PublicKey<span class="token punctuation">,</span> Struct <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Primitive extends the Struct type from Solana Library
 * for convenience of dynamic property setting
 * <span class="token keyword">@extends</span> <span class="token punctuation">{</span>Struct<span class="token punctuation">}</span> Solana JS Struct class
 */</span>

<span class="token keyword">class</span> <span class="token class-name">Primitive</span> <span class="token keyword">extends</span> <span class="token class-name">Struct</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Entry point for script *
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">entry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Emulate BTreeMap</span>
  <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;cookbook&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;recipe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;recipe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ingredient&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Setup a Primitive for all basic and a few</span>
  <span class="token comment">// compound types</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Primitive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token constant">U8</span><span class="token operator">:</span> <span class="token number">255</span><span class="token punctuation">,</span>
    <span class="token constant">U16</span><span class="token operator">:</span> <span class="token number">65535</span><span class="token punctuation">,</span>
    <span class="token constant">U32</span><span class="token operator">:</span> <span class="token number">4294967295</span><span class="token punctuation">,</span>
    <span class="token constant">FIXED_STRING_ARRAY</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token constant">FIXED_U8_ARRAY</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token constant">MAP_STRING_STRING</span><span class="token operator">:</span> map<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Define our schema</span>
  <span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      Primitive<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        kind<span class="token operator">:</span> <span class="token string">&quot;struct&quot;</span><span class="token punctuation">,</span>
        fields<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span><span class="token string">&quot;U8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u8&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token string">&quot;U16&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u16&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token string">&quot;U32&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u32&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token string">&quot;FIXED_STRING_ARRAY&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token string">&quot;FIXED_U8_ARRAY&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;u8&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span>
            <span class="token string">&quot;MAP_STRING_STRING&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> kind<span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Value = &quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Serialize then deserialize</span>
  <span class="token keyword">const</span> dser <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> newValue <span class="token operator">=</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> Primitive<span class="token punctuation">,</span> dser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Viola!</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;New value = &quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Fixed string array = &quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">[</span><span class="token string">&quot;FIXED_STRING_ARRAY&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Fixed u8 array = &quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">[</span><span class="token string">&quot;FIXED_U8_ARRAY&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Map = &quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">[</span><span class="token string">&quot;MAP_STRING_STRING&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">entry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><!--]--></div><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> borsh_construct <span class="token keyword">import</span> U8<span class="token punctuation">,</span> U16<span class="token punctuation">,</span> U32<span class="token punctuation">,</span> String<span class="token punctuation">,</span> HashMap

<span class="token comment"># Schema to deserialize various types</span>
primitive_schema <span class="token operator">=</span> CStruct<span class="token punctuation">(</span>
        <span class="token string">&quot;U8&quot;</span> <span class="token operator">/</span> U8<span class="token punctuation">,</span>
        <span class="token string">&quot;U16&quot;</span> <span class="token operator">/</span> U16<span class="token punctuation">,</span>
        <span class="token string">&quot;U32&quot;</span> <span class="token operator">/</span> U32<span class="token punctuation">,</span>
        <span class="token string">&quot;FIXED_STRING_ARRAY&quot;</span> <span class="token operator">/</span> String<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;FIXED_U8_ARRAY&quot;</span> <span class="token operator">/</span> U8<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;MAP_STRING_STRING&quot;</span> <span class="token operator">/</span> HashMap<span class="token punctuation">(</span>String<span class="token punctuation">,</span> String<span class="token punctuation">)</span>
<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">common</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mapping <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;cookbook&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;recipe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;recipe&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ingredient&quot;</span><span class="token punctuation">}</span>

    <span class="token comment"># Serialize</span>
    dser <span class="token operator">=</span> primitive_schema<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">&#39;U8&#39;</span><span class="token punctuation">:</span> <span class="token number">255</span><span class="token punctuation">,</span>
        <span class="token string">&#39;U16&#39;</span><span class="token punctuation">:</span> <span class="token number">65535</span><span class="token punctuation">,</span>
        <span class="token string">&#39;U32&#39;</span><span class="token punctuation">:</span> <span class="token number">4294967295</span><span class="token punctuation">,</span>
        <span class="token string">&quot;FIXED_STRING_ARRAY&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;world&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;FIXED_U8_ARRAY&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;MAP_STRING_STRING&quot;</span><span class="token punctuation">:</span> mapping<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>dser<span class="token punctuation">)</span>
    <span class="token comment"># =&gt; b&#39;\xff\xff\xff\xff\xff\xff\xff\x05\x00\x00\x00hello\x05\x00\x00\x00world\x01\x02\x03\x04\x05\x02\x00\x00\x00\x08\x00\x00\x00cookbook\x06\x00\x00\x00recipe\x06\x00\x00\x00recipe\n\x00\x00\x00ingredient&#39;</span>
    <span class="token comment"># Deserialize</span>
    new_value <span class="token operator">=</span> primitive_schema<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>dser<span class="token punctuation">)</span>
    <span class="token comment"># Viola</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>new_value<span class="token punctuation">)</span>
    <span class="token comment"># =&gt; Container:</span>
    <span class="token comment"># =&gt;    U8 = 255</span>
    <span class="token comment"># =&gt;    U16 = 65535</span>
    <span class="token comment"># =&gt;    U32 = 4294967295</span>
    <span class="token comment"># =&gt;    FIXED_STRING_ARRAY = ListContainer:</span>
    <span class="token comment"># =&gt;        hello</span>
    <span class="token comment"># =&gt;        world</span>
    <span class="token comment"># =&gt;    FIXED_U8_ARRAY = ListContainer:</span>
    <span class="token comment"># =&gt;        1</span>
    <span class="token comment"># =&gt;        2</span>
    <span class="token comment"># =&gt;        3</span>
    <span class="token comment"># =&gt;        4</span>
    <span class="token comment"># =&gt;        5</span>
    <span class="token comment"># =&gt;    MAP_STRING_STRING = {&#39;cookbook&#39;: &#39;recipe&#39;, &#39;recipe&#39;: &#39;ingredient&#39;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">tests</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">BTreeMap</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">primitives</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> prim <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token number">255u8</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span>
            <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span>
            <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token attribute attr-name">#[derive(BorshDeserialize, BorshSerialize, Debug)]</span>
        <span class="token keyword">struct</span> <span class="token type-definition class-name">Primitive</span><span class="token punctuation">(</span>
            <span class="token keyword">u8</span><span class="token punctuation">,</span>
            <span class="token keyword">u16</span><span class="token punctuation">,</span>
            <span class="token keyword">u32</span><span class="token punctuation">,</span>
            <span class="token class-name">String</span><span class="token punctuation">,</span>
            <span class="token class-name">String</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token class-name">BTreeMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token class-name">Primitive</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>prim<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><!--]--></div><!--]--></div><h2 id="advanced-constructs" tabindex="-1"><a class="header-anchor" href="#advanced-constructs" aria-hidden="true">#</a> Advanced Constructs</h2><p>We&#39;ve shown how to create simple Payloads in previous examples. Sometimes Solana throws a fastball with certain types. This section will demonstrate proper mapping between TS/JS and Rust to handle those</p><h3 id="coption" tabindex="-1"><a class="header-anchor" href="#coption" aria-hidden="true">#</a> COption</h3><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Rust</button></li></ul></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true"><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> serialize<span class="token punctuation">,</span> deserialize<span class="token punctuation">,</span> deserializeUnchecked <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;borsh&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Buffer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;buffer&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PublicKey<span class="token punctuation">,</span> Struct <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * COption is meant to mirror the
 * `solana_program::options::COption`
 *
 * This type stores a u32 flag (0 | 1) indicating
 * the presence or not of a underlying PublicKey
 *
 * Similar to a Rust Option
 * <span class="token keyword">@extends</span> <span class="token punctuation">{</span>Struct<span class="token punctuation">}</span> Solana JS Struct class
 * <span class="token keyword">@implements</span> <span class="token punctuation">{</span>encode<span class="token punctuation">}</span>
 */</span>
<span class="token keyword">class</span> <span class="token class-name">COption</span> <span class="token keyword">extends</span> <span class="token class-name">Struct</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
   * Creates a COption from a PublicKey
   * <span class="token keyword">@param</span> <span class="token punctuation">{</span>PublicKey?<span class="token punctuation">}</span> akey
   * <span class="token keyword">@returns</span> <span class="token punctuation">{</span>COption<span class="token punctuation">}</span> COption
   */</span>
  <span class="token keyword">static</span> <span class="token function">fromPublicKey</span><span class="token punctuation">(</span>akey<span class="token operator">?</span><span class="token operator">:</span> PublicKey<span class="token punctuation">)</span><span class="token operator">:</span> COption <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>akey <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">COption</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        noneOrSome<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        pubKeyBuffer<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">COption</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        noneOrSome<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        pubKeyBuffer<span class="token operator">:</span> akey<span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token doc-comment comment">/**
   * <span class="token keyword">@returns</span> <span class="token punctuation">{</span>Buffer<span class="token punctuation">}</span> Serialized COption (this)
   */</span>
  <span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Buffer <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token constant">COPTIONSCHEMA</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token doc-comment comment">/**
   * Safe deserializes a borsh serialized buffer to a COption
   * <span class="token keyword">@param</span> <span class="token punctuation">{</span>Buffer<span class="token punctuation">}</span> data - Buffer containing borsh serialized data
   * <span class="token keyword">@returns</span> <span class="token punctuation">{</span>COption<span class="token punctuation">}</span> COption object
   */</span>
  <span class="token keyword">static</span> <span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">:</span> COption <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token constant">COPTIONSCHEMA</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
   * Unsafe deserializes a borsh serialized buffer to a COption
   * <span class="token keyword">@param</span> <span class="token punctuation">{</span>Buffer<span class="token punctuation">}</span> data - Buffer containing borsh serialized data
   * <span class="token keyword">@returns</span> <span class="token punctuation">{</span>COption<span class="token punctuation">}</span> COption object
   */</span>
  <span class="token keyword">static</span> <span class="token function">decodeUnchecked</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">:</span> COption <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">deserializeUnchecked</span><span class="token punctuation">(</span><span class="token constant">COPTIONSCHEMA</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Defines the layout of the COption object
 * for serializing/deserializing
 * <span class="token keyword">@type</span> <span class="token punctuation">{</span>Map<span class="token punctuation">}</span>
 */</span>
<span class="token keyword">const</span> <span class="token constant">COPTIONSCHEMA</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span>
    COption<span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> <span class="token string">&quot;struct&quot;</span><span class="token punctuation">,</span>
      fields<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">&quot;noneOrSome&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u32&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">&quot;pubKeyBuffer&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Entry point for script *
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">entry</span><span class="token punctuation">(</span>indata<span class="token operator">?</span><span class="token operator">:</span> PublicKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// If we get a PublicKey</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>indata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Construct COption instance</span>
    <span class="token keyword">const</span> coption <span class="token operator">=</span> COption<span class="token punctuation">.</span><span class="token function">fromPublicKey</span><span class="token punctuation">(</span>indata<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Testing COption with &quot;</span> <span class="token operator">+</span> indata<span class="token punctuation">.</span><span class="token function">toBase58</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Serialize it</span>
    <span class="token keyword">let</span> copt_ser <span class="token operator">=</span> coption<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;copt_ser &quot;</span><span class="token punctuation">,</span> copt_ser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Deserialize it</span>
    <span class="token keyword">const</span> tdone <span class="token operator">=</span> COption<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>copt_ser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tdone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Validate contains PublicKey</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tdone<span class="token punctuation">[</span><span class="token string">&quot;noneOrSome&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pubkey: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span>tdone<span class="token punctuation">[</span><span class="token string">&quot;pubKeyBuffer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBase58</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*
            Output:
            Testing COption with A94wMjV54C8f8wn7zL8TxNCdNiGoq7XSN7vWGrtd4vwU
            copt_ser  Buffer(36) [1, 0, 0, 0, 135, 202, 71, 214, 68, 105, 98, 176, 211, 130, 105, 2, 55, 187, 86, 186, 109, 176, 80, 208, 77, 100, 221, 101, 20, 203, 149, 166, 96, 171, 119, 35, buffer: ArrayBuffer(8192), byteLength: 36, byteOffset: 1064, length: 36]
            COption {noneOrSome: 1, pubKeyBuffer: Uint8Array(32)}
            pubkey: A94wMjV54C8f8wn7zL8TxNCdNiGoq7XSN7vWGrtd4vwU
        */</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Testing COption with null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Construct COption instance</span>
    <span class="token keyword">const</span> coption <span class="token operator">=</span> COption<span class="token punctuation">.</span><span class="token function">fromPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Serialize it</span>
    <span class="token keyword">const</span> copt_ser <span class="token operator">=</span> coption<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>copt_ser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Deserialize it</span>
    <span class="token keyword">const</span> tdone1 <span class="token operator">=</span> COption<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>copt_ser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tdone1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Validate does NOT contains PublicKey</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tdone1<span class="token punctuation">[</span><span class="token string">&quot;noneOrSome&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Expected no public key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pubkey: null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
            Output:
            Testing COption with null
            Buffer(36)[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, buffer: ArrayBuffer(8192), byteLength: 36, byteOffset: 2272, length: 36]
            COption { noneOrSome: 0, pubKeyBuffer: Uint8Array(32) }
            pubkey: null
        */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Test with PublicKey</span>
<span class="token function">entry</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span><span class="token string">&quot;A94wMjV54C8f8wn7zL8TxNCdNiGoq7XSN7vWGrtd4vwU&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Test without PublicKey</span>
<span class="token function">entry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">tests</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token namespace">arrayref<span class="token punctuation">::</span></span><span class="token punctuation">{</span>array_ref<span class="token punctuation">,</span> array_refs<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">use</span> <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">program_option<span class="token punctuation">::</span></span><span class="token class-name">COption</span><span class="token punctuation">,</span> <span class="token namespace">pubkey<span class="token punctuation">::</span></span><span class="token class-name">Pubkey</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">/// Emulate how COption is &#39;unpacked&#39;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">deser_option</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">COption</span><span class="token operator">&lt;</span><span class="token class-name">Pubkey</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Map the data block</span>
        <span class="token keyword">let</span> ain <span class="token operator">=</span> <span class="token macro property">array_ref!</span><span class="token punctuation">[</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token punctuation">(</span>base<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token macro property">array_refs!</span><span class="token punctuation">[</span>ain<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// Get the SOME or NONE u32</span>
        <span class="token keyword">let</span> nos <span class="token operator">=</span> <span class="token keyword">u32</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token operator">*</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Construct the COption accordingly</span>
        <span class="token keyword">let</span> opt<span class="token punctuation">:</span> <span class="token class-name">COption</span><span class="token operator">&lt;</span><span class="token class-name">Pubkey</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">if</span> nos <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            <span class="token class-name">COption</span><span class="token punctuation">::</span><span class="token class-name">None</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">COption</span><span class="token punctuation">::</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Pubkey</span><span class="token punctuation">::</span><span class="token function">new_from_array</span><span class="token punctuation">(</span><span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        opt
    <span class="token punctuation">}</span>
    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">btest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// From Typescript with borsh&#39;ing</span>
        <span class="token keyword">let</span> copt <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token number">1u8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">214</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">187</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span>
            <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">221</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">203</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// Emulate COption deserialization</span>
        <span class="token keyword">let</span> coption <span class="token operator">=</span> <span class="token function">deser_option</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>copt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> coption<span class="token punctuation">.</span><span class="token function">is_some</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> coption<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Uh-oh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// As a Borsh Struct</span>
        <span class="token attribute attr-name">#[derive(BorshDeserialize, BorshSerialize, Debug)]</span>
        <span class="token keyword">struct</span> <span class="token type-definition class-name">TOption</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> toption <span class="token operator">=</span> <span class="token class-name">TOption</span><span class="token punctuation">::</span><span class="token function">try_from_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>copt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> pkey <span class="token operator">=</span> <span class="token class-name">Pubkey</span><span class="token punctuation">::</span><span class="token function">new_from_array</span><span class="token punctuation">(</span>toption<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Some = {:?} Pubkey = {:?}&quot;</span><span class="token punctuation">,</span> toption<span class="token number">.0</span><span class="token punctuation">,</span> pkey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><!--]--></div><!--]--></div><h2 id="resources" tabindex="-1"><a class="header-anchor" href="#resources" aria-hidden="true">#</a> Resources</h2><ul><li><a href="https://borsh.io/" target="_blank" rel="noopener noreferrer">Borsh Specification<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/near/borsh-rs" target="_blank" rel="noopener noreferrer">Rust Borsh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/near/borsh-js" target="_blank" rel="noopener noreferrer">TS/JS Borsh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/near/borsh-construct-py" target="_blank" rel="noopener noreferrer">Python Borsh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://near.github.io/borsh-construct-py/" target="_blank" rel="noopener noreferrer">Python Borsh Documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/hashblock/solana-cli-program-template" target="_blank" rel="noopener noreferrer">Solana CLI Program Template2<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 5435165+FrankC01@users.noreply.github.com">Frank V. Castellucci</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: jacob.creech@solana.com">Jacob Creech</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 82475023+jacobcreech@users.noreply.github.com">Jacob Creech</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 24635973+kevinheavey@users.noreply.github.com">Kevin Heavey</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 79712764+abacus-x@users.noreply.github.com">abacus-x</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: aziz@okadoc.com">akangaziz</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/guides/get-program-accounts.html" class="" aria-label="Get Program Accounts"><!--[--><!--]--> Get Program Accounts <!--[--><!--]--></a></span><span class="next"><a href="/guides/data-migration.html" class="" aria-label="Migrating Program Data Accounts"><!--[--><!--]--> Migrating Program Data Accounts <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.07ce7a66.js" defer></script>
  </body>
</html>
