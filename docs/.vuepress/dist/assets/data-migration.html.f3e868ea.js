import{_ as t,r as p,o,c as r,a as n,b as s,F as c,e as l,d as e}from"./app.07ce7a66.js";var i="/assets/pav1.1b0417ca.png",u="/assets/pav2.1ef612b4.png";const k={},m=l('<h1 id="migrating-a-programs-data-accounts-programlar\u0131n-data-account-lar\u0131n\u0131-tas\u0131ma" tabindex="-1"><a class="header-anchor" href="#migrating-a-programs-data-accounts-programlar\u0131n-data-account-lar\u0131n\u0131-tas\u0131ma" aria-hidden="true">#</a> Migrating a Programs Data Accounts (Programlar\u0131n Data Account\u2019lar\u0131n\u0131 Ta\u015F\u0131ma)</h1><h2 id="how-can-you-migrate-a-program-s-data-accounts-programlar\u0131n-veri-account-lar\u0131-nas\u0131l-tas\u0131n\u0131r" tabindex="-1"><a class="header-anchor" href="#how-can-you-migrate-a-program-s-data-accounts-programlar\u0131n-veri-account-lar\u0131-nas\u0131l-tas\u0131n\u0131r" aria-hidden="true">#</a> How can you migrate a program&#39;s data accounts? (Programlar\u0131n veri account\u2019lar\u0131 nas\u0131l ta\u015F\u0131n\u0131r)</h2><p>Bir program olu\u015Fturdu\u011Funuzda, o programla ili\u015Fkili her bir veri account&#39;\u0131n\u0131n belirli bir veri yap\u0131s\u0131 olacakt\u0131r. Programdan t\xFCretilen bir account&#39;\u0131 y\xFCkseltmeniz gerekirse, eski yap\u0131ya sahip bir s\xFCr\xFC programdan t\xFCretilmi\u015F account kal\u0131r.</p><p>Hesap versiyonlama ile eski account&#39;lar\u0131n\u0131z\u0131 yeni yap\u0131ya y\xFCkseltebilirsiniz.</p><p>:::Not Bu, Programa Ait Hesaplarda (POA) verileri ta\u015F\u0131man\u0131n bir\xE7ok yolundan yaln\u0131zca biridir. :::</p><h2 id="scenario-senaryo" tabindex="-1"><a class="header-anchor" href="#scenario-senaryo" aria-hidden="true">#</a> Scenario (Senaryo)</h2><p>Hesap verilerimizi s\xFCr\xFCmlendirmek ve ta\u015F\u0131mak i\xE7in her account i\xE7in bir kimlik sa\u011Flayaca\u011F\u0131z. Bu kimlik, programa aktard\u0131\u011F\u0131m\u0131zda account s\xFCr\xFCm\xFCn\xFC tan\u0131mlamam\u0131z\u0131 ve b\xF6ylece account&#39;\u0131 do\u011Fru \u015Fekilde i\u015Flememizi sa\u011Flayacakt\u0131r.</p><p>A\u015Fa\u011F\u0131daki account durumunu ve program\u0131n\u0131 alal\u0131m:</p><img src="'+i+`" alt="Program Account v1"><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">AccountContentCurrent</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> somevalue<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">ProgramAccountState</span> <span class="token punctuation">{</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    data_version<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    account_data<span class="token punctuation">:</span> <span class="token class-name">AccountContentCurrent</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Bir account&#39;\u0131n ilk versiyonunda a\u015Fa\u011F\u0131dakileri yap\u0131yoruz:</p><table><thead><tr><th>ID</th><th>Action</th></tr></thead><tbody><tr><td>1</td><td>Verilerinize bir &#39;veri s\xFCr\xFCm\xFC&#39; alan\u0131 ekleyin. Basit bir artan s\u0131ra (\xF6r. u8) veya daha karma\u015F\u0131k bir \u015Fey olabilir.</td></tr><tr><td>2</td><td>Veri b\xFCy\xFCmesi i\xE7in yeterli alan ay\u0131r\u0131n.</td></tr><tr><td>3</td><td>Program s\xFCr\xFCmlerinde kullan\u0131lacak bir array sabiti ba\u015Flat\u0131n.</td></tr><tr><td>4</td><td>Gelecekteki y\xFCkseltmeler i\xE7in <code>fn conversion_logic</code> alt\u0131na bir g\xFCncelleme account&#39;\u0131 i\u015Flevi ekleyin.</td></tr></tbody></table><p>Diyelim ki program\u0131m\u0131z\u0131n account&#39;lar\u0131n\u0131 yeni bir zorunlu alan, <code>somestring</code> alan\u0131 i\xE7erecek \u015Fekilde y\xFCkseltmek istiyoruz.</p><p>Bir \xF6nceki account&#39;ta fazladan yer ay\u0131rmasayd\u0131k account&#39;\u0131 y\xFCkseltemez ve tak\u0131l\u0131p kal\u0131rd\u0131k.</p><h2 id="upgrading-the-account-account-\u0131-yukseltme" tabindex="-1"><a class="header-anchor" href="#upgrading-the-account-account-\u0131-yukseltme" aria-hidden="true">#</a> Upgrading the Account (Account\u2019\u0131 Y\xFCkseltme)</h2><p>Yeni program\u0131m\u0131zda i\xE7erik durumu i\xE7in yeni bir \xF6zellik eklemek istiyoruz. Bunu takip eden de\u011Fi\u015Fiklikler, ilk program yap\u0131lar\u0131n\u0131 \u015Fimdi kullan\u0131ma girdiklerinde nas\u0131l kulland\u0131\u011F\u0131m\u0131zd\u0131r.</p><h3 id="_1-add-account-conversion-logic-hesap-donusturme-mant\u0131g\u0131-ekleme" tabindex="-1"><a class="header-anchor" href="#_1-add-account-conversion-logic-hesap-donusturme-mant\u0131g\u0131-ekleme" aria-hidden="true">#</a> 1. Add account conversion logic (Hesap d\xF6n\xFC\u015Ft\xFCrme mant\u0131\u011F\u0131 ekleme)</h3><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">/// Current state (DATA_VERSION 1). If version changes occur, this</span>
<span class="token comment">/// should be copied to another (see AccountContentOld below)</span>
<span class="token comment">/// We&#39;ve added a new field: &#39;somestring&#39;</span>
<span class="token attribute attr-name">#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">AccountContentCurrent</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> somevalue<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> somestring<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Old content state (DATA_VERSION 0).</span>
<span class="token attribute attr-name">#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">AccountContentOld</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> somevalue<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Maintains account data</span>
<span class="token attribute attr-name">#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">ProgramAccountState</span> <span class="token punctuation">{</span>
    is_initialized<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    data_version<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    account_data<span class="token punctuation">:</span> <span class="token class-name">AccountContentCurrent</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><table><thead><tr><th>Sat\u0131rlar</th><th>Not</th></tr></thead><tbody><tr><td>6</td><td>Daha b\xFCy\xFCk veri blo\u011Fundan veri alt k\xFCmelerini okumay\u0131 basitle\u015Ftirmek i\xE7in Solana&#39;n\u0131n <code>solana_program::borsh::try_from_slice_unchecked</code> program\u0131n\u0131 ekledik</td></tr><tr><td>13-26</td><td>Burada, <code>AccountContentCurrent</code>&#39;\u0131 17. sat\u0131rdan ba\u015Flayarak geni\u015Fletmeden \xF6nce, <code>AccountContentOld</code> sat\u0131r 24 olan eski i\xE7erik yap\u0131s\u0131n\u0131 koruduk.</td></tr><tr><td>60</td><td><code>DATA_VERSION</code> sabitini bump ettik.</td></tr><tr><td>71</td><td>Art\u0131k bir &#39;\xF6nceki&#39; versiyonumuz var ve boyutunu bilmek istiyoruz.</td></tr><tr><td>86</td><td>Coup de gr\xE2ce, \xF6nceki i\xE7erik durumunu yeni (mevcut) i\xE7erik durumuna y\xFCkseltti.</td></tr></tbody></table><p>Daha sonra, <code>somestring</code> ve i\u015Flemciyi g\xFCncellemek i\xE7in yeni bir tane eklemek \xFCzere talimatlar\u0131m\u0131z\u0131 g\xFCncelleriz. Veri yap\u0131s\u0131n\u0131n &#39;y\xFCkseltilmesinin&#39;, <code>pack/unpack</code> (paketleme/paket a\xE7ma) i\u015Fleminin arkas\u0131nda kaps\xFCllendi\u011Fine dikkat edin.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//! instruction Contains the main VersionProgramInstruction enum</span>

<span class="token keyword">use</span> <span class="token punctuation">{</span>
    <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">DataVersionError</span><span class="token punctuation">,</span>
    <span class="token namespace">borsh<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BorshDeserialize</span><span class="token punctuation">,</span> <span class="token class-name">BorshSerialize</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">solana_program<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">borsh<span class="token punctuation">::</span></span>try_from_slice_unchecked<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token namespace">program_error<span class="token punctuation">::</span></span><span class="token class-name">ProgramError</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(BorshDeserialize, BorshSerialize, Debug, PartialEq)]</span>
<span class="token comment">/// All custom program instructions</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">VersionProgramInstruction</span> <span class="token punctuation">{</span>
    <span class="token class-name">InitializeAccount</span><span class="token punctuation">,</span>
    <span class="token class-name">SetU64Value</span><span class="token punctuation">(</span><span class="token keyword">u64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">SetString</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Added with data version change</span>
    <span class="token class-name">FailInstruction</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">VersionProgramInstruction</span> <span class="token punctuation">{</span>
    <span class="token comment">/// Unpack inbound buffer to associated Instruction</span>
    <span class="token comment">/// The expected format for input is a Borsh serialized vector</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">unpack</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">ProgramError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> payload <span class="token operator">=</span> <span class="token function">try_from_slice_unchecked</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">VersionProgramInstruction</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// let payload = VersionProgramInstruction::try_from_slice(input).unwrap();</span>
        <span class="token keyword">match</span> payload <span class="token punctuation">{</span>
            <span class="token class-name">VersionProgramInstruction</span><span class="token punctuation">::</span><span class="token class-name">InitializeAccount</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">VersionProgramInstruction</span><span class="token punctuation">::</span><span class="token class-name">SetU64Value</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">VersionProgramInstruction</span><span class="token punctuation">::</span><span class="token class-name">SetString</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Added with data version change</span>
            _ <span class="token operator">=&gt;</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">DataVersionError</span><span class="token punctuation">::</span><span class="token class-name">InvalidInstruction</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>Bir talimat olu\u015Fturup g\xF6nderdikten sonra: <code>VersionProgramInstruction::SetString(String)</code> art\u0131k a\u015Fa\u011F\u0131daki &#39;y\xFCkseltilmi\u015F&#39; account veri d\xFCzenine sahibiz.</p><img src="`+u+'" alt="Program Account v2"><h2 id="resources" tabindex="-1"><a class="header-anchor" href="#resources" aria-hidden="true">#</a> Resources</h2>',24),d={href:"https://borsh.io/",target:"_blank",rel:"noopener noreferrer"},b=e("Borsh Specification"),g={href:"https://github.com/solana-labs/solana/blob/master/sdk/program/src/borsh.rs#L67",target:"_blank",rel:"noopener noreferrer"},h=e("Solana "),y=n("code",null,"try_from_slice_unchecked",-1),_={href:"https://github.com/FrankC01/versioning-solana",target:"_blank",rel:"noopener noreferrer"},v=e("Reference Implementation");function f(z,w){const a=p("ExternalLinkIcon");return o(),r(c,null,[m,n("ul",null,[n("li",null,[n("a",d,[b,s(a)])]),n("li",null,[n("a",g,[h,y,s(a)])]),n("li",null,[n("a",_,[v,s(a)])])])],64)}var S=t(k,[["render",f]]);export{S as default};
