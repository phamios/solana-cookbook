import{_ as e,r as o,o as c,c as l,a as n,b as p,F as u,d as a,e as t}from"./app.07ce7a66.js";const i={},r=n("h1",{id:"sistema-ng-enerhiya",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#sistema-ng-enerhiya","aria-hidden":"true"},"#"),a(" Sistema ng Enerhiya")],-1),k=n("p",null,[a("Ang mga kaswal na laro ay karaniwang gumagamit ng mga sistema ng enerhiya, ibig sabihin, ang mga pagkilos sa laro ay nagkakahalaga ng enerhiya na muling pinupuno sa paglipas ng panahon. Sa gabay na ito tatalakayin natin kung paano bumuo ng isa sa Solana. Inirerekomenda na magsimula sa "),n("a",{href:"../gaming/hello-world"},"Hello World Example"),a(" kung wala kang anumang dating kaalaman sa Solana.")],-1),g=n("p",null,"Narito ang isang kumpletong halimbawa ng source code batay sa Solana dapp scaffold na may react client:",-1),m={href:"https://github.com/solana-developers/solana-game-starter-kits/tree/main/lumberjack",target:"_blank",rel:"noopener noreferrer"},b=a("Source"),d=t(`<h2 id="anchor-program" tabindex="-1"><a class="header-anchor" href="#anchor-program" aria-hidden="true">#</a> Anchor program</h2><p>Sa tutorial na ito, gagabayan ka namin sa proseso ng paglikha ng isang program na unti-unting nagre-replenishes sa mga reserbang enerhiya ng player sa paglipas ng panahon. Ito, sa turn, ay magbibigay-daan sa kanila na magsagawa ng iba&#39;t ibang mga aksyon sa loob ng laro. Sa aming halimbawa, ang isang lumber jack ay magpuputol ng mga puno sa bawat puno ay nagbibigay ng isang kahoy at nagkakahalaga ng isang enerhiya.</p><h3 id="paggawa-ng-player-account" tabindex="-1"><a class="header-anchor" href="#paggawa-ng-player-account" aria-hidden="true">#</a> Paggawa ng player account</h3><p>Una kailangan ng player na gumawa ng account na nagse-save sa estado ng aming player. Pansinin na ang last_login time ay nagse-save sa kasalukuyang unix time stamp ng player na nakikipag-ugnayan siya sa program. Sa ganitong estado, magagawa nating kalkulahin kung gaano karaming enerhiya ang mayroon ang manlalaro sa isang tiyak na punto ng oras. Mayroon din kaming halaga para sa kung gaano karaming kahoy ang ibinabato ng lumber jack sa laro.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">init_player</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">InitPlayer</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy <span class="token operator">=</span> <span class="token constant">MAX_ENERGY</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>last_login <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>unix_timestamp<span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token punctuation">...</span>

<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">InitPlayer</span> <span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span>
        init<span class="token punctuation">,</span>
        payer <span class="token operator">=</span> signer<span class="token punctuation">,</span>
        space <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        seeds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b&quot;player&quot;</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> signer<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        bump<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> player<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">PlayerData</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut)]</span>
    <span class="token keyword">pub</span> signer<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> system_program<span class="token punctuation">:</span> <span class="token class-name">Program</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[account]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">PlayerData</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> level<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> xp<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> wood<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> energy<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> last_login<span class="token punctuation">:</span> <span class="token keyword">i64</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="pagputol-ng-mga-puno" tabindex="-1"><a class="header-anchor" href="#pagputol-ng-mga-puno" aria-hidden="true">#</a> Pagputol ng mga puno</h3><p>Pagkatapos ay sa tuwing tatawag ang manlalaro ng <code>chop tree</code> na pagtuturo ay susuriin natin kung ang manlalaro ay may sapat na lakas at gagantimpalaan siya ng isang kahoy.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>    <span class="token attribute attr-name">#[error_code]</span>
    <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">ErrorCode</span> <span class="token punctuation">{</span>
        <span class="token attribute attr-name">#[msg(<span class="token string">&quot;Not enough energy&quot;</span>)]</span>
        <span class="token class-name">NotEnoughEnergy</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">chop_tree</span><span class="token punctuation">(</span><span class="token keyword">mut</span> ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">ChopTree</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> account <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">;</span>
        <span class="token function">update_energy</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token macro property">err!</span><span class="token punctuation">(</span><span class="token class-name">ErrorCode</span><span class="token punctuation">::</span><span class="token class-name">NotEnoughEnergy</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>wood <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>wood <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;You chopped a tree and got 1 wood. You have {} wood and {} energy left.&quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>wood<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="kinakalkula-ang-enerhiya" tabindex="-1"><a class="header-anchor" href="#kinakalkula-ang-enerhiya" aria-hidden="true">#</a> Kinakalkula ang enerhiya</h3><p>Ang kawili-wiling bahagi ay nangyayari sa <code>update_energy</code> function. Sinusuri namin kung gaano karaming oras ang lumipas at kinakalkula ang enerhiya na magkakaroon ng manlalaro sa ibinigay na oras. Ganun din ang gagawin namin sa client. Tamad kaming nag-a-update ng enerhiya sa halip na botohan ito sa lahat ng oras. Ang ay isang karaniwang pamamaraan sa pagbuo ng laro.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>
<span class="token keyword">const</span> <span class="token constant">TIME_TO_REFILL_ENERGY</span><span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">MAX_ENERGY</span><span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">update_energy</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">ChopTree</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> time_passed<span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>unix_timestamp <span class="token operator">-</span> <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>player<span class="token punctuation">.</span>last_login<span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> time_spent<span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> time_passed <span class="token operator">&gt;</span> <span class="token constant">TIME_TO_REFILL_ENERGY</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy <span class="token operator">=</span> ctx<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        time_passed <span class="token operator">-=</span> <span class="token constant">TIME_TO_REFILL_ENERGY</span><span class="token punctuation">;</span>
        time_spent <span class="token operator">+=</span> <span class="token constant">TIME_TO_REFILL_ENERGY</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> ctx<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy <span class="token operator">==</span> <span class="token constant">MAX_ENERGY</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> ctx<span class="token punctuation">.</span>player<span class="token punctuation">.</span>energy <span class="token operator">&gt;=</span> <span class="token constant">MAX_ENERGY</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>player<span class="token punctuation">.</span>last_login <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>unix_timestamp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span>player<span class="token punctuation">.</span>last_login <span class="token operator">+=</span> time_spent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="js-client" tabindex="-1"><a class="header-anchor" href="#js-client" aria-hidden="true">#</a> Js client</h2>`,12),y=a("Narito ang isang kumpletong halimbawa batay sa Solana dapp scaffold na may react client: "),h={href:"https://github.com/solana-developers/solana-game-starter-kits/tree/main/lumberjack",target:"_blank",rel:"noopener noreferrer"},w=a("Source"),f=t(`<h3 id="lumikha-ng-koneksyon" tabindex="-1"><a class="header-anchor" href="#lumikha-ng-koneksyon" aria-hidden="true">#</a> Lumikha ng koneksyon</h3><p>Sa Anchor.ts file lumikha kami ng isang koneksyon:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span>
    <span class="token string">&quot;https://api.devnet.solana.com&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;confirmed&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Pansinin na ang parameter ng pagkumpirma ay nakatakda sa &#39;nakumpirma&#39;. Nangangahulugan ito na maghihintay kami hanggang sa makumpirma ang mga transaksyon sa halip na ma-finalize. Nangangahulugan ito na maghihintay tayo hanggang sa sabihin ng super majority ng network na valid ang transaksyon. Ito ay tumatagal ng humigit-kumulang 400ms at walang nakumpirmang transaksyon na hindi na-finalize. Kaya para sa mga laro ito ang perpektong bandila ng kumpirmasyon.</p><h3 id="magsimula-ng-data-ng-player" tabindex="-1"><a class="header-anchor" href="#magsimula-ng-data-ng-player" aria-hidden="true">#</a> Magsimula ng data ng player</h3><p>Ang unang bagay na gagawin namin ay hanapin ang address ng programa para sa player account gamit ang seed string <code>manlalaro</code> at ang pampublikong key ng player. Pagkatapos ay tinatawagan namin ang <code>initPlayer</code> upang gawin ang account.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>pda<span class="token punctuation">]</span> <span class="token operator">=</span> PublicKey<span class="token punctuation">.</span><span class="token function">findProgramAddressSync</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;player&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> publicKey<span class="token punctuation">.</span><span class="token function">toBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span><span class="token constant">LUMBERJACK_PROGRAM_ID</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> transaction <span class="token operator">=</span> program<span class="token punctuation">.</span>methods
  <span class="token punctuation">.</span><span class="token function">initPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">accounts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">player</span><span class="token operator">:</span> pda<span class="token punctuation">,</span>
    <span class="token literal-property property">signer</span><span class="token operator">:</span> publicKey<span class="token punctuation">,</span>
    <span class="token literal-property property">systemProgram</span><span class="token operator">:</span> SystemProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> tx <span class="token operator">=</span> <span class="token keyword">await</span> transaction<span class="token punctuation">;</span>
<span class="token keyword">const</span> txSig <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> connection<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">skipPreflight</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>txSig<span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="mag-subscribe-sa-mga-update-sa-account" tabindex="-1"><a class="header-anchor" href="#mag-subscribe-sa-mga-update-sa-account" aria-hidden="true">#</a> Mag-subscribe sa mga update sa account</h3><p>Dito makikita mo kung paano kumuha ng data ng account sa js client at kung paano mag-subscribe sa isang account. Gumagawa ang <code>connection.onAccountChange</code> ng socket connection sa RPC node na magtutulak ng anumang pagbabagong mangyayari sa account sa kliyente. Ito ay mas mabilis kaysa sa pagkuha ng bagong data ng account pagkatapos ng bawat pagbabago. Pagkatapos ay maaari nating gamitin ang <code>program.coder</code> upang i-decode ang data ng account sa mga uri ng TS at direktang gamitin ito sa laro.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>publicKey<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>pda<span class="token punctuation">]</span> <span class="token operator">=</span> PublicKey<span class="token punctuation">.</span><span class="token function">findProgramAddressSync</span><span class="token punctuation">(</span>
        <span class="token punctuation">[</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;player&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> publicKey<span class="token punctuation">.</span><span class="token function">toBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">PublicKey</span><span class="token punctuation">(</span><span class="token constant">LUMBERJACK_PROGRAM_ID</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      program<span class="token punctuation">.</span>account<span class="token punctuation">.</span>playerData<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>pda<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setGameState</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;No player data found, please init!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    connection<span class="token punctuation">.</span><span class="token function">onAccountChange</span><span class="token punctuation">(</span>pda<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">account</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setGameState</span><span class="token punctuation">(</span>program<span class="token punctuation">.</span>coder<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token string">&quot;playerData&quot;</span><span class="token punctuation">,</span> account<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>publicKey<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="kalkulahin-ang-enerhiya-at-ipakita-ang-count-down" tabindex="-1"><a class="header-anchor" href="#kalkulahin-ang-enerhiya-at-ipakita-ang-count-down" aria-hidden="true">#</a> Kalkulahin ang enerhiya at ipakita ang count down</h3><p>Sa javascript client, maaari nating gawin ang parehong logic tulad ng sa program para makalkula kung gaano karaming enerhiya ang mayroon ang player sa oras na ito at magpakita ng countdown timer para sa player upang malaman niya kung kailan magiging available ang susunod na enerhiya:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>gameState <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> gameState<span class="token punctuation">.</span>lastLogin <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> gameState<span class="token punctuation">.</span>energy <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token keyword">const</span> lastLoginTime <span class="token operator">=</span> gameState<span class="token punctuation">.</span>lastLogin <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> timePassed <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> lastLoginTime<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>timePassed <span class="token operator">&gt;</span> <span class="token constant">TIME_TO_REFILL_ENERGY</span> <span class="token operator">&amp;&amp;</span> gameState<span class="token punctuation">.</span>energy <span class="token operator">&lt;</span> <span class="token constant">MAX_ENERGY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            gameState<span class="token punctuation">.</span>energy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>gameState<span class="token punctuation">.</span>energy<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            gameState<span class="token punctuation">.</span>lastLogin <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>gameState<span class="token punctuation">.</span>lastLogin<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">TIME_TO_REFILL_ENERGY</span><span class="token punctuation">;</span>
            timePassed <span class="token operator">-=</span> <span class="token constant">TIME_TO_REFILL_ENERGY</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setTimePassed</span><span class="token punctuation">(</span>timePassed<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> nextEnergyIn <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token constant">TIME_TO_REFILL_ENERGY</span> <span class="token operator">-</span> timePassed<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextEnergyIn <span class="token operator">&lt;</span> <span class="token constant">TIME_TO_REFILL_ENERGY</span> <span class="token operator">&amp;&amp;</span> nextEnergyIn <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setEnergyNextIn</span><span class="token punctuation">(</span>nextEnergyIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">setEnergyNextIn</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>gameState<span class="token punctuation">,</span> timePassed<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">...</span>

<span class="token punctuation">{</span><span class="token punctuation">(</span>gameState <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;flex flex-col items-center&quot;</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token string">&quot;Wood: &quot;</span> <span class="token operator">+</span> gameState<span class="token punctuation">.</span>wood <span class="token operator">+</span> <span class="token string">&quot; Energy: &quot;</span> <span class="token operator">+</span> gameState<span class="token punctuation">.</span>energy <span class="token operator">+</span> <span class="token string">&quot; Next energy in: &quot;</span> <span class="token operator">+</span> nextEnergyIn <span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>Sa pamamagitan nito maaari ka na ngayong bumuo ng anumang larong nakabatay sa enerhiya at kahit na ang isang tao ay bumuo ng isang bot para sa laro ang pinakamaraming magagawa niya ay maglaro nang mahusay, na marahil ay mas madaling makamit kapag naglalaro nang normal depende sa lohika ng iyong laro.</p><p>Ang larong ito ay nagiging mas mahusay kapag isinama sa <a href="../gaming/interact-with-tokens">halimbawa ng Token</a> at talagang nag-drop ka ng ilang spl token sa mga manlalaro.</p>`,15);function _(E,x){const s=o("ExternalLinkIcon");return c(),l(u,null,[r,k,g,n("p",null,[n("a",m,[b,p(s)])]),d,n("p",null,[y,n("a",h,[w,p(s)])]),f],64)}var S=e(i,[["render",_]]);export{S as default};
