import{_ as r,r as e,o as i,c as k,b as a,w as t,a as n,F as m,e as d,d as s}from"./app.07ce7a66.js";var b="/assets/scfsd.cc67ec33.png";const f={},_=d(`<h1 id="test-de-conformite-des-fonctionnalites" tabindex="-1"><a class="header-anchor" href="#test-de-conformite-des-fonctionnalites" aria-hidden="true">#</a> Test de Conformit\xE9 des Fonctionnalit\xE9s</h1><p>Lorsque vous testez votre programme, il est essentiel de s&#39;assurer qu&#39;il fonctionnera de la m\xEAme mani\xE8re dans diff\xE9rents clusters, tant pour la qualit\xE9 que pour l&#39;obtention des r\xE9sultats attendus.</p><h2 id="faits" tabindex="-1"><a class="header-anchor" href="#faits" aria-hidden="true">#</a> Faits</h2><div class="custom-container tip"><p class="custom-container-title">Fiche d&#39;Information</p><ul><li>Les fonctionnalit\xE9s sont des changements qui sont introduits dans le code des validateurs Solana et qui n\xE9cessitent une activation pour \xEAtre utilis\xE9s.</li><li>Les fonctionnalit\xE9s peuvent \xEAtre activ\xE9es dans un cluster (par exemple testnet) mais pas dans un autre (par exemple mainnet-beta).</li><li>Cependant, lorsque vous ex\xE9cutez localement la version par d\xE9faut de <code>solana-test-validator</code>, toutes les fonctionnalit\xE9s disponibles dans votre version de Solana sont automatiquement activ\xE9es. Le r\xE9sultat est que lorsque vous testez localement, les fonctionnalit\xE9s et les r\xE9sultats de vos tests peuvent ne pas \xEAtre les m\xEAmes lorsque vous d\xE9ployez et ex\xE9cutez dans un cluster diff\xE9rent !</li></ul></div><h2 id="scenario" tabindex="-1"><a class="header-anchor" href="#scenario" aria-hidden="true">#</a> Sc\xE9nario</h2><p>Supposons que vous ayez une Transaction qui contient trois (3) instructions et que chaque instruction consomme environ 100_000 Unit\xE9s de Calcul (UC). Lors de l&#39;ex\xE9cution sur une version Solana 1.8.x, vous observeriez une consommation de CU d&#39;instruction ressemblant \xE0 :</p><table><thead><tr><th>Instruction</th><th>CU de d\xE9part</th><th>Ex\xE9cution</th><th>CU Restants</th></tr></thead><tbody><tr><td>1</td><td>200_000</td><td>-100_000</td><td>100_000</td></tr><tr><td>2</td><td>200_000</td><td>-100_000</td><td>100_000</td></tr><tr><td>3</td><td>200_000</td><td>-100_000</td><td>100_000</td></tr></tbody></table><p>Dans Solana 1.9.2, une fonctionnalit\xE9 appel\xE9e &quot;plafond de calcul pour l&#39;ensemble des transactions (transaction wide compute cap)&quot; a \xE9t\xE9 introduite. Par d\xE9faut, une Transaction a un budget de 200_000 CU et les instructions qui la composent vont <strong><em>d\xE9biter</em></strong> ce budget de Transaction. L&#39;ex\xE9cution de la m\xEAme transaction indiqu\xE9e ci-dessus aurait un comportement tr\xE8s diff\xE9rent :</p><table><thead><tr><th>Instruction</th><th>CU de d\xE9part</th><th>Ex\xE9cution</th><th>CU Restants</th></tr></thead><tbody><tr><td>1</td><td>200_000</td><td>-100_000</td><td>100_000</td></tr><tr><td>2</td><td>100_000</td><td>-100_000</td><td>0</td></tr><tr><td>3</td><td>0</td><td>FAIL!!!</td><td>FAIL!!!</td></tr></tbody></table><p>A\xEFe ! Si vous n&#39;en \xE9tiez pas conscient, vous seriez probablement frustr\xE9 car aucun changement dans vos instructions n&#39;aurait pu provoquer ce ph\xE9nom\xE8ne. Sur le devnet il fonctionne bien, mais localement il \xE9choue ?!?</p><p>Il est possible d&#39;augmenter le budget global de la Transaction, par exemple \xE0 300_000 UC, et de sauver votre sant\xE9 mentale, mais cela montre pourquoi les tests avec <strong>_Conformit\xE9 des Fonctionnalit\xE9s</strong> constituent un bon moyen d&#39;\xE9viter toute confusion.</p><h2 id="statut-de-la-fonctionnalite" tabindex="-1"><a class="header-anchor" href="#statut-de-la-fonctionnalite" aria-hidden="true">#</a> Statut de la Fonctionnalit\xE9</h2><p>Il est assez facile de v\xE9rifier quelles fonctionnalit\xE9s sont disponibles pour un cluster donn\xE9 avec la commande <code>solana feature status</code>.</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana feature status -ud   // Displays by feature status for devnet
solana feature status -ut   // Displays for testnet
solana feature status -um   // Displays for mainnet-beta
solana feature status -ul   // Displays for local, requires running solana-test-validator
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Alternativement, vous pouvez utiliser un outil comme <a href="#ressources">scfsd</a> pour observer le statut de toutes les fonctionnalit\xE9s des diff\xE9rents clusters qui afficherait l&#39;\xE9cran partiel montr\xE9 ici et qui ne n\xE9cessite pas l&#39;ex\xE9cution de <code>solana-test-validator</code> :</p><img src="`+b+`" alt="Feature Status Heatmap"><h2 id="test-de-conformite" tabindex="-1"><a class="header-anchor" href="#test-de-conformite" aria-hidden="true">#</a> Test de Conformit\xE9</h2><p>Comme indiqu\xE9 ci-dessus, <code>solana-test-validator</code> active <strong>toutes</strong> les fonctionnalit\xE9s automatiquement. Donc, pour r\xE9pondre \xE0 la question &quot;Comment puis-je tester localement dans un environnement qui a une conformit\xE9 avec le devnet, le testnet ou encore le mainnet-beta ?&quot;.</p><p>Solution: Des PRs ont \xE9t\xE9 ajout\xE9s \xE0 Solana 1.9.6 pour permettre la d\xE9sactivation des fonctionnalit\xE9s :</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana-test-validator --deactivate-feature &lt;FEATURE_PUBKEY&gt; ...
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="demonstration-simple" tabindex="-1"><a class="header-anchor" href="#demonstration-simple" aria-hidden="true">#</a> D\xE9monstration Simple</h2><p>Supposons que vous ayez un programme simple qui enregistre les donn\xE9es qu&#39;il re\xE7oit en entr\xE9e et vous testez une transaction qui ajoute deux (2) instructions \xE0 votre programme.</p><h3 id="toutes-les-fonctionnalites-activees" tabindex="-1"><a class="header-anchor" href="#toutes-les-fonctionnalites-activees" aria-hidden="true">#</a> Toutes les fonctionnalit\xE9s activ\xE9es</h3><ol><li>Vous lancez le validateur de test dans un terminal :</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana config set -ul
solana-test-validator -l ./ledger --bpf-program target/deploy/PROGNAME.so --reset\`
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>Dans un autre terminal, vous d\xE9marrez le flux de logs :</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana logs
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="3"><li>Vous ex\xE9cutez ensuite votre transaction. Vous verriez quelque chose de similaire dans le terminal de log (\xE9dit\xE9 pour plus de clart\xE9) :</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc invoke [1]
Program log: process_instruction: PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc: 0 accounts, data=[0]
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc consumed 12843 of 200000 compute units
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc success
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc invoke [1]
Program log: process_instruction: PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc: 0 accounts, data=[1]
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc consumed 12843 of 187157 compute units
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc success[
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Comme notre fonctionnalit\xE9 &quot;plafond de calcul pour l&#39;ensemble des transactions&quot; est automatiquement activ\xE9e par d\xE9faut, nous observons que chaque instruction pr\xE9l\xE8ve des UC sur le budget de transaction de d\xE9part de 200_000 UC.</p><h3 id="fonctionnalites-selectives-desactivees" tabindex="-1"><a class="header-anchor" href="#fonctionnalites-selectives-desactivees" aria-hidden="true">#</a> Fonctionnalit\xE9s s\xE9lectives d\xE9sactiv\xE9es</h3><ol><li>Pour cette ex\xE9cution, nous voulons faire en sorte que le comportement du budget de CU soit en conformit\xE9 avec ce qui est ex\xE9cut\xE9 sur le devnet. En utilisant le(s) outil(s) d\xE9crit(s) dans <a href="#statut-de-la-fonctionnalit%C3%A9">Statut de la Fonctionnalit\xE9</a> nous isolons la cl\xE9 publique <code>transaction wide compute cap</code> et utilisons la fonction <code>--deactivate-feature</code> au d\xE9marrage du validateur de test</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana-test-validator -l ./ledger --deactivate-feature 5ekBxc8itEnPv4NzGJtr8BVVQLNMQuLMNQQj7pHoLNZ9 --bpf-program target/deploy/PROGNAME.so --reset\`
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>Nous voyons maintenant dans nos logs que nos instructions ont maintenant leur propre budget de 200_000 CU (\xE9dit\xE9 pour plus de clart\xE9) qui est actuellement l&#39;\xE9tat dans tous les clusters :</li></ol><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc invoke [1]
Program log: process_instruction: PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc: 0 accounts, data=[0]
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc consumed 12843 of 200000 compute units
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc success
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc invoke [1]
Program log: process_instruction: PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc: 0 accounts, data=[0]
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc consumed 12843 of 200000 compute units
Program PWDnx8LkjJUn9bAVzG6Fp6BuvB41x7DkBZdo9YLMGcc success
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="tests-de-conformite-complete" tabindex="-1"><a class="header-anchor" href="#tests-de-conformite-complete" aria-hidden="true">#</a> Tests de Conformit\xE9 Compl\xE8te</h2><p>Vous pouvez \xEAtre en conformit\xE9 compl\xE8te avec un cluster donn\xE9 en identifiant chaque fonctionnalit\xE9 qui n&#39;est pas encore activ\xE9e et ajouter un <code>--deactivate-feature &lt;FEATURE_PUBKEY&gt;</code> pour chacune d&#39;entre elles lors de l&#39;ex\xE9cution de <code>solana-test-validator</code>:</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana-test-validator --deactivate-feature PUBKEY_1 --deactivate-feature PUBKEY_2 ...
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Alternativement, <a href="#ressources">scfsd</a> fournit un switch de commande pour retourner l&#39;ensemble complet des fonctionnalit\xE9s d\xE9sactiv\xE9es pour un cluster afin d&#39;alimenter le d\xE9marrage de <code>solana-test-validator</code> :</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>solana-test-validator -l ./.ledger $(scfsd -c devnet -k -t)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Si vous ouvrez un autre terminal, alors que le validateur est en cours d&#39;ex\xE9cution, et que vous tapez <code>solana feature status</code>, vous verrez les fonctionnalit\xE9s d\xE9sactiv\xE9es qui ont \xE9t\xE9 trouv\xE9es d\xE9sactiv\xE9es sur le devnet</p><h2 id="test-de-conformite-complete-programme" tabindex="-1"><a class="header-anchor" href="#test-de-conformite-complete-programme" aria-hidden="true">#</a> Test de Conformit\xE9 Compl\xE8te programm\xE9</h2><p>Pour ceux qui contr\xF4lent l&#39;ex\xE9cution du validateur de test dans leur code de test, il est possible de modifier les fonctions d&#39;activation/d\xE9sactivation du validateur de test en utilisant TestValidatorGenesis. Avec Solana 1.9.6, une fonction a \xE9t\xE9 ajout\xE9e au constructeur de validateurs pour prendre en charge cette fonction.</p><p>A la racine du dossier de votre programme, cr\xE9ez un nouveau dossier appel\xE9 <code>tests</code> et ajoutez un fichier <code>parity_test.rs</code>. Voici les fonctions de base utilis\xE9es pour chaque test</p>`,44),g=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token attribute attr-name"},"#[cfg(test)]"),s(`
`),n("span",{class:"token keyword"},"mod"),s(),n("span",{class:"token module-declaration namespace"},"tests"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s("error"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token namespace"},[s("path"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"PathBuf"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"str"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"FromStr"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// Use gadget-scfs to get interegate feature lists from clusters"),s(`
    `),n("span",{class:"token comment"},'// must have `gadgets-scfs = "0.2.0" in Cargo.toml [dev-dependencies] to use'),s(`
    `),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("gadgets_scfs"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"ScfsCriteria"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ScfsMatrix"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"SCFS_DEVNET"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("solana_client"),n("span",{class:"token punctuation"},"::"),s("rpc_client"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"RpcClient"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("solana_program"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token namespace"},[s("instruction"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token namespace"},[s("message"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Message"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token namespace"},[s("pubkey"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("solana_sdk"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// Added in Solana 1.9.2"),s(`
        `),n("span",{class:"token namespace"},[s("compute_budget"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ComputeBudgetInstruction"),n("span",{class:"token punctuation"},","),s(`
        pubkey`),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token namespace"},[s("signature"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"Keypair"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Signature"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token namespace"},[s("signer"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Signer"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token namespace"},[s("transaction"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Transaction"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Extended in Solana 1.9.6"),s(`
    `),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("solana_test_validator"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"TestValidator"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TestValidatorGenesis"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"/// Location/Name of ProgramTestGenesis ledger"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"LEDGER_PATH"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"str"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"./.ledger"'),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"/// Path to BPF program (*.so) change if needed"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"PROG_PATH"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"str"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"target/deploy/"'),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"/// Program name from program Cargo.toml"),s(`
    `),n("span",{class:"token comment"},"/// FILL IN WITH YOUR PROGRAM_NAME"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"PROG_NAME"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"str"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"PROGRAM_NAME"'),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"/// Program public key"),s(`
    `),n("span",{class:"token comment"},"/// FILL IN WITH YOUR PROGRAM'S PUBLIC KEY str"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Pubkey"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token macro property"},"pubkey!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"PROGRAMS_PUBLIC_KEY_BASE58_STRING"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"/// 'transaction wide compute cap' public key"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"TXWIDE_LIMITS"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Pubkey"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token macro property"},"pubkey!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"5ekBxc8itEnPv4NzGJtr8BVVQLNMQuLMNQQj7pHoLNZ9"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"/// Setup the test validator passing features"),s(`
    `),n("span",{class:"token comment"},"/// you want to deactivate before running transactions"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"setup_validator"),n("span",{class:"token punctuation"},"("),s(`
        invalidate_features`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Vec"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"TestValidator"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Keypair"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Box"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"dyn"),s(),n("span",{class:"token namespace"},[s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Error"),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// Extend environment variable to include our program location"),s(`
        `),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::"),s("env"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"set_var"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"BPF_OUT_DIR"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"PROG_PATH"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// Instantiate the test validator"),s(`
        `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" test_validator "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"TestValidatorGenesis"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// Once instantiated, TestValidatorGenesis configuration functions follow"),s(`
        `),n("span",{class:"token comment"},"// a builder pattern enabling chaining of settings function calls"),s(`
        `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token punctuation"},"("),s("test_validator"),n("span",{class:"token punctuation"},","),s(" kp"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(` test_validator
            `),n("span",{class:"token comment"},"// Set the ledger path and name"),s(`
            `),n("span",{class:"token comment"},"// maps to `solana-test-validator --ledger <DIR>`"),s(`
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ledger_path"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"LEDGER_PATH"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token comment"},"// Load our program. Ignored if reusing ledger"),s(`
            `),n("span",{class:"token comment"},"// maps to `solana-test-validator --bpf-program <ADDRESS_OR_PATH BPF_PROGRAM.SO>`"),s(`
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add_program"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PROG_NAME"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token comment"},"// Identify features to deactivate. Ignored if reusing ledger"),s(`
            `),n("span",{class:"token comment"},"// maps to `solana-test-validator --deactivate-feature <FEATURE_PUBKEY>`"),s(`
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"deactivate_features"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("invalidate_features"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token comment"},"// Start the test validator"),s(`
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("test_validator"),n("span",{class:"token punctuation"},","),s(" kp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token comment"},"/// Convenience function to remove existing ledger before TestValidatorGenesis setup"),s(`
    `),n("span",{class:"token comment"},"/// maps to `solana-test-validator ... --reset`"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"clean_ledger_setup_validator"),n("span",{class:"token punctuation"},"("),s(`
        invalidate_features`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Vec"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"TestValidator"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Keypair"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Box"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"dyn"),s(),n("span",{class:"token namespace"},[s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Error"),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token class-name"},"PathBuf"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"from_str"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"LEDGER_PATH"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exists"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::"),s("fs"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"remove_dir_all"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"LEDGER_PATH"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token function"},"setup_validator"),n("span",{class:"token punctuation"},"("),s("invalidate_features"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token comment"},"/// Submits a transaction with programs instruction"),s(`
    `),n("span",{class:"token comment"},"/// Boiler plate"),s(`
    `),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"submit_transaction"),n("span",{class:"token punctuation"},"("),s(`
        rpc_client`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"RpcClient"),n("span",{class:"token punctuation"},","),s(`
        wallet_signer`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"dyn"),s(),n("span",{class:"token class-name"},"Signer"),n("span",{class:"token punctuation"},","),s(`
        instructions`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Vec"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"Signature"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Box"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"dyn"),s(),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::"),s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Error"),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" transaction "),n("span",{class:"token operator"},"="),s(`
            `),n("span",{class:"token class-name"},"Transaction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new_unsigned"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Message"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("instructions"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Some"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("wallet_signer"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"pubkey"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"let"),s(" recent_blockhash "),n("span",{class:"token operator"},"="),s(` rpc_client
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get_latest_blockhash"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map_err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token closure-params"},[n("span",{class:"token closure-punctuation punctuation"},"|"),s("err"),n("span",{class:"token closure-punctuation punctuation"},"|")]),s(),n("span",{class:"token macro property"},"format!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"error: unable to get recent blockhash: {}"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
        transaction
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"try_sign"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token macro property"},"vec!"),n("span",{class:"token punctuation"},"["),s("wallet_signer"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" recent_blockhash"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map_err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token closure-params"},[n("span",{class:"token closure-punctuation punctuation"},"|"),s("err"),n("span",{class:"token closure-punctuation punctuation"},"|")]),s(),n("span",{class:"token macro property"},"format!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"error: failed to sign transaction: {}"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"let"),s(" signature "),n("span",{class:"token operator"},"="),s(` rpc_client
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send_and_confirm_transaction"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("transaction"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map_err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token closure-params"},[n("span",{class:"token closure-punctuation punctuation"},"|"),s("err"),n("span",{class:"token closure-punctuation punctuation"},"|")]),s(),n("span",{class:"token macro property"},"format!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"error: send transaction: {}"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("signature"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"// UNIT TEST FOLLOWS"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br"),n("span",{class:"line-number"},"58"),n("br"),n("span",{class:"line-number"},"59"),n("br"),n("span",{class:"line-number"},"60"),n("br"),n("span",{class:"line-number"},"61"),n("br"),n("span",{class:"line-number"},"62"),n("br"),n("span",{class:"line-number"},"63"),n("br"),n("span",{class:"line-number"},"64"),n("br"),n("span",{class:"line-number"},"65"),n("br"),n("span",{class:"line-number"},"66"),n("br"),n("span",{class:"line-number"},"67"),n("br"),n("span",{class:"line-number"},"68"),n("br"),n("span",{class:"line-number"},"69"),n("br"),n("span",{class:"line-number"},"70"),n("br"),n("span",{class:"line-number"},"71"),n("br"),n("span",{class:"line-number"},"72"),n("br"),n("span",{class:"line-number"},"73"),n("br"),n("span",{class:"line-number"},"74"),n("br"),n("span",{class:"line-number"},"75"),n("br"),n("span",{class:"line-number"},"76"),n("br"),n("span",{class:"line-number"},"77"),n("br"),n("span",{class:"line-number"},"78"),n("br"),n("span",{class:"line-number"},"79"),n("br"),n("span",{class:"line-number"},"80"),n("br"),n("span",{class:"line-number"},"81"),n("br"),n("span",{class:"line-number"},"82"),n("br"),n("span",{class:"line-number"},"83"),n("br"),n("span",{class:"line-number"},"84"),n("br"),n("span",{class:"line-number"},"85"),n("br"),n("span",{class:"line-number"},"86"),n("br"),n("span",{class:"line-number"},"87"),n("br"),n("span",{class:"line-number"},"88"),n("br"),n("span",{class:"line-number"},"89"),n("br"),n("span",{class:"line-number"},"90"),n("br"),n("span",{class:"line-number"},"91"),n("br"),n("span",{class:"line-number"},"92"),n("br")])],-1),v=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token comment"},"/// Setup the test validator passing features"),s(`
`),n("span",{class:"token comment"},"/// you want to deactivate before running transactions"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"setup_validator"),n("span",{class:"token punctuation"},"("),s(`
    invalidate_features`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Vec"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"TestValidator"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Keypair"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Box"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"dyn"),s(),n("span",{class:"token namespace"},[s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Error"),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// Extend environment variable to include our program location"),s(`
    `),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::"),s("env"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"set_var"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"BPF_OUT_DIR"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"PROG_PATH"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Instantiate the test validator"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" test_validator "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"TestValidatorGenesis"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Once instantiated, TestValidatorGenesis configuration functions follow"),s(`
    `),n("span",{class:"token comment"},"// a builder pattern enabling chaining of settings function calls"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token punctuation"},"("),s("test_validator"),n("span",{class:"token punctuation"},","),s(" kp"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(` test_validator
        `),n("span",{class:"token comment"},"// Set the ledger path and name"),s(`
        `),n("span",{class:"token comment"},"// maps to `solana-test-validator --ledger <DIR>`"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ledger_path"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"LEDGER_PATH"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token comment"},"// Load our program. Ignored if reusing ledger"),s(`
        `),n("span",{class:"token comment"},"// maps to `solana-test-validator --bpf-program <ADDRESS_OR_PATH BPF_PROGRAM.SO>`"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add_program"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PROG_NAME"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token comment"},"// Identify features to deactivate. Ignored if reusing ledger"),s(`
        `),n("span",{class:"token comment"},"// maps to `solana-test-validator --deactivate-feature <FEATURE_PUBKEY>`"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"deactivate_features"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("invalidate_features"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token comment"},"// Start the test validator"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"start"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("test_validator"),n("span",{class:"token punctuation"},","),s(" kp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Convenience function to remove existing ledger before TestValidatorGenesis setup"),s(`
`),n("span",{class:"token comment"},"/// maps to `solana-test-validator ... --reset`"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"clean_ledger_setup_validator"),n("span",{class:"token punctuation"},"("),s(`
    invalidate_features`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Vec"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"TestValidator"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Keypair"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Box"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"dyn"),s(),n("span",{class:"token namespace"},[s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Error"),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token class-name"},"PathBuf"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"from_str"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"LEDGER_PATH"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"exists"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::"),s("fs"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"remove_dir_all"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"LEDGER_PATH"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token function"},"setup_validator"),n("span",{class:"token punctuation"},"("),s("invalidate_features"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Submits a transaction with programs instruction"),s(`
`),n("span",{class:"token comment"},"/// Boiler plate"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"submit_transaction"),n("span",{class:"token punctuation"},"("),s(`
    rpc_client`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"RpcClient"),n("span",{class:"token punctuation"},","),s(`
    wallet_signer`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"dyn"),s(),n("span",{class:"token class-name"},"Signer"),n("span",{class:"token punctuation"},","),s(`
    instructions`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Vec"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"Signature"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Box"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"dyn"),s(),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::"),s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Error"),n("span",{class:"token operator"},">>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" transaction "),n("span",{class:"token operator"},"="),s(`
        `),n("span",{class:"token class-name"},"Transaction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new_unsigned"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Message"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("instructions"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Some"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("wallet_signer"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"pubkey"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" recent_blockhash "),n("span",{class:"token operator"},"="),s(` rpc_client
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get_latest_blockhash"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map_err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token closure-params"},[n("span",{class:"token closure-punctuation punctuation"},"|"),s("err"),n("span",{class:"token closure-punctuation punctuation"},"|")]),s(),n("span",{class:"token macro property"},"format!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"error: unable to get recent blockhash: {}"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    transaction
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"try_sign"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token macro property"},"vec!"),n("span",{class:"token punctuation"},"["),s("wallet_signer"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" recent_blockhash"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map_err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token closure-params"},[n("span",{class:"token closure-punctuation punctuation"},"|"),s("err"),n("span",{class:"token closure-punctuation punctuation"},"|")]),s(),n("span",{class:"token macro property"},"format!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"error: failed to sign transaction: {}"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" signature "),n("span",{class:"token operator"},"="),s(` rpc_client
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send_and_confirm_transaction"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("transaction"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map_err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token closure-params"},[n("span",{class:"token closure-punctuation punctuation"},"|"),s("err"),n("span",{class:"token closure-punctuation punctuation"},"|")]),s(),n("span",{class:"token macro property"},"format!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"error: send transaction: {}"'),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("signature"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br")])],-1),h=n("p",null,[s("Nous pouvons maintenant ajouter des fonctions de test dans le corps de "),n("code",null,"mod test {...}"),s(" pour d\xE9montrer la configuration par d\xE9faut du validateur (toutes les fonctionnalit\xE9s activ\xE9es) et ensuite d\xE9sactiver "),n("code",null,"transaction wide compute cap"),s(" acomme dans les exemples pr\xE9c\xE9dents en ex\xE9cutant "),n("code",null,"solana-test-validator"),s(" \xE0 partir de la ligne de commande.")],-1),y=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token attribute attr-name"},"#[test]"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"test_base_pass"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// Run with all features activated (default for TestValidatorGenesis)"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" inv_feat "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token macro property"},"vec!"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Start validator with clean (new) ledger"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token punctuation"},"("),s("test_validator"),n("span",{class:"token punctuation"},","),s(" main_payer"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"clean_ledger_setup_validator"),n("span",{class:"token punctuation"},"("),s("inv_feat"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Get the RpcClient"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" connection "),n("span",{class:"token operator"},"="),s(" test_validator"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get_rpc_client"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Capture our programs log statements"),s(`
    `),n("span",{class:"token namespace"},[s("solana_logger"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"setup_with_default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"solana_runtime::message=debug"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// This example doesn't require sending any accounts to program"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" accounts "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Build instruction array and submit transaction"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" txn "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"submit_transaction"),n("span",{class:"token punctuation"},"("),s(`
        `),n("span",{class:"token operator"},"&"),s("connection"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token operator"},"&"),s("main_payer"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token comment"},"// Add two (2) instructions to transaction to demonstrate"),s(`
        `),n("span",{class:"token comment"},"// that each instruction CU draws down from default Transaction CU (200_000)"),s(`
        `),n("span",{class:"token comment"},"// Replace with instructions that make sense for your program"),s(`
        `),n("span",{class:"token punctuation"},"["),s(`
            `),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new_with_borsh"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token number"},"0u8"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new_with_borsh"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token number"},"1u8"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"]"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token macro property"},"assert!"),n("span",{class:"token punctuation"},"("),s("txn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"is_ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br")])],-1),w=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token attribute attr-name"},"#[test]"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"test_deactivate_tx_cu_pass"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// Run with all features activated except 'transaction wide compute cap'"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" inv_feat "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token macro property"},"vec!"),n("span",{class:"token punctuation"},"["),n("span",{class:"token constant"},"TXWIDE_LIMITS"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Start validator with clean (new) ledger"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token punctuation"},"("),s("test_validator"),n("span",{class:"token punctuation"},","),s(" main_payer"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"clean_ledger_setup_validator"),n("span",{class:"token punctuation"},"("),s("inv_feat"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Get the RpcClient"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" connection "),n("span",{class:"token operator"},"="),s(" test_validator"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get_rpc_client"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Capture our programs log statements"),s(`
    `),n("span",{class:"token namespace"},[s("solana_logger"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"setup_with_default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"solana_runtime::message=debug"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// This example doesn't require sending any accounts to program"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" accounts "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Build instruction array and submit transaction"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" txn "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"submit_transaction"),n("span",{class:"token punctuation"},"("),s(`
        `),n("span",{class:"token operator"},"&"),s("connection"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token operator"},"&"),s("main_payer"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"["),s(`
            `),n("span",{class:"token comment"},"// This instruction adds CU to transaction budget (1.9.2) but does nothing"),s(`
            `),n("span",{class:"token comment"},"// when we deactivate the 'transaction wide compute cap' feature"),s(`
            `),n("span",{class:"token class-name"},"ComputeBudgetInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"request_units"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"400_000u32"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token comment"},"// Add two (2) instructions to transaction"),s(`
            `),n("span",{class:"token comment"},"// Replace with instructions that make sense for your program"),s(`
            `),n("span",{class:"token comment"},"// You will see that each instruction has the 1.8.x 200_000 CU per budget"),s(`
            `),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new_with_borsh"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token number"},"0u8"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new_with_borsh"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token number"},"1u8"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"]"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token macro property"},"assert!"),n("span",{class:"token punctuation"},"("),s("txn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"is_ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br")])],-1),x=n("p",null,[s("Alternativement, le "),n("a",{href:"#resources"},"gadget du moteur scfs (scfs engine gadget)"),s(" peut produire un vecteur complet de fonctionnalit\xE9s d\xE9sactiv\xE9es pour un cluster. L'exemple suivant d\xE9montre l'utilisation de ce moteur pour obtenir une liste de toutes les fonctionnalit\xE9s d\xE9sactiv\xE9es sur le devnet.")],-1),P=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token attribute attr-name"},"#[test]"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"test_devnet_parity_pass"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// Use gadget-scfs to get all deactivated features from devnet"),s(`
    `),n("span",{class:"token comment"},'// must have `gadgets-scfs = "0.2.0" in Cargo.toml to use'),s(`
    `),n("span",{class:"token comment"},"// Here we setup for a run that samples features only"),s(`
    `),n("span",{class:"token comment"},"// from devnet"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" my_matrix "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ScfsMatrix"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Some"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ScfsCriteria"),s(),n("span",{class:"token punctuation"},"{"),s(`
        clusters`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"Some"),n("span",{class:"token punctuation"},"("),n("span",{class:"token macro property"},"vec!"),n("span",{class:"token punctuation"},"["),n("span",{class:"token constant"},"SCFS_DEVNET"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_string"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},".."),n("span",{class:"token class-name"},"Default"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Run the sampler matrix"),s(`
    `),n("span",{class:"token macro property"},"assert!"),n("span",{class:"token punctuation"},"("),s("my_matrix"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"is_ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Get all deactivated features"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" deactivated "),n("span",{class:"token operator"},"="),s(` my_matrix
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get_features"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Some"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"ScfsMatrix"),n("span",{class:"token punctuation"},"::"),s("any_inactive"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Confirm we have them"),s(`
    `),n("span",{class:"token macro property"},"assert_ne!"),n("span",{class:"token punctuation"},"("),s("deactivated"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"len"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Setup test validator and logging while deactivating all"),s(`
    `),n("span",{class:"token comment"},"// features that are deactivated in devnet"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token punctuation"},"("),s("test_validator"),n("span",{class:"token punctuation"},","),s(" main_payer"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"clean_ledger_setup_validator"),n("span",{class:"token punctuation"},"("),s("deactivated"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" connection "),n("span",{class:"token operator"},"="),s(" test_validator"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get_rpc_client"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token namespace"},[s("solana_logger"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"setup_with_default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"solana_runtime::message=debug"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"let"),s(" accounts "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" txn "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"submit_transaction"),n("span",{class:"token punctuation"},"("),s(`
        `),n("span",{class:"token operator"},"&"),s("connection"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token operator"},"&"),s("main_payer"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"["),s(`
            `),n("span",{class:"token comment"},"// Add two (2) instructions to transaction"),s(`
            `),n("span",{class:"token comment"},"// Replace with instructions that make sense for your program"),s(`
            `),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new_with_borsh"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token number"},"0u8"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"Instruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new_with_borsh"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"PROG_KEY"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token number"},"1u8"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"]"),s(`
        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"to_vec"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token macro property"},"assert!"),n("span",{class:"token punctuation"},"("),s("txn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"is_ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br")])],-1),B=n("p",null,"Bon test !",-1),G=n("h2",{id:"ressources",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ressources","aria-hidden":"true"},"#"),s(" Ressources")],-1),E={href:"https://github.com/FrankC01/solana-gadgets/tree/main/rust/scfsd",target:"_blank",rel:"noopener noreferrer"},R=s("scfsd"),S={href:"https://github.com/FrankC01/solana-gadgets/tree/main/rust/gadgets-scfs",target:"_blank",rel:"noopener noreferrer"},L=s("gadget-scfs");function T(C,D){const p=e("SolanaCodeGroupItem"),u=e("SolanaCodeGroup"),o=e("CodeGroupItem"),c=e("CodeGroup"),l=e("ExternalLinkIcon");return i(),k(m,null,[_,a(u,null,{default:t(()=>[a(p,{title:"Test Boiler Plate",active:""},{default:t(()=>[g]),preview:t(()=>[v]),_:1})]),_:1}),h,a(c,null,{default:t(()=>[a(o,{title:"All Features Test"},{default:t(()=>[y]),_:1}),a(o,{title:"Disable Tx CU Test",active:""},{default:t(()=>[w]),_:1})]),_:1}),x,a(c,null,{default:t(()=>[a(o,{title:"Devnet Parity"},{default:t(()=>[P]),_:1})]),_:1}),B,G,n("p",null,[n("a",E,[R,a(l)])]),n("p",null,[n("a",S,[L,a(l)])])],64)}var q=r(f,[["render",T]]);export{q as default};
