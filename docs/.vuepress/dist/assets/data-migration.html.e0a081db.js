import{_ as i,r as e,o as k,c as m,b as t,w as a,a as n,F as b,e as p,d as s}from"./app.07ce7a66.js";var d="/assets/pav1.1b0417ca.png",_="/assets/pav2.1ef612b4.png";const f={},y=p('<h1 id="migracion-de-cuentas-de-datos-de-programas" tabindex="-1"><a class="header-anchor" href="#migracion-de-cuentas-de-datos-de-programas" aria-hidden="true">#</a> Migraci\xF3n de cuentas de datos de programas</h1><h2 id="\xBFcomo-se-pueden-migrar-las-cuentas-de-datos-de-un-programa" tabindex="-1"><a class="header-anchor" href="#\xBFcomo-se-pueden-migrar-las-cuentas-de-datos-de-un-programa" aria-hidden="true">#</a> \xBFC\xF3mo se pueden migrar las cuentas de datos de un programa?</h2><p>Cuando crea un programa, cada cuenta de datos asociada con ese programa tendr\xE1 una estructura de datos espec\xEDfica. Si alguna vez necesitas actualizar una cuenta derivada del programa, puedes terminar teniendo un mont\xF3n de inconsistencias de cuentas derivadas del programa con la estructura anterior.</p><p>Con el control de versiones de la cuenta, puede actualizar sus cuentas antiguas a la nueva estructura.</p><div class="custom-container tip"><p class="custom-container-title">Nota</p><p>Esta es solo una de las muchas formas de migrar datos en Cuentas de propiedad del programa (POA).</p></div><h2 id="escenario" tabindex="-1"><a class="header-anchor" href="#escenario" aria-hidden="true">#</a> Escenario</h2><p>Para versionar y migrar los datos de nuestra cuenta, proporcionaremos un <strong>id</strong> para cada cuenta. Este identificador nos permitir\xE1 identificar la versi\xF3n de la cuenta cuando se lo pasamos al programa, y \u200B\u200Bas\xED manejar correctamente la cuenta.</p><p>Tomemos como ejemplo el siguiente estado de cuenta y programa:</p><img src="'+d+'" alt="Program Account v1">',9),w=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token comment"},"//! @brief account_state manages account data"),s(`

`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("arrayref"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s("array_ref"),n("span",{class:"token punctuation"},","),s(" array_refs"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("borsh"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"BorshDeserialize"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"BorshSerialize"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("solana_program"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s(`
    msg`),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("program_error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("program_pack"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"IsInitialized"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Pack"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Sealed"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"BufWriter"),n("span",{class:"token punctuation"},","),s(" mem"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Currently using state. If version changes occur, this"),s(`
`),n("span",{class:"token comment"},"/// should be copied to another serializable backlevel one"),s(`
`),n("span",{class:"token comment"},"/// before adding new fields here"),s(`
`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"AccountContentCurrent"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(" somevalue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Maintains account data"),s(`
`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    is_initialized`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"bool"),n("span",{class:"token punctuation"},","),s(`
    data_version`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},","),s(`
    account_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"/// Signal initialized"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"set_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s("is_initialized "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"/// Get the initialized flag"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token keyword"},"bool"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`is_initialized
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"/// Gets the current data version"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"version"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token keyword"},"u8"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`data_version
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"/// Get the reference to content structure"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"content"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"AccountContentCurrent"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`account_data
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"/// Get the mutable reference to content structure"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`account_data
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Declaration of the current data version."),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"DATA_VERSION"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u8"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Account allocated size"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"ACCOUNT_ALLOCATION_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1024"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Initialized flag is 1st byte of data block"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"IS_INITIALIZED"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Data version (current) is 2nd byte of data block"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"DATA_VERSION_ID"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Previous content data size (before changing this is equal to current)"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"PREVIOUS_VERSION_DATA_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token namespace"},[s("mem"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"size_of"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Total space occupied by previous account data"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"PREVIOUS_ACCOUNT_SPACE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(`
    `),n("span",{class:"token constant"},"IS_INITIALIZED"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"DATA_VERSION_ID"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"PREVIOUS_VERSION_DATA_SIZE"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Current content data size"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"CURRENT_VERSION_DATA_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token namespace"},[s("mem"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"size_of"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Total usage for data only"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"CURRENT_USED_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"IS_INITIALIZED"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"DATA_VERSION_ID"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"CURRENT_VERSION_DATA_SIZE"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// How much of 1024 is used"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"CURRENT_UNUSED_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"ACCOUNT_ALLOCATION_SIZE"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token constant"},"CURRENT_USED_SIZE"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Current space used by header (initialized, data version and Content)"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"ACCOUNT_STATE_SPACE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"CURRENT_USED_SIZE"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"CURRENT_UNUSED_SIZE"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Future data migration logic that converts prior state of data"),s(`
`),n("span",{class:"token comment"},"/// to current state of data"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"conversion_logic"),n("span",{class:"token punctuation"},"("),s("src"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" past "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token macro property"},"array_ref!"),n("span",{class:"token punctuation"},"["),s("src"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"PREVIOUS_ACCOUNT_SPACE"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token punctuation"},"("),s("initialized"),n("span",{class:"token punctuation"},","),s(" _"),n("span",{class:"token punctuation"},","),s(" _account_space"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token macro property"},"array_refs!"),n("span",{class:"token punctuation"},"["),s(`
        past`),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token constant"},"IS_INITIALIZED"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token constant"},"DATA_VERSION_ID"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token constant"},"PREVIOUS_VERSION_DATA_SIZE"),s(`
    `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Logic to uplift from previous version"),s(`
    `),n("span",{class:"token comment"},"// GOES HERE"),s(`

    `),n("span",{class:"token comment"},"// Give back"),s(`
    `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
        is_initialized`),n("span",{class:"token punctuation"},":"),s(" initialized"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token number"},"0u8"),n("span",{class:"token punctuation"},","),s(`
        data_version`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token constant"},"DATA_VERSION"),n("span",{class:"token punctuation"},","),s(`
        account_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"Sealed"),s(),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"IsInitialized"),s(),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"is_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token keyword"},"bool"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`is_initialized
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"Pack"),s(),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"LEN"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"ACCOUNT_STATE_SPACE"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"/// Store 'state' of account to its data area"),s(`
    `),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"pack_into_slice"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},","),s(" dst"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" bw "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"BufWriter"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new"),n("span",{class:"token punctuation"},"("),s("dst"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"serialize"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" bw"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token comment"},"/// Retrieve 'state' of account from account data area"),s(`
    `),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"unpack_from_slice"),n("span",{class:"token punctuation"},"("),s("src"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"Self"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"let"),s(" initialized "),n("span",{class:"token operator"},"="),s(" src"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// Check initialized"),s(`
        `),n("span",{class:"token keyword"},"if"),s(" initialized "),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token comment"},"// Version check"),s(`
            `),n("span",{class:"token keyword"},"if"),s(" src"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"DATA_VERSION"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Processing consistent data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s(`
                    `),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"try_from_slice"),n("span",{class:"token punctuation"},"("),n("span",{class:"token macro property"},"array_ref!"),n("span",{class:"token punctuation"},"["),s("src"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"CURRENT_USED_SIZE"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
                        `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
                `),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Processing backlevel data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                `),n("span",{class:"token function"},"conversion_logic"),n("span",{class:"token punctuation"},"("),s("src"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Processing pre-initialized data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
                is_initialized`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                data_version`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token constant"},"DATA_VERSION"),n("span",{class:"token punctuation"},","),s(`
                account_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br"),n("span",{class:"line-number"},"58"),n("br"),n("span",{class:"line-number"},"59"),n("br"),n("span",{class:"line-number"},"60"),n("br"),n("span",{class:"line-number"},"61"),n("br"),n("span",{class:"line-number"},"62"),n("br"),n("span",{class:"line-number"},"63"),n("br"),n("span",{class:"line-number"},"64"),n("br"),n("span",{class:"line-number"},"65"),n("br"),n("span",{class:"line-number"},"66"),n("br"),n("span",{class:"line-number"},"67"),n("br"),n("span",{class:"line-number"},"68"),n("br"),n("span",{class:"line-number"},"69"),n("br"),n("span",{class:"line-number"},"70"),n("br"),n("span",{class:"line-number"},"71"),n("br"),n("span",{class:"line-number"},"72"),n("br"),n("span",{class:"line-number"},"73"),n("br"),n("span",{class:"line-number"},"74"),n("br"),n("span",{class:"line-number"},"75"),n("br"),n("span",{class:"line-number"},"76"),n("br"),n("span",{class:"line-number"},"77"),n("br"),n("span",{class:"line-number"},"78"),n("br"),n("span",{class:"line-number"},"79"),n("br"),n("span",{class:"line-number"},"80"),n("br"),n("span",{class:"line-number"},"81"),n("br"),n("span",{class:"line-number"},"82"),n("br"),n("span",{class:"line-number"},"83"),n("br"),n("span",{class:"line-number"},"84"),n("br"),n("span",{class:"line-number"},"85"),n("br"),n("span",{class:"line-number"},"86"),n("br"),n("span",{class:"line-number"},"87"),n("br"),n("span",{class:"line-number"},"88"),n("br"),n("span",{class:"line-number"},"89"),n("br"),n("span",{class:"line-number"},"90"),n("br"),n("span",{class:"line-number"},"91"),n("br"),n("span",{class:"line-number"},"92"),n("br"),n("span",{class:"line-number"},"93"),n("br"),n("span",{class:"line-number"},"94"),n("br"),n("span",{class:"line-number"},"95"),n("br"),n("span",{class:"line-number"},"96"),n("br"),n("span",{class:"line-number"},"97"),n("br"),n("span",{class:"line-number"},"98"),n("br"),n("span",{class:"line-number"},"99"),n("br"),n("span",{class:"line-number"},"100"),n("br"),n("span",{class:"line-number"},"101"),n("br"),n("span",{class:"line-number"},"102"),n("br"),n("span",{class:"line-number"},"103"),n("br"),n("span",{class:"line-number"},"104"),n("br"),n("span",{class:"line-number"},"105"),n("br"),n("span",{class:"line-number"},"106"),n("br"),n("span",{class:"line-number"},"107"),n("br"),n("span",{class:"line-number"},"108"),n("br"),n("span",{class:"line-number"},"109"),n("br"),n("span",{class:"line-number"},"110"),n("br"),n("span",{class:"line-number"},"111"),n("br"),n("span",{class:"line-number"},"112"),n("br"),n("span",{class:"line-number"},"113"),n("br"),n("span",{class:"line-number"},"114"),n("br"),n("span",{class:"line-number"},"115"),n("br"),n("span",{class:"line-number"},"116"),n("br"),n("span",{class:"line-number"},"117"),n("br"),n("span",{class:"line-number"},"118"),n("br"),n("span",{class:"line-number"},"119"),n("br"),n("span",{class:"line-number"},"120"),n("br"),n("span",{class:"line-number"},"121"),n("br"),n("span",{class:"line-number"},"122"),n("br"),n("span",{class:"line-number"},"123"),n("br"),n("span",{class:"line-number"},"124"),n("br"),n("span",{class:"line-number"},"125"),n("br"),n("span",{class:"line-number"},"126"),n("br"),n("span",{class:"line-number"},"127"),n("br"),n("span",{class:"line-number"},"128"),n("br"),n("span",{class:"line-number"},"129"),n("br"),n("span",{class:"line-number"},"130"),n("br"),n("span",{class:"line-number"},"131"),n("br"),n("span",{class:"line-number"},"132"),n("br"),n("span",{class:"line-number"},"133"),n("br"),n("span",{class:"line-number"},"134"),n("br"),n("span",{class:"line-number"},"135"),n("br"),n("span",{class:"line-number"},"136"),n("br"),n("span",{class:"line-number"},"137"),n("br")])],-1),g=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"AccountContentCurrent"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(" somevalue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    is_initialized`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"bool"),n("span",{class:"token punctuation"},","),s(`
    data_version`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},","),s(`
    account_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br")])],-1),h=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token comment"},"//! instruction Contains the main ProgramInstruction enum"),s(`

`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"crate"),n("span",{class:"token module-declaration namespace"},[n("span",{class:"token punctuation"},"::"),s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("borsh"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"BorshDeserialize"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"BorshSerialize"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("solana_program"),n("span",{class:"token punctuation"},"::"),s("program_error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, PartialEq)]"),s(`
`),n("span",{class:"token comment"},"/// All custom program instructions"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"enum"),s(),n("span",{class:"token type-definition class-name"},"ProgramInstruction"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token class-name"},"InitializeAccount"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token class-name"},"SetU64Value"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token class-name"},"FailInstruction"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"ProgramInstruction"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"/// Unpack inbound buffer to associated Instruction"),s(`
    `),n("span",{class:"token comment"},"/// The expected format for input is a Borsh serialized vector"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"unpack"),n("span",{class:"token punctuation"},"("),s("input"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"Self"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"let"),s(" payload "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"try_from_slice"),n("span",{class:"token punctuation"},"("),s("input"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"match"),s(" payload "),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InitializeAccount"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("payload"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"SetU64Value"),n("span",{class:"token punctuation"},"("),s("_"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("payload"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            _ `),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InvalidInstruction"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br")])],-1),I=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"ProgramInstruction"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"/// Unpack inbound buffer to associated Instruction"),s(`
    `),n("span",{class:"token comment"},"/// The expected format for input is a Borsh serialized vector"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"unpack"),n("span",{class:"token punctuation"},"("),s("input"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"Self"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"let"),s(" payload "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"try_from_slice"),n("span",{class:"token punctuation"},"("),s("input"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"match"),s(" payload "),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InitializeAccount"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("payload"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"SetU64Value"),n("span",{class:"token punctuation"},"("),s("_"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("payload"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            _ `),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InvalidInstruction"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br")])],-1),A=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token comment"},"//! Resolve instruction and execute"),s(`

`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token keyword"},"crate"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token namespace"},[s("account_state"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token namespace"},[s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token namespace"},[s("instruction"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("solana_program"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token namespace"},[s("account_info"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s("next_account_info"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("entrypoint"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramResult"),n("span",{class:"token punctuation"},","),s(`
    msg`),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("program_error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("program_pack"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"IsInitialized"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Pack"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("pubkey"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Checks each tracking account to confirm it is owned by our program"),s(`
`),n("span",{class:"token comment"},"/// This function assumes that the program account is always the last"),s(`
`),n("span",{class:"token comment"},"/// in the array"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"check_account_ownership"),n("span",{class:"token punctuation"},"("),s("program_id"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// Accounts must be owned by the program."),s(`
    `),n("span",{class:"token keyword"},"for"),s(" account "),n("span",{class:"token keyword"},"in"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"take"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"len"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(" account"),n("span",{class:"token punctuation"},"."),s("owner "),n("span",{class:"token operator"},"!="),s(" program_id "),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),s(`
                `),n("span",{class:"token string"},'"Fail: The tracking account owner is {} and it should be {}."'),n("span",{class:"token punctuation"},","),s(`
                account`),n("span",{class:"token punctuation"},"."),s("owner"),n("span",{class:"token punctuation"},","),s(`
                program_id
            `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"IncorrectProgramId"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Initialize the programs account, which is the first in accounts"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"initialize_account"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Initialize account"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" account_info_iter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" program_account "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"next_account_info"),n("span",{class:"token punctuation"},"("),s("account_info_iter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_data "),n("span",{class:"token operator"},"="),s(" program_account"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"borrow_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Just using unpack will check to see if initialized and will"),s(`
    `),n("span",{class:"token comment"},"// fail if not"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_state "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack_unchecked"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("account_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Where this is a logic error in trying to initialize the same account more than once"),s(`
    `),n("span",{class:"token keyword"},"if"),s(" account_state"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"is_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"AlreadyInitializedState"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("somevalue "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Account Initialized"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Serialize"),s(`
    `),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"pack"),n("span",{class:"token punctuation"},"("),s("account_state"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" account_data"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Sets the u64 in the content structure"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"set_u64_value"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Set new value {}"'),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" account_info_iter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" program_account "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"next_account_info"),n("span",{class:"token punctuation"},"("),s("account_info_iter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_data "),n("span",{class:"token operator"},"="),s(" program_account"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"borrow_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_state "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("account_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("somevalue "),n("span",{class:"token operator"},"="),s(" value"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Serialize"),s(`
    `),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"pack"),n("span",{class:"token punctuation"},"("),s("account_state"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" account_data"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token comment"},"/// Main processing entry point dispatches to specific"),s(`
`),n("span",{class:"token comment"},"/// instruction handlers"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"process"),n("span",{class:"token punctuation"},"("),s(`
    program_id`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},","),s(`
    accounts`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
    instruction_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Received process request"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Check the account for program relationship"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"check_account_ownership"),n("span",{class:"token punctuation"},"("),s("program_id"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Unpack the inbound data, mapping instruction to appropriate structure"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" instruction "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack"),n("span",{class:"token punctuation"},"("),s("instruction_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"match"),s(" instruction "),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InitializeAccount"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"initialize_account"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"SetU64Value"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"set_u64_value"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        _ `),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Received unknown instruction"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InvalidInstruction"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br"),n("span",{class:"line-number"},"58"),n("br"),n("span",{class:"line-number"},"59"),n("br"),n("span",{class:"line-number"},"60"),n("br"),n("span",{class:"line-number"},"61"),n("br"),n("span",{class:"line-number"},"62"),n("br"),n("span",{class:"line-number"},"63"),n("br"),n("span",{class:"line-number"},"64"),n("br"),n("span",{class:"line-number"},"65"),n("br"),n("span",{class:"line-number"},"66"),n("br"),n("span",{class:"line-number"},"67"),n("br"),n("span",{class:"line-number"},"68"),n("br"),n("span",{class:"line-number"},"69"),n("br"),n("span",{class:"line-number"},"70"),n("br"),n("span",{class:"line-number"},"71"),n("br"),n("span",{class:"line-number"},"72"),n("br"),n("span",{class:"line-number"},"73"),n("br"),n("span",{class:"line-number"},"74"),n("br"),n("span",{class:"line-number"},"75"),n("br"),n("span",{class:"line-number"},"76"),n("br"),n("span",{class:"line-number"},"77"),n("br"),n("span",{class:"line-number"},"78"),n("br"),n("span",{class:"line-number"},"79"),n("br"),n("span",{class:"line-number"},"80"),n("br"),n("span",{class:"line-number"},"81"),n("br"),n("span",{class:"line-number"},"82"),n("br"),n("span",{class:"line-number"},"83"),n("br"),n("span",{class:"line-number"},"84"),n("br"),n("span",{class:"line-number"},"85"),n("br"),n("span",{class:"line-number"},"86"),n("br"),n("span",{class:"line-number"},"87"),n("br")])],-1),S=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"check_account_ownership"),n("span",{class:"token punctuation"},"("),s("program_id"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// Accounts must be owned by the program."),s(`
    `),n("span",{class:"token keyword"},"for"),s(" account "),n("span",{class:"token keyword"},"in"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"take"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"len"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(" account"),n("span",{class:"token punctuation"},"."),s("owner "),n("span",{class:"token operator"},"!="),s(" program_id "),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),s(`
                `),n("span",{class:"token string"},'"Fail: The tracking account owner is {} and it should be {}."'),n("span",{class:"token punctuation"},","),s(`
                account`),n("span",{class:"token punctuation"},"."),s("owner"),n("span",{class:"token punctuation"},","),s(`
                program_id
            `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"IncorrectProgramId"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Initialize the programs account, which is the first in accounts"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"initialize_account"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Initialize account"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" account_info_iter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" program_account "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"next_account_info"),n("span",{class:"token punctuation"},"("),s("account_info_iter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_data "),n("span",{class:"token operator"},"="),s(" program_account"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"borrow_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Just using unpack will check to see if initialized and will"),s(`
    `),n("span",{class:"token comment"},"// fail if not"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_state "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack_unchecked"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("account_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Where this is a logic error in trying to initialize the same account more than once"),s(`
    `),n("span",{class:"token keyword"},"if"),s(" account_state"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"is_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"AlreadyInitializedState"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("somevalue "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Account Initialized"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Serialize"),s(`
    `),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"pack"),n("span",{class:"token punctuation"},"("),s("account_state"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" account_data"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Sets the u64 in the content structure"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"set_u64_value"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Set new value {}"'),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" account_info_iter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" program_account "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"next_account_info"),n("span",{class:"token punctuation"},"("),s("account_info_iter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_data "),n("span",{class:"token operator"},"="),s(" program_account"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"borrow_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_state "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("account_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("somevalue "),n("span",{class:"token operator"},"="),s(" value"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Serialize"),s(`
    `),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"pack"),n("span",{class:"token punctuation"},"("),s("account_state"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" account_data"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token comment"},"/// Main processing entry point dispatches to specific"),s(`
`),n("span",{class:"token comment"},"/// instruction handlers"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"process"),n("span",{class:"token punctuation"},"("),s(`
    program_id`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},","),s(`
    accounts`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
    instruction_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Received process request"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Check the account for program relationship"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"check_account_ownership"),n("span",{class:"token punctuation"},"("),s("program_id"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Unpack the inbound data, mapping instruction to appropriate structure"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" instruction "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack"),n("span",{class:"token punctuation"},"("),s("instruction_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"match"),s(" instruction "),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InitializeAccount"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"initialize_account"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token class-name"},"ProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"SetU64Value"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"set_u64_value"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        _ `),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Received unknown instruction"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InvalidInstruction"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br"),n("span",{class:"line-number"},"58"),n("br"),n("span",{class:"line-number"},"59"),n("br"),n("span",{class:"line-number"},"60"),n("br"),n("span",{class:"line-number"},"61"),n("br"),n("span",{class:"line-number"},"62"),n("br"),n("span",{class:"line-number"},"63"),n("br"),n("span",{class:"line-number"},"64"),n("br"),n("span",{class:"line-number"},"65"),n("br"),n("span",{class:"line-number"},"66"),n("br"),n("span",{class:"line-number"},"67"),n("br"),n("span",{class:"line-number"},"68"),n("br"),n("span",{class:"line-number"},"69"),n("br"),n("span",{class:"line-number"},"70"),n("br")])],-1),E=p('<p>En nuestra primera versi\xF3n de una cuenta, estamos haciendo lo siguiente:</p><table><thead><tr><th>ID</th><th>Action</th></tr></thead><tbody><tr><td>1</td><td>Incluir un campo de &#39;versi\xF3n de datos&#39; en los datos. Puede ser un ordinal incremental simple (por ejemplo, u8) o algo m\xE1s sofisticado</td></tr><tr><td>2</td><td>Asignar suficiente espacio para el crecimiento de datos</td></tr><tr><td>3</td><td>Inicializar una cantidad de constantes para usar en todas las versiones del programa</td></tr><tr><td>4</td><td>Agregar una funci\xF3n <code>fn conversion_logic</code> para las futuras actualizaciones de cuenta</td></tr></tbody></table><p>Digamos que queremos actualizar las cuentas de nuestro programa para incluir un nuevo campo obligatorio, el campo <code>somestring</code>.</p><p>Si no asign\xE1ramos espacio adicional en la cuenta anterior, podr\xEDamos no actualizar la cuenta y quedar\xEDa atascada.</p><h2 id="actualizando-la-cuenta" tabindex="-1"><a class="header-anchor" href="#actualizando-la-cuenta" aria-hidden="true">#</a> Actualizando la cuenta</h2><p>En nuestro nuevo programa queremos agregar una nueva propiedad para el contenido del estado. Los cambios a continuaci\xF3n muestran c\xF3mo aprovechamos la estructura inicial del programa para agregar el nuevo campo.</p><h3 id="_1-agregar-la-logica-de-conversion-de-cuenta" tabindex="-1"><a class="header-anchor" href="#_1-agregar-la-logica-de-conversion-de-cuenta" aria-hidden="true">#</a> 1. Agregar la l\xF3gica de conversi\xF3n de cuenta</h3>',7),v=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token comment"},"//! @brief account_state manages account data"),s(`

`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("arrayref"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s("array_ref"),n("span",{class:"token punctuation"},","),s(" array_refs"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("borsh"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"BorshDeserialize"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"BorshSerialize"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("solana_program"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token namespace"},[s("borsh"),n("span",{class:"token punctuation"},"::")]),s("try_from_slice_unchecked"),n("span",{class:"token punctuation"},","),s(`
    msg`),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("program_error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("program_pack"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"IsInitialized"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Pack"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Sealed"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("std"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"BufWriter"),n("span",{class:"token punctuation"},","),s(" mem"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Current state (DATA_VERSION 1). If version changes occur, this"),s(`
`),n("span",{class:"token comment"},"/// should be copied to another (see AccountContentOld below)"),s(`
`),n("span",{class:"token comment"},"/// We've added a new field: 'somestring'"),s(`
`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"AccountContentCurrent"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(" somevalue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token keyword"},"pub"),s(" somestring"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Old content state (DATA_VERSION 0)."),s(`
`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"AccountContentOld"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(" somevalue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Maintains account data"),s(`
`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    is_initialized`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"bool"),n("span",{class:"token punctuation"},","),s(`
    data_version`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},","),s(`
    account_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"/// Signal initialized"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"set_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s("is_initialized "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"/// Get the initialized flag"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token keyword"},"bool"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`is_initialized
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"/// Gets the current data version"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"version"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token keyword"},"u8"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`data_version
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"/// Get the reference to content structure"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"content"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"AccountContentCurrent"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`account_data
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token comment"},"/// Get the mutable reference to content structure"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`account_data
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Declaration of the current data version."),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"DATA_VERSION"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u8"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// Adding string to content"),s(`
                            `),n("span",{class:"token comment"},"// Previous const DATA_VERSION: u8 = 0;"),s(`

`),n("span",{class:"token comment"},"/// Account allocated size"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"ACCOUNT_ALLOCATION_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1024"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Initialized flag is 1st byte of data block"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"IS_INITIALIZED"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Data version (current) is 2nd byte of data block"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"DATA_VERSION_ID"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Previous content data size (before changing this is equal to current)"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"PREVIOUS_VERSION_DATA_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token namespace"},[s("mem"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"size_of"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"AccountContentOld"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Total space occupied by previous account data"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"PREVIOUS_ACCOUNT_SPACE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"IS_INITIALIZED"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"DATA_VERSION_ID"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"PREVIOUS_VERSION_DATA_SIZE"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Current content data size"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"CURRENT_VERSION_DATA_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token namespace"},[s("mem"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token function"},"size_of"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Total usage for data only"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"CURRENT_USED_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"IS_INITIALIZED"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"DATA_VERSION_ID"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"CURRENT_VERSION_DATA_SIZE"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// How much of 1024 is used"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"CURRENT_UNUSED_SIZE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"ACCOUNT_ALLOCATION_SIZE"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token constant"},"CURRENT_USED_SIZE"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"/// Current space used by header (initialized, data version and Content)"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"ACCOUNT_STATE_SPACE"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"CURRENT_USED_SIZE"),s(),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token constant"},"CURRENT_UNUSED_SIZE"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Future data migration logic that converts prior state of data"),s(`
`),n("span",{class:"token comment"},"/// to current state of data"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"conversion_logic"),n("span",{class:"token punctuation"},"("),s("src"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" past "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token macro property"},"array_ref!"),n("span",{class:"token punctuation"},"["),s("src"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"PREVIOUS_ACCOUNT_SPACE"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token punctuation"},"("),s("initialized"),n("span",{class:"token punctuation"},","),s(" _"),n("span",{class:"token punctuation"},","),s(" account_space"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token macro property"},"array_refs!"),n("span",{class:"token punctuation"},"["),s(`
        past`),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token constant"},"IS_INITIALIZED"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token constant"},"DATA_VERSION_ID"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token constant"},"PREVIOUS_VERSION_DATA_SIZE"),s(`
    `),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Logic to upgrade from previous version"),s(`
    `),n("span",{class:"token comment"},"// GOES HERE"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" old "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"try_from_slice_unchecked"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"AccountContentOld"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},"("),s("account_space"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},`// Default sets 'somevalue' to 0 and somestring to default ""`),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" new_content "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// We copy the existing 'somevalue', the program instructions will read/update 'somestring' without fail"),s(`
    new_content`),n("span",{class:"token punctuation"},"."),s("somevalue "),n("span",{class:"token operator"},"="),s(" old"),n("span",{class:"token punctuation"},"."),s("somevalue"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// Give back"),s(`
    `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
        is_initialized`),n("span",{class:"token punctuation"},":"),s(" initialized"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token number"},"0u8"),n("span",{class:"token punctuation"},","),s(`
        data_version`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token constant"},"DATA_VERSION"),n("span",{class:"token punctuation"},","),s(`
        account_data`),n("span",{class:"token punctuation"},":"),s(" new_content"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"Sealed"),s(),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"IsInitialized"),s(),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"is_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token keyword"},"bool"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),s(`is_initialized
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"Pack"),s(),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"LEN"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"usize"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"ACCOUNT_STATE_SPACE"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"/// Store 'state' of account to its data area"),s(`
    `),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"pack_into_slice"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},","),s(" dst"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" bw "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"BufWriter"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"new"),n("span",{class:"token punctuation"},"("),s("dst"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"self"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"serialize"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" bw"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token comment"},"/// Retrieve 'state' of account from account data area"),s(`
    `),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"unpack_from_slice"),n("span",{class:"token punctuation"},"("),s("src"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"Self"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"let"),s(" initialized "),n("span",{class:"token operator"},"="),s(" src"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// Check initialized"),s(`
        `),n("span",{class:"token keyword"},"if"),s(" initialized "),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token comment"},"// Version check"),s(`
            `),n("span",{class:"token keyword"},"if"),s(" src"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token constant"},"DATA_VERSION"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Processing consistent version data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"try_from_slice_unchecked"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},"("),s("src"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Processing backlevel data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                `),n("span",{class:"token function"},"conversion_logic"),n("span",{class:"token punctuation"},"("),s("src"),n("span",{class:"token punctuation"},")"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Processing pre-initialized data"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
                is_initialized`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                data_version`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token constant"},"DATA_VERSION"),n("span",{class:"token punctuation"},","),s(`
                account_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"default"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br"),n("span",{class:"line-number"},"58"),n("br"),n("span",{class:"line-number"},"59"),n("br"),n("span",{class:"line-number"},"60"),n("br"),n("span",{class:"line-number"},"61"),n("br"),n("span",{class:"line-number"},"62"),n("br"),n("span",{class:"line-number"},"63"),n("br"),n("span",{class:"line-number"},"64"),n("br"),n("span",{class:"line-number"},"65"),n("br"),n("span",{class:"line-number"},"66"),n("br"),n("span",{class:"line-number"},"67"),n("br"),n("span",{class:"line-number"},"68"),n("br"),n("span",{class:"line-number"},"69"),n("br"),n("span",{class:"line-number"},"70"),n("br"),n("span",{class:"line-number"},"71"),n("br"),n("span",{class:"line-number"},"72"),n("br"),n("span",{class:"line-number"},"73"),n("br"),n("span",{class:"line-number"},"74"),n("br"),n("span",{class:"line-number"},"75"),n("br"),n("span",{class:"line-number"},"76"),n("br"),n("span",{class:"line-number"},"77"),n("br"),n("span",{class:"line-number"},"78"),n("br"),n("span",{class:"line-number"},"79"),n("br"),n("span",{class:"line-number"},"80"),n("br"),n("span",{class:"line-number"},"81"),n("br"),n("span",{class:"line-number"},"82"),n("br"),n("span",{class:"line-number"},"83"),n("br"),n("span",{class:"line-number"},"84"),n("br"),n("span",{class:"line-number"},"85"),n("br"),n("span",{class:"line-number"},"86"),n("br"),n("span",{class:"line-number"},"87"),n("br"),n("span",{class:"line-number"},"88"),n("br"),n("span",{class:"line-number"},"89"),n("br"),n("span",{class:"line-number"},"90"),n("br"),n("span",{class:"line-number"},"91"),n("br"),n("span",{class:"line-number"},"92"),n("br"),n("span",{class:"line-number"},"93"),n("br"),n("span",{class:"line-number"},"94"),n("br"),n("span",{class:"line-number"},"95"),n("br"),n("span",{class:"line-number"},"96"),n("br"),n("span",{class:"line-number"},"97"),n("br"),n("span",{class:"line-number"},"98"),n("br"),n("span",{class:"line-number"},"99"),n("br"),n("span",{class:"line-number"},"100"),n("br"),n("span",{class:"line-number"},"101"),n("br"),n("span",{class:"line-number"},"102"),n("br"),n("span",{class:"line-number"},"103"),n("br"),n("span",{class:"line-number"},"104"),n("br"),n("span",{class:"line-number"},"105"),n("br"),n("span",{class:"line-number"},"106"),n("br"),n("span",{class:"line-number"},"107"),n("br"),n("span",{class:"line-number"},"108"),n("br"),n("span",{class:"line-number"},"109"),n("br"),n("span",{class:"line-number"},"110"),n("br"),n("span",{class:"line-number"},"111"),n("br"),n("span",{class:"line-number"},"112"),n("br"),n("span",{class:"line-number"},"113"),n("br"),n("span",{class:"line-number"},"114"),n("br"),n("span",{class:"line-number"},"115"),n("br"),n("span",{class:"line-number"},"116"),n("br"),n("span",{class:"line-number"},"117"),n("br"),n("span",{class:"line-number"},"118"),n("br"),n("span",{class:"line-number"},"119"),n("br"),n("span",{class:"line-number"},"120"),n("br"),n("span",{class:"line-number"},"121"),n("br"),n("span",{class:"line-number"},"122"),n("br"),n("span",{class:"line-number"},"123"),n("br"),n("span",{class:"line-number"},"124"),n("br"),n("span",{class:"line-number"},"125"),n("br"),n("span",{class:"line-number"},"126"),n("br"),n("span",{class:"line-number"},"127"),n("br"),n("span",{class:"line-number"},"128"),n("br"),n("span",{class:"line-number"},"129"),n("br"),n("span",{class:"line-number"},"130"),n("br"),n("span",{class:"line-number"},"131"),n("br"),n("span",{class:"line-number"},"132"),n("br"),n("span",{class:"line-number"},"133"),n("br"),n("span",{class:"line-number"},"134"),n("br"),n("span",{class:"line-number"},"135"),n("br"),n("span",{class:"line-number"},"136"),n("br"),n("span",{class:"line-number"},"137"),n("br"),n("span",{class:"line-number"},"138"),n("br"),n("span",{class:"line-number"},"139"),n("br"),n("span",{class:"line-number"},"140"),n("br"),n("span",{class:"line-number"},"141"),n("br"),n("span",{class:"line-number"},"142"),n("br"),n("span",{class:"line-number"},"143"),n("br"),n("span",{class:"line-number"},"144"),n("br"),n("span",{class:"line-number"},"145"),n("br"),n("span",{class:"line-number"},"146"),n("br"),n("span",{class:"line-number"},"147"),n("br"),n("span",{class:"line-number"},"148"),n("br")])],-1),z=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token comment"},"/// Current state (DATA_VERSION 1). If version changes occur, this"),s(`
`),n("span",{class:"token comment"},"/// should be copied to another (see AccountContentOld below)"),s(`
`),n("span",{class:"token comment"},"/// We've added a new field: 'somestring'"),s(`
`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"AccountContentCurrent"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(" somevalue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token keyword"},"pub"),s(" somestring"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Old content state (DATA_VERSION 0)."),s(`
`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"AccountContentOld"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(" somevalue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Maintains account data"),s(`
`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, Default, PartialEq)]"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"struct"),s(),n("span",{class:"token type-definition class-name"},"ProgramAccountState"),s(),n("span",{class:"token punctuation"},"{"),s(`
    is_initialized`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"bool"),n("span",{class:"token punctuation"},","),s(`
    data_version`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},","),s(`
    account_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"AccountContentCurrent"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br")])],-1),P=p("<table><thead><tr><th>Line(s)</th><th>Note</th></tr></thead><tbody><tr><td>6</td><td>Hemos agregado <code>solana_program::borsh::try_from_slice_unchecked</code> de Solana para simplificar la lectura de subconjuntos del bloque de datos m\xE1s grande</td></tr><tr><td>13-26</td><td>Aqu\xED hemos conservado la estructura de contenido anterior, <code>AccountContentOld</code> l\xEDnea 24, antes de extender <code>AccountContentCurrent</code> a partir de la l\xEDnea 17.</td></tr><tr><td>60</td><td>Actualizamos la constante <code>DATA_VERSION</code></td></tr><tr><td>71</td><td>Ahora tenemos una versi\xF3n &#39;anterior&#39; y queremos saber su tama\xF1o</td></tr><tr><td>86</td><td>El Coup de gr\xE2ce est\xE1 agregando la plomer\xEDa para actualizar el contenido del estado anterior al estado nuevo (actual)</td></tr></tbody></table><p>Luego actualizamos nuestras instrucciones, para agregar <code>somestring</code> y el procesador para manejar la nueva instrucci\xF3n. Tenga en cuenta que la &quot;actualizaci\xF3n&quot; de la estructura de datos est\xE1 encapsulada detr\xE1s de <code>pack/unpack</code>.</p>",2),C=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token comment"},"//! instruction Contains the main VersionProgramInstruction enum"),s(`

`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"crate"),n("span",{class:"token module-declaration namespace"},[n("span",{class:"token punctuation"},"::"),s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("borsh"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"BorshDeserialize"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"BorshSerialize"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("solana_program"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token namespace"},[s("borsh"),n("span",{class:"token punctuation"},"::")]),s("try_from_slice_unchecked"),n("span",{class:"token punctuation"},","),s(" msg"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token namespace"},[s("program_error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token attribute attr-name"},"#[derive(BorshDeserialize, BorshSerialize, Debug, PartialEq)]"),s(`
`),n("span",{class:"token comment"},"/// All custom program instructions"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"enum"),s(),n("span",{class:"token type-definition class-name"},"VersionProgramInstruction"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token class-name"},"InitializeAccount"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token class-name"},"SetU64Value"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token class-name"},"SetString"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// Added with data version change"),s(`
    `),n("span",{class:"token class-name"},"FailInstruction"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"impl"),s(),n("span",{class:"token class-name"},"VersionProgramInstruction"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"/// Unpack inbound buffer to associated Instruction"),s(`
    `),n("span",{class:"token comment"},"/// The expected format for input is a Borsh serialized vector"),s(`
    `),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"unpack"),n("span",{class:"token punctuation"},"("),s("input"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"Result"),n("span",{class:"token operator"},"<"),n("span",{class:"token keyword"},"Self"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"let"),s(" payload "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"try_from_slice_unchecked"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token operator"},"<"),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},"("),s("input"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unwrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// let payload = VersionProgramInstruction::try_from_slice(input).unwrap();"),s(`
        `),n("span",{class:"token keyword"},"match"),s(" payload "),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InitializeAccount"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("payload"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"SetU64Value"),n("span",{class:"token punctuation"},"("),s("_"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("payload"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"SetString"),n("span",{class:"token punctuation"},"("),s("_"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),s("payload"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// Added with data version change"),s(`
            _ `),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InvalidInstruction"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br")])],-1),D=n("div",{class:"language-rust ext-rs line-numbers-mode"},[n("pre",{class:"language-rust"},[n("code",null,[n("span",{class:"token comment"},"//! Resolve instruction and execute"),s(`

`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token keyword"},"crate"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token namespace"},[s("account_state"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token namespace"},[s("error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("instruction"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"use"),s(),n("span",{class:"token namespace"},[s("solana_program"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token namespace"},[s("account_info"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),s("next_account_info"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("entrypoint"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramResult"),n("span",{class:"token punctuation"},","),s(`
    msg`),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("program_error"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("program_pack"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token punctuation"},"{"),n("span",{class:"token class-name"},"IsInitialized"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Pack"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token namespace"},[s("pubkey"),n("span",{class:"token punctuation"},"::")]),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"/// Checks each tracking account to confirm it is owned by our program"),s(`
`),n("span",{class:"token comment"},"/// This function assumes that the program account is always the last"),s(`
`),n("span",{class:"token comment"},"/// in the array"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"check_account_ownership"),n("span",{class:"token punctuation"},"("),s("program_id"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// Accounts must be owned by the program."),s(`
    `),n("span",{class:"token keyword"},"for"),s(" account "),n("span",{class:"token keyword"},"in"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"take"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"len"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(" account"),n("span",{class:"token punctuation"},"."),s("owner "),n("span",{class:"token operator"},"!="),s(" program_id "),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),s(`
                `),n("span",{class:"token string"},'"Fail: The tracking account owner is {} and it should be {}."'),n("span",{class:"token punctuation"},","),s(`
                account`),n("span",{class:"token punctuation"},"."),s("owner"),n("span",{class:"token punctuation"},","),s(`
                program_id
            `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ProgramError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"IncorrectProgramId"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token class-name"},"Ok"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Initialize the programs account, which is the first in accounts"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"initialize_account"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Initialize account"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" account_info_iter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" program_account "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"next_account_info"),n("span",{class:"token punctuation"},"("),s("account_info_iter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_data "),n("span",{class:"token operator"},"="),s(" program_account"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"borrow_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Just using unpack will check to see if initialized and will"),s(`
    `),n("span",{class:"token comment"},"// fail if not"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_state "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack_unchecked"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("account_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Where this is a logic error in trying to initialize the same account more than once"),s(`
    `),n("span",{class:"token keyword"},"if"),s(" account_state"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"is_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"AlreadyInitializedState"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set_initialized"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("somevalue "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Account Initialized"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Serialize"),s(`
    `),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"pack"),n("span",{class:"token punctuation"},"("),s("account_state"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" account_data"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Sets the u64 in the content structure"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"set_u64_value"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"u64"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Set new value {}"'),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" account_info_iter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" program_account "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"next_account_info"),n("span",{class:"token punctuation"},"("),s("account_info_iter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_data "),n("span",{class:"token operator"},"="),s(" program_account"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"borrow_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_state "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("account_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("somevalue "),n("span",{class:"token operator"},"="),s(" value"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Serialize"),s(`
    `),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"pack"),n("span",{class:"token punctuation"},"("),s("account_state"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" account_data"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"/// Sets the string in the content structure"),s(`
`),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"set_string_value"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Set new string {}"'),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" account_info_iter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" accounts"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"iter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" program_account "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"next_account_info"),n("span",{class:"token punctuation"},"("),s("account_info_iter"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_data "),n("span",{class:"token operator"},"="),s(" program_account"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"borrow_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token keyword"},"mut"),s(" account_state "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack"),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"&"),s("account_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    account_state`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"content_mut"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),s("somestring "),n("span",{class:"token operator"},"="),s(" value"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Serialize"),s(`
    `),n("span",{class:"token class-name"},"ProgramAccountState"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"pack"),n("span",{class:"token punctuation"},"("),s("account_state"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token keyword"},"mut"),s(" account_data"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token comment"},"/// Main processing entry point dispatches to specific"),s(`
`),n("span",{class:"token comment"},"/// instruction handlers"),s(`
`),n("span",{class:"token keyword"},"pub"),s(),n("span",{class:"token keyword"},"fn"),s(),n("span",{class:"token function-definition function"},"process"),n("span",{class:"token punctuation"},"("),s(`
    program_id`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token class-name"},"Pubkey"),n("span",{class:"token punctuation"},","),s(`
    accounts`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token class-name"},"AccountInfo"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
    instruction_data`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token operator"},"&"),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"u8"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"->"),s(),n("span",{class:"token class-name"},"ProgramResult"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Received process request 0.2.0"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Check the account for program relationship"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token keyword"},"let"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"check_account_ownership"),n("span",{class:"token punctuation"},"("),s("program_id"),n("span",{class:"token punctuation"},","),s(" accounts"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// Unpack the inbound data, mapping instruction to appropriate structure"),s(`
    `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Attempting to unpack"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" instruction "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token function"},"unpack"),n("span",{class:"token punctuation"},"("),s("instruction_data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},"?"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"match"),s(" instruction "),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InitializeAccount"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"initialize_account"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"SetU64Value"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"set_u64_value"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token class-name"},"VersionProgramInstruction"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"SetString"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"set_string_value"),n("span",{class:"token punctuation"},"("),s("accounts"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
        _ `),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token macro property"},"msg!"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Received unknown instruction"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token class-name"},"Err"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"DataVersionError"),n("span",{class:"token punctuation"},"::"),n("span",{class:"token class-name"},"InvalidInstruction"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"into"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("span",{class:"line-number"},"1"),n("br"),n("span",{class:"line-number"},"2"),n("br"),n("span",{class:"line-number"},"3"),n("br"),n("span",{class:"line-number"},"4"),n("br"),n("span",{class:"line-number"},"5"),n("br"),n("span",{class:"line-number"},"6"),n("br"),n("span",{class:"line-number"},"7"),n("br"),n("span",{class:"line-number"},"8"),n("br"),n("span",{class:"line-number"},"9"),n("br"),n("span",{class:"line-number"},"10"),n("br"),n("span",{class:"line-number"},"11"),n("br"),n("span",{class:"line-number"},"12"),n("br"),n("span",{class:"line-number"},"13"),n("br"),n("span",{class:"line-number"},"14"),n("br"),n("span",{class:"line-number"},"15"),n("br"),n("span",{class:"line-number"},"16"),n("br"),n("span",{class:"line-number"},"17"),n("br"),n("span",{class:"line-number"},"18"),n("br"),n("span",{class:"line-number"},"19"),n("br"),n("span",{class:"line-number"},"20"),n("br"),n("span",{class:"line-number"},"21"),n("br"),n("span",{class:"line-number"},"22"),n("br"),n("span",{class:"line-number"},"23"),n("br"),n("span",{class:"line-number"},"24"),n("br"),n("span",{class:"line-number"},"25"),n("br"),n("span",{class:"line-number"},"26"),n("br"),n("span",{class:"line-number"},"27"),n("br"),n("span",{class:"line-number"},"28"),n("br"),n("span",{class:"line-number"},"29"),n("br"),n("span",{class:"line-number"},"30"),n("br"),n("span",{class:"line-number"},"31"),n("br"),n("span",{class:"line-number"},"32"),n("br"),n("span",{class:"line-number"},"33"),n("br"),n("span",{class:"line-number"},"34"),n("br"),n("span",{class:"line-number"},"35"),n("br"),n("span",{class:"line-number"},"36"),n("br"),n("span",{class:"line-number"},"37"),n("br"),n("span",{class:"line-number"},"38"),n("br"),n("span",{class:"line-number"},"39"),n("br"),n("span",{class:"line-number"},"40"),n("br"),n("span",{class:"line-number"},"41"),n("br"),n("span",{class:"line-number"},"42"),n("br"),n("span",{class:"line-number"},"43"),n("br"),n("span",{class:"line-number"},"44"),n("br"),n("span",{class:"line-number"},"45"),n("br"),n("span",{class:"line-number"},"46"),n("br"),n("span",{class:"line-number"},"47"),n("br"),n("span",{class:"line-number"},"48"),n("br"),n("span",{class:"line-number"},"49"),n("br"),n("span",{class:"line-number"},"50"),n("br"),n("span",{class:"line-number"},"51"),n("br"),n("span",{class:"line-number"},"52"),n("br"),n("span",{class:"line-number"},"53"),n("br"),n("span",{class:"line-number"},"54"),n("br"),n("span",{class:"line-number"},"55"),n("br"),n("span",{class:"line-number"},"56"),n("br"),n("span",{class:"line-number"},"57"),n("br"),n("span",{class:"line-number"},"58"),n("br"),n("span",{class:"line-number"},"59"),n("br"),n("span",{class:"line-number"},"60"),n("br"),n("span",{class:"line-number"},"61"),n("br"),n("span",{class:"line-number"},"62"),n("br"),n("span",{class:"line-number"},"63"),n("br"),n("span",{class:"line-number"},"64"),n("br"),n("span",{class:"line-number"},"65"),n("br"),n("span",{class:"line-number"},"66"),n("br"),n("span",{class:"line-number"},"67"),n("br"),n("span",{class:"line-number"},"68"),n("br"),n("span",{class:"line-number"},"69"),n("br"),n("span",{class:"line-number"},"70"),n("br"),n("span",{class:"line-number"},"71"),n("br"),n("span",{class:"line-number"},"72"),n("br"),n("span",{class:"line-number"},"73"),n("br"),n("span",{class:"line-number"},"74"),n("br"),n("span",{class:"line-number"},"75"),n("br"),n("span",{class:"line-number"},"76"),n("br"),n("span",{class:"line-number"},"77"),n("br"),n("span",{class:"line-number"},"78"),n("br"),n("span",{class:"line-number"},"79"),n("br"),n("span",{class:"line-number"},"80"),n("br"),n("span",{class:"line-number"},"81"),n("br"),n("span",{class:"line-number"},"82"),n("br"),n("span",{class:"line-number"},"83"),n("br"),n("span",{class:"line-number"},"84"),n("br"),n("span",{class:"line-number"},"85"),n("br"),n("span",{class:"line-number"},"86"),n("br"),n("span",{class:"line-number"},"87"),n("br"),n("span",{class:"line-number"},"88"),n("br"),n("span",{class:"line-number"},"89"),n("br"),n("span",{class:"line-number"},"90"),n("br"),n("span",{class:"line-number"},"91"),n("br"),n("span",{class:"line-number"},"92"),n("br"),n("span",{class:"line-number"},"93"),n("br"),n("span",{class:"line-number"},"94"),n("br"),n("span",{class:"line-number"},"95"),n("br"),n("span",{class:"line-number"},"96"),n("br"),n("span",{class:"line-number"},"97"),n("br"),n("span",{class:"line-number"},"98"),n("br"),n("span",{class:"line-number"},"99"),n("br"),n("span",{class:"line-number"},"100"),n("br"),n("span",{class:"line-number"},"101"),n("br"),n("span",{class:"line-number"},"102"),n("br")])],-1),R=n("p",null,[s("Despu\xE9s de crear y enviar una instrucci\xF3n: "),n("code",null,"VersionProgramInstruction::SetString(String)"),s(" ahora tenemos el siguiente dise\xF1o de datos de cuenta 'actualizado'")],-1),T=n("img",{src:_,alt:"Program Account v2"},null,-1),O=n("h2",{id:"resources",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#resources","aria-hidden":"true"},"#"),s(" Resources")],-1),N={href:"https://borsh.io/",target:"_blank",rel:"noopener noreferrer"},V=s("Especificaci\xF3n de Borsh"),U={href:"https://github.com/solana-labs/solana/blob/master/sdk/program/src/borsh.rs#L67",target:"_blank",rel:"noopener noreferrer"},B=s("Solana "),x=n("code",null,"try_from_slice_unchecked",-1),Z={href:"https://github.com/FrankC01/versioning-solana",target:"_blank",rel:"noopener noreferrer"},q=s("Referencia de la implementaci\xF3n");function L(G,F){const o=e("SolanaCodeGroupItem"),l=e("SolanaCodeGroup"),u=e("CodeGroupItem"),r=e("CodeGroup"),c=e("ExternalLinkIcon");return k(),m(b,null,[y,t(l,null,{default:a(()=>[t(o,{title:"Account",active:""},{default:a(()=>[w]),preview:a(()=>[g]),_:1}),t(o,{title:"Instruction",active:""},{default:a(()=>[h]),preview:a(()=>[I]),_:1}),t(o,{title:"Processor",active:""},{default:a(()=>[A]),preview:a(()=>[S]),_:1})]),_:1}),E,t(l,null,{default:a(()=>[t(o,{title:"Account"},{default:a(()=>[v]),preview:a(()=>[z]),_:1})]),_:1}),P,t(r,null,{default:a(()=>[t(u,{title:"Instruction"},{default:a(()=>[C]),_:1}),t(u,{title:"Processor"},{default:a(()=>[D]),_:1})]),_:1}),R,T,O,n("ul",null,[n("li",null,[n("a",N,[V,t(c)])]),n("li",null,[n("a",U,[B,x,t(c)])]),n("li",null,[n("a",Z,[q,t(c)])])])],64)}var M=i(f,[["render",L]]);export{M as default};
